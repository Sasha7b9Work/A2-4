A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     1


MACRO ASSEMBLER A51 V6.14a
NO OBJECT MODULE REQUESTED
ASSEMBLER INVOKED BY: D:\PROGRAM FILES\CYGNAL\IDEFILES\C51\BIN\A51.EXE Amp21_1.asm XR GEN DB EP NOMOD51

LOC  OBJ            LINE     SOURCE

                       1        ;$include (c8051f020.inc) ; Include register definition file.
                +1     2     ;-----------------------------------------------------------------------------
                +1     3     ;       Copyright (C) 2001 CYGNAL INTEGRATED PRODUCTS, INC.
                +1     4     ;       All rights reserved.
                +1     5     ;
                +1     6     ;
                +1     7     ;       FILE NAME       : C8051F020.INC 
                +1     8     ;       TARGET MCUs     : C8051F020, 'F021, 'F022, 'F023 
                +1     9     ;       DESCRIPTION     : Register/bit definitions for the C8051F02x product family.  
                +1    10     ;
                +1    11     ;       REVISION 1.0    
                +1    12     ;
                +1    13     ;-----------------------------------------------------------------------------
                +1    14     ;REGISTER DEFINITIONS
                +1    15     ;
  0080          +1    16     P0       DATA  080H   ; PORT 0
  0081          +1    17     SP       DATA  081H   ; STACK POINTER
  0082          +1    18     DPL      DATA  082H   ; DATA POINTER - LOW BYTE
  0083          +1    19     DPH      DATA  083H   ; DATA POINTER - HIGH BYTE
  0084          +1    20     P4       DATA  084H   ; PORT 4
  0085          +1    21     P5       DATA  085H   ; PORT 5
  0086          +1    22     P6       DATA  086H   ; PORT 6
  0087          +1    23     PCON     DATA  087H   ; POWER CONTROL
  0088          +1    24     TCON     DATA  088H   ; TIMER CONTROL
  0089          +1    25     TMOD     DATA  089H   ; TIMER MODE
  008A          +1    26     TL0      DATA  08AH   ; TIMER 0 - LOW BYTE
  008B          +1    27     TL1      DATA  08BH   ; TIMER 1 - LOW BYTE
  008C          +1    28     TH0      DATA  08CH   ; TIMER 0 - HIGH BYTE
  008D          +1    29     TH1      DATA  08DH   ; TIMER 1 - HIGH BYTE
  008E          +1    30     CKCON    DATA  08EH   ; CLOCK CONTROL
  008F          +1    31     PSCTL    DATA  08FH   ; PROGRAM STORE R/W CONTROL
  0090          +1    32     P1       DATA  090H   ; PORT 1
  0091          +1    33     TMR3CN   DATA  091H   ; TIMER 3 CONTROL
  0092          +1    34     TMR3RLL  DATA  092H   ; TIMER 3 RELOAD REGISTER - LOW BYTE
  0093          +1    35     TMR3RLH  DATA  093H   ; TIMER 3 RELOAD REGISTER - HIGH BYTE
  0094          +1    36     TMR3L    DATA  094H   ; TIMER 3 - LOW BYTE
  0095          +1    37     TMR3H    DATA  095H   ; TIMER 3 - HIGH BYTE
  0096          +1    38     P7       DATA  096H   ; PORT 7
  0098          +1    39     SCON0    DATA  098H   ; SERIAL PORT 0 CONTROL
  0099          +1    40     SBUF0    DATA  099H   ; SERIAL PORT 0 BUFFER
  009A          +1    41     SPI0CFG  DATA  09AH   ; SERIAL PERIPHERAL INTERFACE 0 CONFIGURATION
  009B          +1    42     SPI0DAT  DATA  09BH   ; SERIAL PERIPHERAL INTERFACE 0 DATA
  009C          +1    43     ADC1     DATA  09CH   ; ADC 1 DATA
  009D          +1    44     SPI0CKR  DATA  09DH   ; SERIAL PERIPHERAL INTERFACE 0 CLOCK RATE CONTROL
  009E          +1    45     CPT0CN   DATA  09EH   ; COMPARATOR 0 CONTROL
  009F          +1    46     CPT1CN   DATA  09FH   ; COMPARATOR 1 CONTROL 
  00A0          +1    47     P2       DATA  0A0H   ; PORT 2
  00A1          +1    48     EMI0TC   DATA  0A1H   ; EMIF TIMING CONTROL
  00A3          +1    49     EMI0CF   DATA  0A3H   ; EXTERNAL MEMORY INTERFACE (EMIF) CONFIGURATION
  00A4          +1    50     P0MDOUT  DATA  0A4H   ; PORT 0 OUTPUT MODE CONFIGURATION
  00A5          +1    51     P1MDOUT  DATA  0A5H   ; PORT 1 OUTPUT MODE CONFIGURATION
  00A6          +1    52     P2MDOUT  DATA  0A6H   ; PORT 2 OUTPUT MODE CONFIGURATION
  00A7          +1    53     P3MDOUT  DATA  0A7H   ; PORT 3 OUTPUT MODE CONFIGURATION
  00A8          +1    54     IE       DATA  0A8H   ; INTERRUPT ENABLE
  00A9          +1    55     SADDR0   DATA  0A9H   ; SERIAL PORT 0 SLAVE ADDRESS
  00AA          +1    56     ADC1CN  DATA  0AAH   ; ADC 1 CONTROL
  00AB          +1    57     ADC1CF   DATA  0ABH   ; ADC 1 ANALOG MUX CONFIGURATION
  00AC          +1    58     AMX1SL   DATA  0ACH   ; ADC 1 ANALOG MUX CHANNEL SELECT
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     2

  00AD          +1    59     P3IF     DATA  0ADH   ; PORT 3 EXTERNAL INTERRUPT FLAGS
  00AE          +1    60     SADEN1   DATA  0AEH   ; SERIAL PORT 1 SLAVE ADDRESS MASK
  00AF          +1    61     EMI0CN   DATA  0AFH   ; EXTERNAL MEMORY INTERFACE CONTROL
  00B0          +1    62     P3       DATA  0B0H   ; PORT 3
  00B1          +1    63     OSCXCN   DATA  0B1H   ; EXTERNAL OSCILLATOR CONTROL
  00B2          +1    64     OSCICN   DATA  0B2H   ; INTERNAL OSCILLATOR CONTROL
  00B5          +1    65     P74OUT   DATA  0B5H   ; PORTS 4 - 7 OUTPUT MODE
  00B6          +1    66     FLSCL    DATA  0B6H   ; FLASH MEMORY TIMING PRESCALER
  00B7          +1    67     FLACL    DATA  0B7H   ; FLASH ACESS LIMIT 
  00B8          +1    68     IP       DATA  0B8H   ; INTERRUPT PRIORITY
  00B9          +1    69     SADEN0   DATA  0B9H   ; SERIAL PORT 0 SLAVE ADDRESS MASK
  00BA          +1    70     AMX0CF   DATA  0BAH   ; ADC 0 MUX CONFIGURATION
  00BB          +1    71     AMX0SL   DATA  0BBH   ; ADC 0 MUX CHANNEL SELECTION
  00BC          +1    72     ADC0CF   DATA  0BCH   ; ADC 0 CONFIGURATION
  00BD          +1    73     P1MDIN   DATA  0BDH   ; PORT 1 INPUT MODE
  00BE          +1    74     ADC0L    DATA  0BEH   ; ADC 0 DATA - LOW BYTE
  00BF          +1    75     ADC0H    DATA  0BFH   ; ADC 0 DATA - HIGH BYTE 
  00C0          +1    76     SMB0CN   DATA  0C0H   ; SMBUS 0 CONTROL
  00C1          +1    77     SMB0STA  DATA  0C1H   ; SMBUS 0 STATUS
  00C2          +1    78     SMB0DAT  DATA  0C2H   ; SMBUS 0 DATA 
  00C3          +1    79     SMB0ADR  DATA  0C3H   ; SMBUS 0 SLAVE ADDRESS
  00C4          +1    80     ADC0GTL  DATA  0C4H   ; ADC 0 GREATER-THAN REGISTER - LOW BYTE
  00C5          +1    81     ADC0GTH  DATA  0C5H   ; ADC 0 GREATER-THAN REGISTER - HIGH BYTE
  00C6          +1    82     ADC0LTL  DATA  0C6H   ; ADC 0 LESS-THAN REGISTER - LOW BYTE
  00C7          +1    83     ADC0LTH  DATA  0C7H   ; ADC 0 LESS-THAN REGISTER - HIGH BYTE
  00C8          +1    84     T2CON    DATA  0C8H   ; TIMER 2 CONTROL
  00C9          +1    85     T4CON    DATA  0C9H   ; TIMER 4 CONTROL
  00CA          +1    86     RCAP2L   DATA  0CAH   ; TIMER 2 CAPTURE REGISTER - LOW BYTE
  00CB          +1    87     RCAP2H   DATA  0CBH   ; TIMER 2 CAPTURE REGISTER - HIGH BYTE
  00CC          +1    88     TL2      DATA  0CCH   ; TIMER 2 - LOW BYTE
  00CD          +1    89     TH2      DATA  0CDH   ; TIMER 2 - HIGH BYTE
  00CF          +1    90     SMB0CR   DATA  0CFH   ; SMBUS 0 CLOCK RATE
  00D0          +1    91     PSW      DATA  0D0H   ; PROGRAM STATUS WORD
  00D1          +1    92     REF0CN   DATA  0D1H   ; VOLTAGE REFERENCE 0 CONTROL
  00D2          +1    93     DAC0L    DATA  0D2H   ; DAC 0 REGISTER - LOW BYTE
  00D3          +1    94     DAC0H    DATA  0D3H   ; DAC 0 REGISTER - HIGH BYTE
  00D4          +1    95     DAC0CN   DATA  0D4H   ; DAC 0 CONTROL
  00D5          +1    96     DAC1L    DATA  0D5H   ; DAC 1 REGISTER - LOW BYTE
  00D6          +1    97     DAC1H    DATA  0D6H   ; DAC 1 REGISTER - HIGH BYTE
  00D7          +1    98     DAC1CN   DATA  0D7H   ; DAC 1 CONTROL
  00D8          +1    99     PCA0CN   DATA  0D8H   ; PCA 0 COUNTER CONTROL
  00D9          +1   100     PCA0MD   DATA  0D9H   ; PCA 0 COUNTER MODE
  00DA          +1   101     PCA0CPM0 DATA  0DAH   ; CONTROL REGISTER FOR PCA 0 MODULE 0
  00DB          +1   102     PCA0CPM1 DATA  0DBH   ; CONTROL REGISTER FOR PCA 0 MODULE 1
  00DC          +1   103     PCA0CPM2 DATA  0DCH   ; CONTROL REGISTER FOR PCA 0 MODULE 2
  00DD          +1   104     PCA0CPM3 DATA  0DDH   ; CONTROL REGISTER FOR PCA 0 MODULE 3
  00DE          +1   105     PCA0CPM4 DATA  0DEH   ; CONTROL REGISTER FOR PCA 0 MODULE 4
  00E0          +1   106     ACC      DATA  0E0H   ; ACCUMULATOR
  00E1          +1   107     XBR0     DATA  0E1H   ; DIGITAL CROSSBAR CONFIGURATION REGISTER 0
  00E2          +1   108     XBR1     DATA  0E2H   ; DIGITAL CROSSBAR CONFIGURATION REGISTER 1
  00E3          +1   109     XBR2     DATA  0E3H   ; DIGITAL CROSSBAR CONFIGURATION REGISTER 2
  00E4          +1   110     RCAP4L   DATA  0E4H   ; TIMER 4 CAPTURE REGISTER - LOW BYTE
  00E5          +1   111     RCAP4H   DATA  0E5H   ; TIMER 4 CAPTURE REGISTER - HIGH BYTE
  00E6          +1   112     EIE1     DATA  0E6H   ; EXTERNAL INTERRUPT ENABLE 1
  00E7          +1   113     EIE2     DATA  0E7H   ; EXTERNAL INTERRUPT ENABLE 2
  00E8          +1   114     ADC0CN   DATA  0E8H   ; ADC 0 CONTROL
  00E9          +1   115     PCA0L    DATA  0E9H   ; PCA 0 TIMER - LOW BYTE
  00EA          +1   116     PCA0CPL0 DATA  0EAH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 0 - LOW BYTE
  00EB          +1   117     PCA0CPL1 DATA  0EBH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 1 - LOW BYTE
  00EC          +1   118     PCA0CPL2 DATA  0ECH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 2 - LOW BYTE
  00ED          +1   119     PCA0CPL3 DATA  0EDH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 3 - LOW BYTE
  00EE          +1   120     PCA0CPL4 DATA  0EEH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 4 - LOW BYTE
  00EF          +1   121     RSTSRC   DATA  0EFH   ; RESET SOURCE 
  00F0          +1   122     B        DATA  0F0H   ; B REGISTER
  00F1          +1   123     SCON1    DATA  0F1H   ; SERIAL PORT 1 CONTROL
  00F2          +1   124     SBUF1    DATA  0F2H   ; SERAIL PORT 1 DATA
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     3

  00F3          +1   125     SADDR1   DATA  0F3H   ; SERAIL PORT 1 
  00F4          +1   126     TL4      DATA  0F4H   ; TIMER 4 DATA - LOW BYTE
  00F5          +1   127     TH4      DATA  0F5H   ; TIMER 4 DATA - HIGH BYTE
  00F6          +1   128     EIP1     DATA  0F6H   ; EXTERNAL INTERRUPT PRIORITY REGISTER 1
  00F7          +1   129     EIP2     DATA  0F7H   ; EXTERNAL INTERRUPT PRIORITY REGISTER 2
  00F8          +1   130     SPI0CN   DATA  0F8H   ; SERIAL PERIPHERAL INTERFACE 0 CONTROL 
  00F9          +1   131     PCA0H    DATA  0F9H   ; PCA 0 TIMER - HIGH BYTE
  00FA          +1   132     PCA0CPH0 DATA  0FAH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 0 - HIGH BYTE
  00FB          +1   133     PCA0CPH1 DATA  0FBH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 1 - HIGH BYTE
  00FC          +1   134     PCA0CPH2 DATA  0FCH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 2 - HIGH BYTE
  00FD          +1   135     PCA0CPH3 DATA  0FDH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 3 - HIGH BYTE
  00FE          +1   136     PCA0CPH4 DATA  0FEH   ; CAPTURE/COMPARE REGISTER FOR PCA 0 MODULE 4 - HIGH BYTE
  00FF          +1   137     WDTCN    DATA  0FFH   ; WATCHDOG TIMER CONTROL 
                +1   138     ;
                +1   139     ;------------------------------------------------------------------------------
                +1   140     ;BIT DEFINITIONS
                +1   141     ;
                +1   142     ; TCON 88H
  0088          +1   143     IT0      BIT   TCON.0 ; EXT. INTERRUPT 0 TYPE
  0089          +1   144     IE0      BIT   TCON.1 ; EXT. INTERRUPT 0 EDGE FLAG
  008A          +1   145     IT1      BIT   TCON.2 ; EXT. INTERRUPT 1 TYPE
  008B          +1   146     IE1      BIT   TCON.3 ; EXT. INTERRUPT 1 EDGE FLAG
  008C          +1   147     TR0      BIT   TCON.4 ; TIMER 0 ON/OFF CONTROL
  008D          +1   148     TF0      BIT   TCON.5 ; TIMER 0 OVERFLOW FLAG
  008E          +1   149     TR1      BIT   TCON.6 ; TIMER 1 ON/OFF CONTROL
  008F          +1   150     TF1      BIT   TCON.7 ; TIMER 1 OVERFLOW FLAG
                +1   151     ;
                +1   152     ; SCON0 98H
  0098          +1   153     RI       BIT   SCON0.0 ; RECEIVE INTERRUPT FLAG
  0099          +1   154     TI       BIT   SCON0.1 ; TRANSMIT INTERRUPT FLAG
  009A          +1   155     RB8      BIT   SCON0.2 ; RECEIVE BIT 8
  009B          +1   156     TB8      BIT   SCON0.3 ; TRANSMIT BIT 8
  009C          +1   157     REN      BIT   SCON0.4 ; RECEIVE ENABLE
  009D          +1   158     SM2      BIT   SCON0.5 ; MULTIPROCESSOR COMMUNICATION ENABLE
  009E          +1   159     SM1      BIT   SCON0.6 ; SERIAL MODE CONTROL BIT 1
  009F          +1   160     SM0      BIT   SCON0.7 ; SERIAL MODE CONTROL BIT 0
                +1   161     ; 
                +1   162     ; IE A8H
  00A8          +1   163     EX0      BIT   IE.0   ; EXTERNAL INTERRUPT 0 ENABLE
  00A9          +1   164     ET0      BIT   IE.1   ; TIMER 0 INTERRUPT ENABLE
  00AA          +1   165     EX1      BIT   IE.2   ; EXTERNAL INTERRUPT 1 ENABLE
  00AB          +1   166     ET1      BIT   IE.3   ; TIMER 1 INTERRUPT ENABLE
  00AC          +1   167     ES       BIT   IE.4   ; SERIAL PORT INTERRUPT ENABLE
  00AD          +1   168     ET2      BIT   IE.5   ; TIMER 2 INTERRUPT ENABLE
  00AF          +1   169     EA       BIT   IE.7   ; GLOBAL INTERRUPT ENABLE
                +1   170     ;
                +1   171     ; IP B8H
  00B8          +1   172     PX0      BIT   IP.0   ; EXTERNAL INTERRUPT 0 PRIORITY
  00B9          +1   173     PT0      BIT   IP.1   ; TIMER 0 PRIORITY
  00BA          +1   174     PX1      BIT   IP.2   ; EXTERNAL INTERRUPT 1 PRIORITY
  00BB          +1   175     PT1      BIT   IP.3   ; TIMER 1 PRIORITY
  00BC          +1   176     PS       BIT   IP.4   ; SERIAL PORT PRIORITY
  00BD          +1   177     PT2      BIT   IP.5   ; TIMER 2 PRIORITY
                +1   178     ;
                +1   179     ; SMB0CN C0H
  00C0          +1   180     SMBTOE   BIT   SMB0CN.0 ; SMBUS 0 TIMEOUT ENABLE
  00C1          +1   181     SMBFTE   BIT   SMB0CN.1 ; SMBUS 0 FREE TIMER ENABLE
  00C2          +1   182     AA       BIT   SMB0CN.2 ; SMBUS 0 ASSERT/ACKNOWLEDGE FLAG
  00C3          +1   183     SI       BIT   SMB0CN.3 ; SMBUS 0 INTERRUPT PENDING FLAG
  00C4          +1   184     STO      BIT   SMB0CN.4 ; SMBUS 0 STOP FLAG
  00C5          +1   185     STA      BIT   SMB0CN.5 ; SMBUS 0 START FLAG
  00C6          +1   186     ENSMB    BIT   SMB0CN.6 ; SMBUS 0 ENABLE 
                +1   187     ;
                +1   188     ; T2CON C8H
  00C8          +1   189     CPRL2    BIT   T2CON.0 ; CAPTURE OR RELOAD SELECT
  00C9          +1   190     CT2      BIT   T2CON.1 ; TIMER OR COUNTER SELECT
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     4

  00CA          +1   191     TR2      BIT   T2CON.2 ; TIMER 2 ON/OFF CONTROL
  00CB          +1   192     EXEN2    BIT   T2CON.3 ; TIMER 2 EXTERNAL ENABLE FLAG
  00CC          +1   193     TCLK     BIT   T2CON.4 ; TRANSMIT CLOCK FLAG
  00CD          +1   194     RCLK     BIT   T2CON.5 ; RECEIVE CLOCK FLAG
  00CE          +1   195     EXF2     BIT   T2CON.6 ; EXTERNAL FLAG
  00CF          +1   196     TF2      BIT   T2CON.7 ; TIMER 2 OVERFLOW FLAG
                +1   197     ;
                +1   198     ; PSW D0H
  00D0          +1   199     P        BIT   PSW.0  ; ACCUMULATOR PARITY FLAG
  00D1          +1   200     F1       BIT   PSW.1  ; USER FLAG 1
  00D2          +1   201     OV       BIT   PSW.2  ; OVERFLOW FLAG
  00D3          +1   202     RS0      BIT   PSW.3  ; REGISTER BANK SELECT 0
  00D4          +1   203     RS1      BIT   PSW.4  ; REGISTER BANK SELECT 1
  00D5          +1   204     F0       BIT   PSW.5  ; USER FLAG 0
  00D6          +1   205     AC       BIT   PSW.6  ; AUXILIARY CARRY FLAG
  00D7          +1   206     CY       BIT   PSW.7  ; CARRY FLAG
                +1   207     ;
                +1   208     ; PCA0CN D8H
  00D8          +1   209     CCF0     BIT   PCA0CN.0 ; PCA 0 MODULE 0 INTERRUPT FLAG
  00D9          +1   210     CCF1     BIT   PCA0CN.1 ; PCA 0 MODULE 1 INTERRUPT FLAG
  00DA          +1   211     CCF2     BIT   PCA0CN.2 ; PCA 0 MODULE 2 INTERRUPT FLAG
  00DB          +1   212     CCF3     BIT   PCA0CN.3 ; PCA 0 MODULE 3 INTERRUPT FLAG
  00DC          +1   213     CCF4     BIT   PCA0CN.4 ; PCA 0 MODULE 4 INTERRUPT FLAG
  00DE          +1   214     CR       BIT   PCA0CN.6 ; PCA 0 COUNTER RUN CONTROL BIT
  00DF          +1   215     CF       BIT   PCA0CN.7 ; PCA 0 COUNTER OVERFLOW FLAG
                +1   216     ;
                +1   217     ; ADC0CN E8H
  00E8          +1   218     AD0LJST  BIT   ADC0CN.0 ; ADC 0 RIGHT JUSTIFY DATA BIT
  00E9          +1   219     AD0WINT  BIT   ADC0CN.1 ; ADC 0 WINDOW COMPARE INTERRUPT FLAG
  00EA          +1   220     AD0STM0  BIT   ADC0CN.2 ; ADC 0 START OF CONVERSION MODE BIT 0
  00EB          +1   221     AD0STM1  BIT   ADC0CN.3 ; ADC 0 START OF CONVERSION MODE BIT 1
  00EC          +1   222     AD0BUSY  BIT   ADC0CN.4 ; ADC 0 BUSY FLAG
  00ED          +1   223     AD0INT   BIT   ADC0CN.5 ; ADC 0 CONVERISION COMPLETE INTERRUPT FLAG 
  00EE          +1   224     AD0TM    BIT   ADC0CN.6 ; ADC 0 TRACK MODE
  00EF          +1   225     AD0EN    BIT   ADC0CN.7 ; ADC 0 ENABLE
                +1   226     ;
                +1   227     ; SPI0CN F8H
  00F8          +1   228     SPIEN    BIT   SPI0CN.0 ; SPI 0 SPI ENABLE
  00F9          +1   229     MSTEN    BIT   SPI0CN.1 ; SPI 0 MASTER ENABLE
  00FA          +1   230     SLVSEL   BIT   SPI0CN.2 ; SPI 0 SLAVE SELECT
  00FB          +1   231     TXBSY    BIT   SPI0CN.3 ; SPI 0 TX BUSY FLAG
  00FC          +1   232     RXOVRN   BIT   SPI0CN.4 ; SPI 0 RX OVERRUN FLAG
  00FD          +1   233     MODF     BIT   SPI0CN.5 ; SPI 0 MODE FAULT FLAG
  00FE          +1   234     WCOL     BIT   SPI0CN.6 ; SPI 0 WRITE COLLISION FLAG
  00FF          +1   235     SPIF     BIT   SPI0CN.7 ; SPI 0 INTERRUPT FLAG
                     236             
                     237     NAME    MAIN
                     238                      ;      EXTRN  CODE(end1)
                     239                      ;      EXTRN CODE(numb)
                     240                       ; EXTRN CODE(SOROS)
                     241                        ;EXTRN  CODE(Abegin)
                     242     
                     243                             
                     244                             ;PUBLIC gener,bitmas,bitrs,bitznak
                     245                             ;PUBLIC meff
                     246                             ;PUBLIC rez_A, rez_A0;  !!!!!!!!!!!!!
0000                 247                             org 0h;    cseg AT 0
                     248     
0000 020000   F      249                     jmp begin;;Main               ; Locate a jump to the start of code at 
                     250                                             
0003                 251                                                     org 3
0003 32              252                                                     reti
000B                 253                                                     org 0bh
000B 32              254                                                     reti
0013                 255                                                     org 13h
0013 32              256                                                     reti
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     5

001B                 257                                                     org 1bh
001B 32              258                                                     reti
0023                 259                                                     org 23h
0023 32              260                                                     reti
002B                 261                                                     org 2bh
002B 32              262                                                     reti
0033                 263                                                     org 33h
0033 32              264                                                     reti
003B                 265                                                     org 3bh
003B 32              266                                                     reti
0043                 267                                                     org 43h
0043 32              268                                                     reti
004B                 269                                                     org 4bh
004B 32              270                                                     reti
0053                 271                                                     org 53h
0053 32              272                                                     reti
005B                 273                                                     org 5bh
                     274                                                     
005B 32              275                                                     reti
0063                 276                                                     org 63h
0063 32              277                                                     reti
006B                 278                                                     org 6bh
006B 32              279                                                     reti
0073                 280                                                      org 73h
0073 32              281                                                     reti
0093                 282                                                     org     93h
0093 020000   F      283                                                     jmp             keyb1           ;IE6
                     284     
009B                 285                                                     org     9bh
009B 020000   F      286                                                     jmp             keyb2      ;IE7
                     287     
                     288     
                     289     
                     290     
  00CA               291     TMR2RLL  DATA 0cah;    // TIMER 2 RELOAD LOW                                       */
  00CB               292     TMR2RLH  DATA 0cbh;    // TIMER 2 RELOAD HIGH 
                     293      
                     294     Main         SEGMENT  CODE
                     295     
----                 296                                     DSEG
                     297       
  0040               298     bufind  DATA    40h;буффер индикации 12byte
                     299     ;DATA 4ch
  004F               300     abin            DATA    4fh;4byte
  0053               301     adec            DATA    53h;10byte
  006E               302     chmas           DATA    6eh;счетчик л-тов незаполн массива
  006F               303     mabin           DATA    6fh
  0077               304     reacp           DATA    77h;результат чтения асп 4byte int (hex)
  003D               305     chkl            DATA    3dh             ;счетчик задержки клавиатуры 2bait                 
                                     
  003F               306     chmasN          DATA    3fh             ;n=2,n=10 суммирование n значений       =20(27.12.0
                             6)
  003C               307     savba           DATA    3ch;сохр байта индикации при миганиии   
  003B               308     movrig      DATA        3bh;крайне правое положение
  003A               309     movleft     DATA        3ah; крайне левое положение                  
                     310                     
                     311     
                     312     ;;;;;
  0020               313      cellbit                DATA    20h
  0000               314     bitznak         BIT     cellbit.0       ;20.0           
  0001               315     bitmas          BIT     cellbit.1       ;20.1 бит заполнения массива            
  0002               316     znmat           BIT             cellbit.2       ;20.2
  0003               317     bitrs           BIT             cellbit.3       ;20.3
  0004               318     bitizm          BIT             cellbit.4       ;20.4 вкл реж измерения
  0005               319     bitavp          BIT             cellbit.5       ;20.5  бит режима avp
  0006               320     bitvi11         BIT             cellbit.6       ;20.6   бит режима выч R
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     6

  0007               321     bitzus          BIT             cellbit.7       ;20.7;флаг задержки     после установки us
                     322     
  0021               323     cellbit1                DATA    21h
  0008               324     bitbuf          BIT     cellbit1.0      ;21.0           
  0009               325     bitprd          BIT     cellbit1.1      ;21.1  выдача вкл       
  000A               326     bitbon          BIT             cellbit1.2      ;21.2  буфер вкл
  000B               327     bitmem          BIT             cellbit1.3      ;21.3
  000C               328     bmem11          BIT             cellbit1.4      ;21.4    бит ПАМ11
  000D               329     bmem12          BIT             cellbit1.5      ;21.5    бит ПАМ12
  000E               330     bmem13          BIT             cellbit1.6      ;21.6   бит ПАМ13        
  000F               331     bitnul          BIT             cellbit1.7      ;21.7 бит кнопки НУЛЬ
                     332     
  0022               333     cellbit2                DATA    22h
  0010               334     bitt2           BIT     cellbit2.0      ;22.0 уст признак Tизм2 нажата кнопка Т 
  0011               335     bitmenu         BIT     cellbit2.1      ;22.1  бит режима меню(нажата кн меню)  
  0012               336     bitvi12         BIT             cellbit2.2      ;22.2  
  0013               337     bitvi13         BIT             cellbit2.3      ;22.3
  0014               338     bitvich         BIT             cellbit2.4      ;22.4    1-е нажатие кн ВЫЧ R (режим ВЫЧ R)
  0015               339     bitvi21         BIT             cellbit2.5      ;22.5    
  0016               340     bitvi31         BIT             cellbit2.6      ;22.6   бит ПАМ13        
  0017               341     bitoll          BIT             cellbit2.7      ;22.7
                     342     ;в реж измерения прибор измеряет (кнопка ИЗМ не нажата )
                     343     ;при нажатии кнопок (T,МЕНЮ ,ПАМЯТЬ ,ВЫЧ R)прибор выходит из реж измерения
                     344     ;и выдает т.н. буфер индикации  
  0023               345     cellbit3                DATA    23h
  0018               346     knizm           BIT     cellbit3.0      ;22.0 уст признак нажата кнопка ИЗМ     
  0019               347     bitmig          BIT     cellbit3.1      ;22.1 бит мигания при наборе конст      
  001A               348     bitakt          BIT             cellbit3.2      ;22.2  бит такта
                     349     ;bit            BIT             cellbit3.3      ;22.3
                     350     ;bit            BIT             cellbit3.4      ;22.4    
                     351     ;bit            BIT             cellbit3.5      ;22.5    
                     352     ;bit            BIT             cellbit3.6      ;22.6            
                     353     ;bit            BIT             cellbit3.7      ;22.7
                     354             
  005E               355     rez_Ame   data 5eh;float         (РЕЗ1-AN)*K
                     356     ;hex
  0062               357     rez_A    data 62h       ;РЕЗ сумма 100 (10)отсчетов измерения    
  0066               358     rez_A1  data 66h        ;РЕЗ1  среднее по массиву из 2,10 ти лементов int (hex)
  006A               359     rez_A0  data 6ah;
  007B               360     rez_A2   data 7bh; A2
                     361     
  0098               362     chinkor  data  98h;80h          ;счетчик интервала коррекции  2byte
  0081               363     chavt    data  81h              ;счетчик автокалибровки  2byte
  0083               364     chdel    data  83h              ; счетчик задержки
                     365     ;float
  0084               366     kor0_AN  data  84h              ;4byte  AN      результат коррекции 0
  0088               367     rezAp    data  88h              ;4byte  A+
  008C               368     rezAm    data  8ch              ;4byte  A-
  0090               369     koefKp   data  90h              ;4byte  K+
  0094               370     koefKm   data  94h              ;4byte  K-
                     371     ;hex 
  009A               372     parT     data  9ah              ;параметр времени измерения
  009B               373     chbefore data  9bh              ;счетчик предварительного суммирования
  009C               374     rez_A3   data  9ch              ;A3
                     375     ;FLOAT
  00A0               376     koefKD  data  0a0h         ;KD кофф диапазона
  00A4               377     constE  data  0a4h         ;констант E
  00A8               378     constF  data  0a8h         ;констант F
  00AC               379     chind   data  0ach         ;счетчик индикации
  00AD               380     chbuf   data  0adh         ;счетчик периода загрузки в буфер и интерфейс
  00AE               381     diap    data  0aeh         ;номер диапазона
  00AF               382     parN    data  0afh         ;N  пар разрядности индикатора
  00B0               383     level   data  0b0h              ;уровень в меню, выч    ,Tизм
  00B1               384     vichR   data  0b1h              ;параметр =11,12,13,21
  00B2               385     marker  data  0b2h         ;номер мигающего знакоместа
  00B3               386     summa   data  0b3h         ;ячейка длясуммирования      rez_A
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     7

  00B7               387     load    data  0b7h         ;яч для загрузки текстов на индикатор
  00B8               388     work    data  0b8h        ;рабочая ячейка
  00BC               389     konstA  data  0bch        ;     введенная с крана константа A
  00C0               390     konstB  data  0c0h         ;    введенная с крана константа B
  00C4               391     nblok   data  0c4h         ;номер блока
  00C5               392     Rez_del data  0c5h      ;сумма n-значений /n
                     393     ;data  0c9h
                     394     
                     395     ;внешнее ОЗУ 64K 
                     396     ;               XSEG AT 100h
                     397             PUBLIC    MASS0
  0080               398     MASS0  xdata 0080h;     скользящий массив измерения
  0084               399     MASS1  xdata 0084h;
  0088               400     MASS2  xdata 0088h;
  008C               401     MASS3  xdata 008ch;
  0090               402     MASS4  xdata 0090h;
  0094               403     MASS5  xdata 0094h;
  0098               404     MASS6  xdata 0098h;
  009C               405     MASS7  xdata 009ch;
  00A0               406     MASS8  xdata 00a0h;
  00A4               407     MASS9  xdata 00a4h;
  00A8               408     MASS10  xdata 00a8h;
  00AC               409     MASS11  xdata 00ach;
  00B0               410     MASS12  xdata 00b0h;
  00B4               411     MASS13  xdata 00b4h;
  00B8               412     MASS14  xdata 00b8h;
  00BC               413     MASS15  xdata 00bch;
  00C0               414     MASS16  xdata 00c0h;
  00C4               415     MASS17  xdata 00c4h;
  00C8               416     MASS18  xdata 00c8h;
  00CC               417     MASS19  xdata 00cch;
                     418     ;xdata 0038h;
                     419     
  0000               420                             rr0             EQU 00
  0001               421                     rr1       equ   01
  0006               422                     rr6   equ 06
  0002               423                     rr2       equ   02
  0003               424                     rr3       equ   03
  0007               425                     rr7   equ 07
                     426     
  0008               427                     r8   equ 08
  0009               428                     r9        equ   09
  000A               429                     r10       equ   10
  000B               430                     r11   equ 11
                     431     
                     432                     
                     433        
----                 434                  rseg     Main          ; Switch to this code segment.
                     435     
                     436                  using    0              ; Specify register bank for the following
                     437     
0100                 438     org 100h
                     439     ;$EJECT
                     440     
0100 7581E0          441     begin:     mov  sp, #0e0h
0103 75E900          442                                             mov             PCA0L,#00;=0x00;
0106 75D900          443                                             mov     PCA0MD,#00;= 0x00;
0109 75A41F          444                                             mov     P0MDOUT,#1fh;=0x1f;
010C 75A5CD          445                                             mov     P1MDOUT,#0cdh;86h;8fh;=0x8f;
010F 75A600          446                                             mov     P2MDOUT,#00;=0x00;
                     447             
0112 75A73F          448             mov     P3MDOUT,#3fh;
0115 75B5FF          449             mov     P74OUT ,#0ffh;=0xff;
0118 75D103          450             mov     REF0CN,#03h;=0x03;
                     451             
011B 75E114          452             mov     XBR0,#14h;= 0x14;
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     8

011E 75E200          453             mov     XBR1,#00; =0x00;
0121 75E300          454             mov XBR2,#00;=0x00;
0124 75B0C0          455             mov     P3,#0c0h
0127 75FFDE          456             mov     WDTCN,#0deh;=0xde;       //запрет работы WDT
012A 75FFAD          457             mov     WDTCN,#0adh;=0xad;                                   
012D 758922          458             mov     TMOD,#22h;=0x22;        //регистр режимов
0130 758E30          459             mov     CKCON,#30h;=0x30; //сист частота/12     
0133 758CF9          460             mov     TH0,#0f9h;=0xf9;//      ; Установка таймера
0136 758AF9          461             mov     TL0,#0f9h;=0xf9; 
0139 75E680          462             mov     EIE1,#80h;=0x80;
                     463     
013C 75D480          464             mov     DAC0CN,#80h;=0x80;
013F 75D780          465             mov     DAC1CN,#80h;=0x80;
0142 75B167          466             mov     OSCXCN,#67h;=0x67;
                     467     
                     468      
                     469     
0145 E5B1            470     gener:     mov a, oscxcn
0147 B4E7FB          471                cjne a,#11100111b,gener
                     472                            
014A 75B288          473             mov     OSCICN,#88h;=0x84;
014D 75CA00          474         mov TMR2RLL,#0;=0;
0150 75CBD1          475         mov TMR2RLH,#0d1h;=0xd1;
                     476       
0153 D28E            477                     setb  TCON.6                    ;регистр управления
0155 D28C            478                      setb tcon.4
                     479     
0157 75EF00          480             mov     RSTSRC,#0;=00   ;//источники сброса 
                     481     
                     482             
015A 75E340          483          mov        XBR2,#40h
015D 75E106          484              mov    XBR0,#06h;16h
0160 75F803          485             mov             SPI0CN,#03
0163 759D31          486             mov             spi0ckr,#31H;;;;;;;;#04
                     487     ;       mov             EIE2,#20H
0166 75E730          488             mov             EIE2,#30H;00110000
0169 75A880          489             mov     IE,#80h;//10000000      ;//Снятие блокировки всех прерываний
                     490     ;ozu
016C E4              491                             clr     a
016D 7800            492                             mov     r0,#00h 
016F F6              493     mecle:          mov     @r0,a                   ;обнулить озу 256 байт
0170 08              494                             inc     r0
0171 B87FFB          495                             cjne    r0,#7fh,mecle
0174 7880            496                             mov     r0,#80h
0176 F6              497     meff:           mov     @r0,a 
0177 F2              498                             movx @r0,a
0178 08              499                             inc     r0
0179 B8DFFA          500                             cjne    r0,#0dfh,meff
017C 120000   F      501                             call    clmassix
017F 7898            502                             mov             r0,#chinkor
0181 7600            503                             mov             @r0,#0;1;
0183 08              504                             inc             r0
0184 76C8            505                             mov             @r0,#0c8h;90h;
                     506                             ;;;;
0186 7881            507                             mov             r0,#chavt
0188 7603            508                             mov             @r0,#3;1
018A 08              509                             inc             r0
018B 7620            510                             mov             @r0,#20h;90h
                     511     
018D 78B2            512                                     mov             r0,#marker
018F 76FF            513                                     mov             @r0,#0ffh
                     514                             ;mov            r0,#chind
                     515                             ;mov            @r0,#1
                     516                     
0191 74FF            517                             mov             a,#0ffh
0193 F585            518                        mov          p5,a
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE     9

0195 799A            519                             mov             r1,#parT
0197 7702            520                             mov             @r1,#2                  ;Tizm=1s
0199 79AE            521                             mov             r1,#diap
019B 7705            522                             mov             @r1,#5                  ;10-7a
019D 79AF            523                             mov             r1,#parN
019F 7702            524                             mov             @r1,#2
01A1 7400            525                             mov             a,#00h
01A3 F585            526                             mov             p5,a
01A5 D204            527                             setb    bitizm
                     528     
01A7 799B            529                             mov             r1,#chbefore
01A9 7700            530                             mov             @r1,#0
                     531                             ;;;;;;
01AB 900000   F      532                             mov             dptr,#ch_1              ;1->r2..r5 float
01AE 120000   F      533                             call    ldc_long
01B1 7890            534                             mov             r0,#koefKp         ;1(float)->koefKp
01B3 120000   F      535                             call    saver2
01B6 7894            536                             mov             r0,#koefKm              ;1(float)->koefKm
01B8 120000   F      537                             call    saver2
01BB 78A0            538                             mov             r0,#koefKD
01BD 120000   F      539                             call    saver2  
                     540     ;START
                     541     ;                                       rez_A0=0;
                     542     ;        SUMM=0; //обнуление скользящего массива
                     543     ;        over_mas=0;
                     544     ;        count_mas=0;
                     545     
01C0 7840            546                             mov             r0,#bufind
01C2                 547     age2:
01C2 76FD            548                             mov             @r0,#0fdh         ;погасить индикатор
01C4 08              549                             inc             r0
01C5 B84CFA          550                             cjne    r0,#bufind+12,age2              
01C8 120000   F      551                             call    ind
01CB 120000   F      552                             call    z_1s
                     553     
                     554                                     ;зажечь все лементы индикации
01CE 7840            555                             mov             r0,#bufind
01D0 76FE            556     ageon:          mov             @r0,#0feh;?
01D2 08              557                             inc             r0
01D3 B84CFA          558                             cjne    r0,#bufind+12,ageon             
01D6 120000   F      559                             call    ind
01D9 120000   F      560                             call    z_1s            ;1sec
                     561     ;;;;;;;;;;;;;;;;
01DC 7840            562                             mov             r0,#bufind
01DE 7630            563                             mov             @r0,#30H;"A"
01E0 08              564                             inc             r0
01E1 7630            565                             mov             @r0,#30H;"В"
01E3 08              566                             inc             r0
01E4 7630            567                             mov             @r0,#30H;"Т"
01E6 08              568                             inc             r0
01E7 7634            569                             mov             @r0,#34H;2dh
01E9 08              570                             inc             r0
01EA 7635            571                             mov             @r0,#35H;"H"
01EC 08              572                             inc             r0
01ED 7636            573                             mov             @r0,#36h
01EF 08              574                             inc             r0
01F0 7637            575                             mov             @r0,#37h
01F2 08              576                             inc             r0
01F3 762D            577                             mov             @r0,#2dh
01F5 08              578                             inc             r0
01F6 7637            579                             mov             @r0,#37h
01F8 08              580                             inc             r0
01F9 7641            581                             mov             @r0,#"A";31h
01FB 08              582                             inc             r0
                     583                     
01FC 120000   F      584     dd:                     call    ind
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    10

01FF 120000   F      585                             call    z_15;z_1ms
                     586             ;       jmp             dd
                     587     ;;;;;;;;;;;;;;;;;;;
0202 7C60            588                             mov             r4,#60h
0204 7D00            589                             mov             r5,#00         
0206 120000   F      590                             call    iniacp;инициализация acp
0209 120000   F      591                             call    loadUS          ;us 10-7 A
                     592                             
020C C217            593     rebyte:         clr             bitoll
020E 3095FD          594                             jnb             p1.5,$
0211 2095FD          595                             jb              p1.5,$
0214 E586            596                             mov             a,P6            ;p6.4=0
0216 54EF            597                             anl             a,#0efh
0218 F586            598                             mov             P6,a
021A 00              599                             nop
021B 00              600                             nop
                     601                                     
021C E586            602                             mov             a,P6                    ;p6.4=1 
021E 4410            603                             orl             a,#10h
0220 F586            604                             mov             P6,a                        
0222 7411            605                             mov             a,#11h
0224 120000   F      606                             call    write
                     607                             ;чтение acp
0227 120000   F      608                             call    read    
022A F578            609                             mov     reacp+1,A       ;старший байт 
022C 120000   F      610                             call    read    
022F F579            611                             mov     reacp+2,A       ;средний байт 
0231 120000   F      612                             call    read
0234 F57A            613                             mov     reacp+3,A               ;мл байт
                     614                        ;;;;;;;;;;;
0236 7878            615                        mov          r0,#reacp+1
0238 E6              616                        mov          a,@r0
0239 20E72D          617                             jb              acc.7,znplus;
023C D200            618                             setb    bitznak
023E 4480            619                             orl             a,#80h  ;ост содерж яч 
0240 F6              620                             mov             @r0,a
                     621                                     
0241 18              622     mmm:            dec             r0;,#reacp
0242 76FF            623                             mov             @r0,#0ffh
0244 802B            624                             jmp             goznak
                     625     
                     626     
0246 750A00          627     labelA:         mov             r10,#0          
0249 750B00          628                             mov             r11,#0
024C 783D            629                             mov             r0,#chkl
024E 120000   F      630                             call    chcmp
0251 7000            631                             jnz             no0key
                     632                             ;разрешить ie6,ie7       
                     633                     ;       mov             EIE2,#30h ;EIE2.5,EIE2.4
                     634                     ;       mov             EIP2,#30h
                     635                        
0253 793D            636     no0key:         mov             r1,#chkl 
0255 120000   F      637                             call    chdec
0258 2004B1          638                             jb              bitizm,rebyte
                     639                              ;буфер 2 выдать на индикацию
                     640     ;3.11.06        
025B 120000   F      641                             call    ind
025E 120000   F      642                             call    z_01s
0261 120000   F      643                             call    z_01s
0264 120000   F      644                             call    z_01s
0267 80DD            645                             jmp             labelA
                     646     
0269 C200            647     znplus:         clr     bitznak
026B 547F            648                             anl             a,#7fh;fdh                      ;+
026D F6              649                             mov             @r0,a
026E 18              650                             dec             r0;,#reacp
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    11

026F 7600            651                             mov             @r0,#00h
                     652                             
0271                 653     goznak: 
                     654     ;;;;;;;;;;;;;
0271 787A            655                             mov     r0,#reacp+3
0273 E6              656                             mov             a,@r0
0274 7F05            657                             mov             r7,#5;6 сдвиг на 5 разрядов вправо
0276 C3              658     sdvig3:         clr             c
0277 13              659                             rrc             a
0278 DFFC            660                             djnz    r7,sdvig3 ;d7,d6,d5       мл байт
027A FA              661                             mov             r2,a    ;сохр байт
027B 18              662                             dec             r0              ;       reacp+2
027C E6              663                             mov             a,@r0
027D C0E0            664                             push    acc
027F C3              665                             clr             c
0280 7F03            666                             mov             r7,#3;2
0282 C3              667     sdvig2:         clr             c
0283 33              668                             rlc             a
0284 DFFC            669                             djnz    r7,sdvig2 ;d12..d11      средний байт
0286 4A              670                             orl             a,r2
0287 F57A            671                             mov             reacp+3,a;сформ мл байт
0289 D0E0            672                             pop             acc
                     673                             
028B 7F05            674                             mov             r7,#5;6
028D C3              675     sdvig1:         clr             c
028E 13              676                             rrc             a
028F DFFC            677                             djnz    r7,sdvig1 ;d15,d14        ср байт
0291 FA              678                             mov             r2,a   ;сохр
0292 E578            679                             mov             a,reacp+1
0294 C0E0            680                             push    acc
                     681                     ;;      push    acc
0296 7F03            682                             mov             r7,#3;2
0298 C3              683     sdvig0:         clr             c
0299 33              684                             rlc             a
029A DFFC            685                             djnz    r7,sdvig0 ;       d21..d16
029C 4A              686                             orl             a,r2
029D F579            687                             mov             reacp+2,a       ; сформ средний  байт
029F D0E0            688                             pop             acc       ;reacp+1
                     689                             ;;;;;;;;;;;;;;
02A1 20E70B          690                             jb              acc.7,sdvm
02A4 C3              691                             clr             c
02A5 7F05            692                             mov             r7,#5;6
02A7 C3              693     sdvig4:         clr             c
02A8 13              694                             rrc             a
02A9 DFFC            695                             djnz    r7,sdvig4 ;       d23,d22
02AB F578            696                             mov             reacp+1,a
02AD 8008            697                             jmp             readyacp;ankor;klmas
                     698     ;;;;;;;;;;;;                                    
02AF 7F05            699     sdvm:           mov             r7,#5;6
02B1 D3              700     sdvig6:         setb            c
02B2 13              701                             rrc             a
02B3 DFFC            702                             djnz    r7,sdvig6 ;       d23,d22
02B5 F578            703                             mov             reacp+1,a
                     704                                                             
                     705     ; reacp..reacp+3-результат чтения асп(hex) 
                     706     ;;;;;;;;;
02B7                 707     readyacp:
02B7 7898            708                                             mov             r0,#chinkor
02B9 E6              709                             mov             a,@r0
02BA 30E702          710                             jnb             acc.7,gopart
02BD 8044            711                                     jmp             sumt2
                     712                     
02BF                 713     gopart:
02BF 789A            714                             mov             r0,#parT        ;параметр времени
02C1 793F            715                             mov             r1,#chmasN
02C3 B6013A          716                             cjne    @r0,#1,noparT1
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    12

                     717                             ;РЕЗ+РЕЗ
02C6 7877            718                             mov             r0,#reacp
02C8 120000   F      719                             call    resar2          ;reacp->r2..r5
02CB 78B6            720                             mov             r0,#summa+3;rez_A+3
02CD 120000   F      721                             call    ladd
02D0 78B3            722                             mov             r0,#summa;rez_A
02D2 120000   F      723                             call    saver2
02D5 793F            724                              mov            r1,#chmasN
02D7 7714            725                             mov             @r1,#20;10
02D9 789B            726                             mov             r0,#chbefore
02DB B6631E          727                             cjne    @r0,#99,nobef99
                     728                             ;РЕЗ/100
02DE 900000   F      729                             MOV        DPTR,#ch100 
02E1 120000   F      730     allsum:         CALL   ldc_ltemp                 ; ltemp <-- 100
02E4 120000   F      731                             call    zdiv;divide
02E7 7862            732                             mov             r0,#rez_A
02E9 120000   F      733                             call    saver2          ;сумма 100 отсчетов /100
02EC 78C5            734                             mov             r0,#Rez_del
02EE 120000   F      735                             call    saver2  
                     736                        ;;;;;
02F1 78B3            737                        mov          r0,#summa
02F3 120000   F      738                        call         clear4
                     739     ;                       mov             a,chmas
                     740     ;                       mov             @r1,a   ;->chmasN
02F6 799B            741                             mov             r1,#chbefore
02F8 7700            742                             mov             @r1,#0
02FA 8048            743                             jmp             klmas           ;загр в массив скользящее ср
02FC 06              744     nobef99:        inc             @r0                     ;chbefore
02FD 020000   F      745                             jmp             rebyte;labelA;метка A
                     746     ;сначала суммируем 100 знач (не выводим на индикатор не расп в скользящий массив )
                     747     ;а потом уже располагаем  в скользящий массив  из n
                     748     
                     749     
                     750     
0300 B6021D          751     noparT1:        cjne    @r0,#2,noparT2
                     752                             ;РЕЗ+РЕЗ
0303                 753     sumt2:
0303 7877            754                              mov            r0,#reacp
0305 120000   F      755                             call    resar2          ;reacp->r2..r5
0308 78B6            756                             mov             r0,#summa+3;rez_A+3
030A 120000   F      757                             call    ladd
030D 78B3            758                             mov             r0,#summa;rez_A
030F 120000   F      759                             call    saver2
0312 789B            760                             mov             r0,#chbefore
0314 793F            761                             mov             r1,#chmasN
0316 770A            762                             mov             @r1,#10
0318 B613E1          763                             cjne    @r0,#19,nobef99;9,nobef99
                     764                             ;РЕЗ/10
031B 900000   F      765                             MOV        DPTR,#ch20;ch10 
031E 80C1            766                             jmp             allsum
                     767                             ;;;;;;;
                     768                             
                     769     
0320 B60302          770     noparT2:        cjne    @r0,#3,noparT3
0323 8003            771                             jmp             aapar
                     772     
0325 B60410          773     noparT3:        cjne    @r0,#4,noparT4
0328 7877            774     aapar:          mov             r0,#reacp
032A 120000   F      775                             call    resar2          ;reacp->r2..r5
032D 7862            776                             mov             r0,#rez_A
032F 120000   F      777                             call    saver2
0332 793F            778                              mov            r1,#chmasN
0334 770A            779                             mov             @r1,#10
                     780                     ;       mov             @r1,#10         ;n=10
0336 800C            781                             jmp             klmas
0338 7702            782     noparT4:   mov          @r1,#2          ;chmasN n=2
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    13

033A 7877            783                             mov             r0,#reacp
033C 120000   F      784                             call    resar2          ;reacp->r2..r5
033F 7862            785                             mov             r0,#rez_A
0341 120000   F      786                             call    saver2
                     787     ;загрузить А в массив из 2/10 значений
                     788     ;;;;;;;;;;;;;;;
0344                 789     klmas:           
0344 793F            790                             mov             r1,#chmasN
0346 B7021A          791                             cjne    @r1,#2,mas10
0349 900080          792                             MOV        dptr,#MASS0
034C 120000   F      793                     CALL       xCIKLWR        ; MASS0 --> MASS1
                     794     
034F 7862            795                             mov             r0,#rez_A
0351 120000   F      796                             call    resar2          ;->r2..r5
0354 900080          797                             mov                     dptr,#MASS0
0357 120000   F      798                   call              saveIr2                 ; R2-R5 --> MAS0
                     799                     
035A 900087          800                   MOV          dptr,#MASS1+3
035D 120000   F      801                   CALL       addx
0360 020000   F      802                       jmp           endsum
0363 B70A7A          803     mas10:                  cjne    @r1,#10,mas20
0366 9000A0          804                                             mov                     dptr,#MASS8
0369 120000   F      805                     CALL            xCIKLWR         ;MASS8->MASS9
036C 90009C          806                                             mov                     dptr,#MASS7
036F 120000   F      807                     CALL            xCIKLWR         ;MASS7->MASS8
0372 900098          808                     MOV       dptr,#MASS6
0375 120000   F      809                     CALL       xCIKLWR         ; MASS6 --> MASS7
0378 900094          810                     MOV        dptr,#MASS5
                     811                    
037B 120000   F      812                    CALL        xCIKLWR        ; MASS5 --> MASS6
037E 900090          813                    MOV         dptr,#MASS4
                     814                    
0381 120000   F      815                    CALL        xCIKLWR        ; MASS4 --> MASS5
0384 90008C          816                             mov                     dptr,#MASS3
                     817     
0387 120000   F      818                    CALL             xCIKLWR         ;MASS3->MASS4
038A 900088          819                     MOV        dptr,#MASS2
                     820                    
038D 120000   F      821                    CALL        xCIKLWR         ; MASS2 --> MASS3
0390 900084          822                    MOV         dptr,#MASS1
                     823                     
0393 120000   F      824                   CALL         xCIKLWR        ; MASS1 --> MASS2
0396 900080          825                    MOV         dptr,#MASS0
                     826                   
0399 120000   F      827                    CALL        xCIKLWR        ; MASS0 --> MASS1
                     828     
                     829                             
039C 7862            830                             mov             r0,#rez_A
039E 120000   F      831                             call    resar2          ;->r2..r5
                     832                                     ;call   aform
03A1 900080          833                                     mov                     dptr,#MASS0
03A4 120000   F      834                   call              saveIr2                 ; R2-R5 --> MAS0
                     835              
03A7 900087          836                   MOV          dptr,#MASS1+3
03AA 120000   F      837                   CALL       addx
03AD 90008B          838                   MOV          dptr,#MASS2+3
03B0 120000   F      839                   CALL       addx
03B3 90008F          840                   MOV          dptr,#MASS3+3
03B6 120000   F      841                  CALL        addx
03B9 900093          842                   MOV       dptr,#MASS4+3
03BC 120000   F      843                   call       addx
03BF 900097          844                     MOV        dptr,#MASS5+3
03C2 120000   F      845                  CALL        addx
03C5 90009B          846                   MOV          dptr,#MASS6+3
03C8 120000   F      847                   CALL       addx
03CB 90009F          848                   MOV          dptr,#MASS7+3
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    14

03CE 120000   F      849                  CALL        addx
03D1 9000A3          850                  MOV        dptr,#MASS8+3
03D4 120000   F      851                   call       addx
03D7 9000A7          852                     MOV                     dptr,#MASS9+3
03DA 120000   F      853                  call        addx
03DD 020000   F      854                              jmp            endsum
                     855     
03E0 9000C8          856     mas20:          mov                     dptr,#MASS18
03E3 120000   F      857                     CALL            xCIKLWR         ;MASS18->MASS19
03E6 9000C4          858                                             mov                     dptr,#MASS17
03E9 120000   F      859                     CALL            xCIKLWR         ;MASS17->MASS18
03EC 9000C0          860                     MOV       dptr,#MASS16
03EF 120000   F      861                     CALL       xCIKLWR         ; MASS16 --> MASS17
03F2 9000BC          862                     MOV        dptr,#MASS15
                     863                    
03F5 120000   F      864                    CALL        xCIKLWR        ; MASS15 --> MASS16
03F8 9000B8          865                    MOV         dptr,#MASS14
                     866                    
03FB 120000   F      867                    CALL        xCIKLWR        ; MASS14 --> MASS15
03FE 9000B4          868                             mov                     dptr,#MASS13
                     869     
0401 120000   F      870                    CALL             xCIKLWR         ;MASS13->MASS14
0404 9000B0          871                     MOV        dptr,#MASS12
                     872                    
0407 120000   F      873                    CALL        xCIKLWR         ; MASS12 --> MASS13
040A 9000AC          874                    MOV         dptr,#MASS11
                     875                     
040D 120000   F      876                   CALL         xCIKLWR        ; MASS11 --> MASS12
0410 9000A8          877                    MOV         dptr,#MASS10
                     878                   
0413 120000   F      879                    CALL        xCIKLWR        ; MASS10 --> MASS11
0416 9000A4          880                                      MOV       dptr,#MASS9
0419 120000   F      881                     CALL       xCIKLWR        ; MASS9 --> MASS10
                     882     
041C 9000A0          883                                             mov                     dptr,#MASS8
041F 120000   F      884                     CALL            xCIKLWR         ;MASS8->MASS9
0422 90009C          885                                             mov                     dptr,#MASS7
0425 120000   F      886                     CALL            xCIKLWR         ;MASS7->MASS8
0428 900098          887                     MOV       dptr,#MASS6
042B 120000   F      888                     CALL       xCIKLWR         ; MASS6 --> MASS7
042E 900094          889                     MOV        dptr,#MASS5
                     890                    
0431 120000   F      891                    CALL        xCIKLWR        ; MASS5 --> MASS6
0434 900090          892                    MOV         dptr,#MASS4
                     893                    
0437 120000   F      894                    CALL        xCIKLWR        ; MASS4 --> MASS5
043A 90008C          895                             mov                     dptr,#MASS3
                     896     
043D 120000   F      897                    CALL             xCIKLWR         ;MASS3->MASS4
0440 900088          898                     MOV        dptr,#MASS2
                     899                    
0443 120000   F      900                    CALL        xCIKLWR         ; MASS2 --> MASS3
0446 900084          901                    MOV         dptr,#MASS1
                     902                     
0449 120000   F      903                   CALL         xCIKLWR        ; MASS1 --> MASS2
044C 900080          904                    MOV         dptr,#MASS0
                     905                   
044F 120000   F      906                    CALL        xCIKLWR        ; MASS0 --> MASS1
                     907     
                     908                             
0452 7862            909                             mov             r0,#rez_A
0454 120000   F      910                             call    resar2          ;->r2..r5
                     911                                     ;call   aform
0457 900080          912                                     mov                     dptr,#MASS0
045A 120000   F      913                   call              saveIr2                 ; R2-R5 --> MAS0
                     914              
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    15

045D 900087          915                   MOV          dptr,#MASS1+3
0460 120000   F      916                   CALL       addx
0463 90008B          917                   MOV          dptr,#MASS2+3
0466 120000   F      918                   CALL       addx
0469 90008F          919                   MOV          dptr,#MASS3+3
046C 120000   F      920                  CALL        addx
046F 900093          921                   MOV       dptr,#MASS4+3
0472 120000   F      922                   call       addx
0475 900097          923                     MOV        dptr,#MASS5+3
0478 120000   F      924                  CALL        addx
047B 90009B          925                   MOV          dptr,#MASS6+3
047E 120000   F      926                   CALL       addx
0481 90009F          927                   MOV          dptr,#MASS7+3
0484 120000   F      928                  CALL        addx
0487 9000A3          929                  MOV        dptr,#MASS8+3
048A 120000   F      930                   call       addx
048D 9000A7          931                     MOV                     dptr,#MASS9+3
0490 120000   F      932                  call        addx
                     933     ;27
0493 9000AB          934                                     MOV        dptr,#MASS10+3
0496 120000   F      935                   CALL       addx
0499 9000AF          936                                     MOV        dptr,#MASS11+3
049C 120000   F      937                   CALL       addx
049F 9000B3          938                   MOV          dptr,#MASS12+3
04A2 120000   F      939                   CALL       addx
04A5 9000B7          940                   MOV          dptr,#MASS13+3
04A8 120000   F      941                  CALL        addx
04AB 9000BB          942                   MOV       dptr,#MASS14+3
04AE 120000   F      943                   call       addx
04B1 9000BF          944                                     MOV        dptr,#MASS15+3
04B4 120000   F      945                     CALL     addx
04B7 9000C3          946                   MOV          dptr,#MASS16+3
04BA 120000   F      947                   CALL       addx
04BD 9000C7          948                   MOV          dptr,#MASS17+3
04C0 120000   F      949                  CALL        addx
04C3 9000CB          950                  MOV        dptr,#MASS18+3
04C6 120000   F      951                   call       addx
04C9 9000CF          952                                     MOV                     dptr,#MASS19+3
04CC 120000   F      953                  call        addx
                     954     
                     955     
                     956     
                     957             ;23.03          
04CF                 958     endsum:
04CF 786E            959                                     mov             r0,#chmas;8.11.06               ;0..n(0..2,
                             0..10)
04D1 06              960                                     inc             @r0
04D2 E6              961                                     mov             a,@r0   
04D3 200105          962                                     jb              bitmas,masfull          ;массив заполнен 2/
                             10 значениями
                     963                                     
04D6 B53F26          964                                     cjne    a,chmasN,masx5
04D9 D201            965                                     setb    bitmas                  ;массив заполнен
04DB 853F6E          966     masfull:                mov             chmas,chmasN
04DE 783F            967                                     mov             r0,#chmasN
04E0 E6              968                                     mov             a,@r0
                     969     ;masfull:
04E1 B40208          970                                     cjne    a,#2,nochn2
04E4 900000   F      971                                     MOV        DPTR,#ch2;10 
04E7 120000   F      972                                     CALL   ldc_ltemp                 ; ltemp <-- 2
04EA 801D            973                                     jmp             mas5div
                     974     
04EC B40A08          975     nochn2:         cjne    a,#10,nochn10
04EF 900000   F      976                                                     MOV        DPTR,#ch10 
04F2 120000   F      977                                     CALL   ldc_ltemp                 ; ltemp <-- 10
04F5 8012            978                                     jmp             mas5div
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    16

                     979     
04F7                 980     nochn10:
04F7 900000   F      981                                                     MOV        DPTR,#ch20 
04FA 120000   F      982                                     CALL   ldc_ltemp                 ; ltemp <-- 20
04FD 800A            983                                     jmp             mas5div
04FF 856E0B          984     masx5:                  mov     ltemp+3,chmas                   ;массив не заполнен
0502 E4              985                                     clr     a
0503 F50A            986                                     mov     ltemp+2,a
0505 F509            987                                     mov     ltemp+1,a
0507 F508            988                                     mov     ltemp,a
                     989     
0509                 990     mas5div:
0509 120000   F      991                                     CALL       zdiv;divide                           ; R2-R5 =
                     992                                              ; = (MAS0+MAS1+MAS2+MAS3+MAS4)/5
                     993     
                     994                             
                     995      ;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     996     ;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     997     ;получен результат 3 байта и знак
050C 7866            998                             mov             r0,#rez_A1
050E 120000   F      999                             call    saver2           ;сохр среднее по массиву
                    1000     ;;8.11.06                       mov             chmasN,#0
                    1001      ;;;;;;;;;;;;
                    1002      ;;;;;;;;;;;;
0511 C3             1003                             clr             c
0512 799A           1004                             mov             r1,#parT
0514 7402           1005                             mov             a,#2
0516 97             1006                             subb    a,@r1
0517 500A           1007                             jnc             ankor           ;T<3
                    1008                             ;A-=РЕЗ1                                ;T>3
0519 120402         1009                             call    altof                   ;r2..r5->float
051C 785E           1010                             mov             r0,#rez_Ame
051E 120000   F     1011                             call    saver2
0521 8022           1012                             jmp             gotoKD
                    1013     
0523                1014     ankor:  
0523 7898           1015                             mov             r0,#chinkor
0525 E6             1016                             mov             a,@r0
0526 30E703         1017                             jnb             acc.7,nokorr
                    1018                             ;коррекция 0
0529 020000   F     1019                             jmp             kornul
052C                1020     nokorr: 
                    1021                             ;mov            r10,#00         ;       chavt
                    1022                             ;mov            r11,#00h
052C 7881           1023                             mov              r0,#chavt      
052E E6             1024                             mov                     a,@r0;call      chcmp           ;сравн счет
                             чик авто калибровки с 0h
052F 30E750         1025                             jnb             acc.7,nonulavt;jnz              nonulavt        
0532 750A00         1026                             mov             r10,#0;1;00;02          
0535 750BC8         1027                             mov             r11,#0c8h;90h;0c8h;58h
0538 7898           1028                             mov             r0,#chinkor
053A 120000   F     1029                             call    chcmp
053D 705B           1030                             jnz             noavk
                    1031                             ;автокалибровка
053F 020000   F     1032                             jmp             autoka;noavk;
                    1033     
0542 020000   F     1034     rafterK:                jmp             afterK
                    1035     ;;;;;;;;;;
0545 C3             1036      gotoKD:                clr             c
0546 799A           1037                             mov             r1,#parT
0548 7404           1038                             mov             a,#4
054A 97             1039                             subb    a,@r1
054B 50F5           1040                             jnc             rafterK         ;T<5
                    1041                             ;A1-=A- *KD                     ;T>5
054D 120000   F     1042                             call            findkoef                                ;r2,r3-hex
0550 12046C         1043                                     call            rebyte2                         ;r2..r5- he
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    17

                             x
                    1044                                     
0553 120402         1045                                     call    altof                   ;r2..r5->float
0556 900000   F     1046                                     mov     dptr,#CHtho;100000
0559 120000   F     1047                                     call    ldc_ltemp                       ;r8..r11
055C 1202B7         1048                                     call    fldiv
055F 120000   F     1049                                     call    move28
                    1050                             
0562 785E           1051                             mov             r0,#rez_Ame;->r2..r5   ???????????/
0564 120000   F     1052                             call    resar2
0567 120203         1053                                     call    flmul
056A 120343         1054                             call    ftol                    ;float->int
056D 7866           1055                             mov             r0,#rez_A1
056F 120000   F     1056                             call    saver2
0572 786A           1057                             mov             r0,#rez_A0;->r8..r11 hex
0574 120000   F     1058                             call    resar8
0577 120000   F     1059                             call    lsub            ;A3=A-1-A0
057A 789C           1060                             mov             r0,#rez_A3
057C 120000   F     1061                             call    saver2
057F 020000   F     1062                             jmp             labelB  
                    1063      ;;;;;;;;;;; 9.11.06
0582 789A           1064     nonulavt:        mov            r0,#parT
0584 E6             1065                             mov             a,@r0
0585 6401           1066                             xrl             a,#01
0587 700C           1067                             jnz             avtdec1
0589 7982           1068                             mov             r1,#chavt+1     ;T=1 chavt-10
058B 120000   F     1069                             call    tenmin
058E 7999           1070     kordec10:       mov             r1,#chinkor+1
0590 120000   F     1071                             call    tenmin
0593 8018           1072                             jmp             rezmul
                    1073     
0595 7981           1074     avtdec1:        mov             r1,#chavt       
0597 120000   F     1075                             call    chdec           ;chavt-1
                    1076     ;                       jmp             kordec1;rezmul
059A 789A           1077     noavk:          mov             r0,#parT
059C E6             1078                             mov             a,@r0
059D 6401           1079                             xrl             a,#01
059F 7007           1080                             jnz             kordec1
                    1081                             ;T=1 chinkor-10
05A1 7999           1082                     mov             r1,#chinkor+1
05A3 120000   F     1083                             call    tenmin
05A6 8005           1084                             jmp             rezmul
05A8 7998           1085     kordec1:        mov             r1,#chinkor
05AA 120000   F     1086                             call    chdec           ; chinkor-1
                    1087                        ;9.11.06
                    1088                             ;;;;;;;;;;;;;;
                    1089                             ;;;;;;;;;;;;;
                    1090     ;(РЕЗ1-АN)*K
05AD                1091     rezmul:
05AD 7866           1092                             mov             r0,#rez_A1;->r2..r5
05AF 120000   F     1093                             call    resar2
05B2 120402         1094                             call    altof   ;r2..r5->float  6.06    
05B5 7884           1095                             mov             r0,#kor0_AN;->r8..r11
05B7 120000   F     1096                             call    resar8
                    1097                             ;;call  altof   ;r2..r5->float
05BA 1201D1         1098                             call    flsub
05BD 7890           1099                             mov             r0,#koefKp;->r8..r11
05BF EA             1100                             mov             a,r2
05C0 30E702         1101                             jnb             acc.7,nminus
                    1102                             ;jnb            bitznak,nminus
                    1103                     
05C3 7894           1104                             mov             r0,#koefKm;->r8..r11
05C5 120000   F     1105     nminus:         call    resar8
05C8 120203         1106                             call    flmul  ;результат в плавающем формате м.б. его сохранить?
                    1107                     
                    1108                     ;;;;;;;;        call    ftol                    ;float->int
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    18

05CB 785E           1109                             mov             r0,#rez_Ame
05CD 120000   F     1110                             call    saver2
                    1111      ;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1112      ;;;;;;;;;;;;;;;;;;;;;;;;;;
05D0                1113     afterK:                 
                    1114     ;;;;;;;;;;;;;;
                    1115                             ;;;;;;  call    altof                   ;r2..r5->float
05D0 EA             1116                                     mov             a,r2
05D1 547F           1117                                     anl             a,#7fh
05D3 FA             1118                                     mov             r2,a
05D4 900000   F     1119                                     mov     dptr,#ch_220;220000
05D7 120000   F     1120                                     call    ldc_ltemp                       ;r8..r11=8
05DA 1201D6         1121                                     call    flcmp
                    1122                             ;       jnc             rmo220          ;A>220000
05DD 120000   F     1123                                     call            findkoef                                ;r2
                             ,r3-hex
05E0 12046C         1124                                     call            rebyte2                         ;r2..r5- he
                             x
                    1125                                     
05E3 120402         1126                                     call    altof                   ;r2..r5->float
05E6 900000   F     1127                                     mov     dptr,#CHtho;100000
05E9 120000   F     1128                                     call    ldc_ltemp                       ;r8..r11=8
05EC 1202B7         1129                                     call    fldiv
05EF 120000   F     1130                                     call    move28
05F2 785E           1131                                     mov             r0,#rez_Ame
05F4 120000   F     1132                                     call    resar2
                    1133                     
05F7 120203         1134                                     call    flmul     ;A1-=A-*KD  fl
                    1135                                     
05FA 120343         1136                                     call    ftol                    ;float->int
05FD 7866           1137                                     mov             r0,#rez_A1
05FF 120000   F     1138                                     call    saver2
0602 120402         1139                                     call    altof                   ;r2..r5->float
0605 900000   F     1140                                     mov     dptr,#ch_200;200000
0608 120000   F     1141                                     call    ldc_ltemp                       ;r8..r11=8
060B 1201D6         1142                                     call    flcmp
                    1143                                     ;jnc            mo220           ;A>200000
060E 301806         1144                                     jnb             knizm,goA2;             bitizm,goA2     
0611 200526         1145                                     jb              bitavp,yesavp   
0614 200650         1146     noavp:                  jb              bitvi11,yesvich
0617                1147     goA2:                    ;A2=A1-
0617 7866           1148                                      mov            r0,#rez_A1
0619 120000   F     1149                                     call    resar2
061C 787B           1150                                     mov             r0,#rez_A2
061E 120000   F     1151                                     call    saver2
0621                1152     goA3A2:                  ;A3=A2-A0
0621 786A           1153                                       mov           r0,#rez_A0
0623 120000   F     1154                                     call    resar8
0626 120000   F     1155                                     call    lsub
0629 789C           1156                                     mov             r0,#rez_A3
062B 120000   F     1157                                     call    saver2
                    1158                                     ;;;;;;
062E                1159     goonin:            ;jmp         goonind;indA3;8.11.06
062E 78AC           1160                                     mov             r0,#chind
0630 B60005         1161                                     cjne    @r0,#0,rnochi0
0633 020000   F     1162                                     jmp             goonind;indA3
                    1163     ;                               clr             P3.4
                    1164     ;                               nop
                    1165     ;                               nop
                    1166     ;                               setb    P3.4      ;??????????????????????/
                    1167     ;                               jmp             nop3_0
                    1168     
                    1169     ;                               jb              P3.0,nop3_0     ;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1170     ;                               mov             r0,#rez_A0              ;r2..r5->rez_A0
                    1171     ;                               call    saver2                  ;ЗАПОМНИТЬ СМЕЩЕНИЕ НУЛЯ
                    1172     ;                               jmp             rebyte          ;age2
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    19

0636 804B           1173      rmo220:                jmp             mo220
0638 8078           1174      rnochi0:               jmp             nochi0
                    1175     
                    1176     ;;;;;;;;;;;;;;;;
063A EA             1177     yesavp:                 mov             a,r2
063B 547F           1178                                     anl             a,#7fh
063D FA             1179                                     mov             r2,a
063E 900000   F     1180                                     mov     dptr,#ch_10th;10000
0641 120000   F     1181                                     call    ldc_ltemp                       ;r8..r11=8
0644 1201D6         1182                                     call    flcmp
0647 50CB           1183                                     jnc             noavp           ;A>10000        
0649 78AE           1184                                     mov             r0,#diap                ;10-11
064B B60902         1185                                     cjne    @r0,#9,avpgo
064E 80C4           1186                                     jmp             noavp
0650                1187     avpgo:                  
0650 06             1188                                     inc             @r0             ;переключ диапазон на 1 поз
                             ицию вниз
0651 B60A01         1189                                     cjne    @r0,#0ah,clmasv
0654 16             1190                                     dec             @r0
0655                1191     clmasv:         ;сбросить массив
0655 120000   F     1192                             call    loadUS
                    1193                             ;call   louizm
0658 120000   F     1194                             call     clmassix
065B 78B3           1195                                     mov             r0,#summa
065D 120000   F     1196                                     call    clear4
0660 786A           1197                                     mov             r0,#rez_A0
0662 120000   F     1198                                     call    clear4                                             
                                                   
0665 80C7           1199                                jmp     goonin
                    1200     
0667                1201     yesvich:        ;A2=E/A1-+F
0667 78A4           1202                                      mov            r0,#constE
0669 120000   F     1203                                     call    resar2
066C 7866           1204                                       mov           r0,#rez_A1
066E 120000   F     1205                                     call    resar8
0671 1202B7         1206                                     call    fldiv
0674 78A8           1207                                      mov    r0,#constF
0676 120000   F     1208                                     call    resar8
0679 120166         1209                                     call    fladd
067C 787B           1210                                     mov             r0,#rez_A2
067E 120000   F     1211                                     call    saver2
0681 809E           1212                                     jmp             goA3A2
                    1213     
0683 300508         1214     mo220:             jnb          bitavp,indoll
0686 301805         1215                                jnb          knizm,indoll;bitizm,indoll
0689 78AE           1216                                     mov             r0,#diap
068B B6000A         1217                                     cjne    @r0,#0,nodi2
                    1218                                ;10-2
068E 900000   F     1219     indoll:                 mov             dptr,#teOLL;OLL
0691 120000   F     1220                                     call    lotext
0694 D217           1221                                     setb    bitoll
0696 8096           1222                                     jmp             goonin  
                    1223     
0698 16             1224     nodi2:             dec          @r0     ;переключить на 1 позицию вверх
                    1225     
0699 B6FF01         1226                                     cjne    @r0,#0ffh,nodi9
069C 06             1227                                     inc             @r0
                    1228     
069D 120000   F     1229     nodi9:          call    loadUS
                    1230                                     ;call   louizm
                    1231                                     ;сбросить массив
06A0 120000   F     1232                                     call     clmassix
06A3 78B3           1233                                     mov             r0,#summa
06A5 120000   F     1234                                     call    clear4
06A8 786A           1235                                     mov             r0,#rez_A0
06AA 120000   F     1236                                     call    clear4  
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    20

06AD D207           1237                                     setb    bitzus  ;флаг задержки  после установки us         
                                                                   
06AF 020000   F     1238                                jmp     goonin
                    1239     
06B2 16             1240     nochi0:                 dec             @r0                     ;СТИ-1
06B3 020000   F     1241                                     jmp             labelB  
                    1242     
                    1243             
                    1244     ;;;;;;;;;;;;;;;
                    1245     
06B6                1246     nop3_0: ;;      ;rez_A-rez_A0
                    1247                     ;;                      mov             r0,#rez_A0
                    1248                     ;;                      call    resar8
                    1249                     ;;                      call    lsub
                    1250                     ;;                      mov             r0,#rez_A
                    1251                     ;;;                     call    saver2
                    1252      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
06B6 789C           1253      indA3:                         mov             r0,#rez_A3       ;A3 ->в десятич форму(6дес
                              разрядов и в кои)
06B8 120000   F     1254                                             call    resar2
06BB 900000   F     1255                                             mov             dptr,#ch100              
06BE 120000   F     1256                                             call    ldc_ltemp        
06C1 120000   F     1257                                             call    zdiv            ;rez_A3/100=r2..r5
                    1258                                     
06C4 EC             1259                                             mov             a,r4
06C5 20E71E         1260                                             jb              acc.7,aless0
06C8 4408           1261                                             orl             a,#08                   ;rez_A>0 d1
                             1=1
06CA F5D3           1262                                             mov             DAC0H,a
                    1263                                                                             ;мл байт
06CC ED             1264                                             mov             a,r5
06CD F5D2           1265                                             mov             DAC0L,a
06CF 801E           1266                                             jmp             moveA3;
                    1267     
06D1 B70207         1268     no3parN:                        cjne    @r1,#2,no2parN
                    1269                                             ;в байт 0  записать пробел
06D4 7946           1270                                             mov             r1,#bufind+6
06D6 7720           1271                                             mov             @r1,#" ";0fdh;
06D8 020000   F     1272                                             jmp             seeind;moveA3
                    1273     
06DB                1274     no2parN:                        ;в байты 0 и 1 записать пробел
06DB 7945           1275                                             mov             r1,#bufind+5
06DD 7720           1276                                             mov             @r1,#" ";0fdh;" "
06DF 09             1277                                             inc             r1
06E0 7720           1278                                             mov             @r1,#" ";0fdh;" "
06E2 807B           1279                                             jmp             seeind;moveA3
06E4 8079           1280      rseeind:               jmp             seeind
06E6 F4             1281     aless0:                         cpl             a
06E7 54F7           1282                                             anl             a,#0f7h         ;d11=0
06E9 F5D3           1283                                             mov             DAC0H,a
                    1284                                                                             ;мл байт
06EB ED             1285                                             mov             a,r5
06EC F4             1286                                             cpl             a
06ED F5D2           1287                                             mov             DAC0L,a
06EF                1288     goonind:                  ; ВЫДАЧА НА ИНДИКАТОР РЕЗУЛЬТАТА
                    1289                                     
                    1290                                             
06EF                1291     moveA3: ;нажата кн вычR не выдавать на индикатор не портить bufind..
                    1292                     ;по нажатию кн по прерыванию по выходу из прерыв прог доходит
                    1293                     ;до конца цикла измерения результат не размещать в буфере
                    1294                     ;не забывать сбрасывать по выходу из режима обр кнопки 
                    1295                     ;и возврату в режим измерения
06EF 201458         1296                                             jb              bitvich,rnorvich
06F2 201055         1297                                             jb              bitt2,rnorvich
06F5 2017EC         1298                                             jb              bitoll,rseeind
                    1299             
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    21

                    1300     ;;;;;;;;;;;;;;
06F8 789C           1301                                              mov            r0,#rez_A3
06FA 120000   F     1302                                             call    resar2
06FD 120343         1303                                             call    ftol                    ;float->int r2..r5
                    1304     ;;;;;;;;
0700 789C           1305                                             mov             r0,#rez_A3;->r2..r5       передать 
                             A3 в индикатор
0702 120000   F     1306                                             call    resar2
                    1307                                     
0705 120000   F     1308                                             call    maform
0708 784F           1309                                             mov             r0,#abin
070A 120000   F     1310                                             call    saver2
                    1311     ;;;;;;;;
                    1312                                             
070D 7853           1313                                             mov             r0,#adec
070F 7952           1314                                             mov             r1,#abin+3      ;hex->10
0711 120000   F     1315                                             call    bindec
                    1316                                     
0714 785C           1317                                             mov             r0,#adec+9;разместить в буфер индик
                             ации
0716 7946           1318                                             mov             r1,#bufind+6
0718 7F07           1319                                             mov             r7,#7
071A E6             1320     bufdec:                         mov             a,@r0
071B 2430           1321                                             add             a,#30h
071D F7             1322                                             mov             @r1,a
071E 19             1323                                             dec             r1
071F 18             1324                                             dec             r0
0720 DFF8           1325                                             djnz    r7,bufdec
0722 7847           1326                                             mov             r0,#bufind+7
0724 762D           1327                                             mov             @r0,#2dh          ;-2..-9
0726 7840           1328                                             mov             r0,#bufind
0728 762B           1329                                             mov             @r0,#2bh
072A 300202         1330                                             jnb             znmat,nozzmi;bitznak,nozzmi
072D 762D           1331                                             mov             @r0,#2dh
072F 79AE           1332     nozzmi:                         mov             r1,#diap
0731 7848           1333                                             mov             r0,#bufind+8
0733 E7             1334                                             mov             a,@r1
0734 B40808         1335                                             cjne    a,#8,nodi8
0737 7630           1336                                             mov             @r0,#30h                 ;10-10
0739 18             1337                                             dec             r0
073A 7663           1338                                             mov             @r0,#63h;31h
073C 08             1339                                             inc             r0
073D 8012           1340                                             jmp             seegoon
073F B4090C         1341     nodi8:                          cjne    a,#9,nodis9
                    1342                                     
0742 7631           1343                                             mov             @r0,#31h           ;10-11
0744 18             1344                                             dec             r0
0745 7663           1345                                             mov             @r0,#63h;31h
                    1346                                     
0747 08             1347                                             inc             r0
0748 8007           1348                                             jmp             seegoon
                    1349     
074A 8051           1350     rnorvich:               jmp             norvich
074C 8083           1351     rno3parN:               jmp             no3parN
                    1352     
074E 2432           1353     nodis9:                         add             a,#32h
0750 F6             1354                                             mov             @r0,a;#37h;"T";
0751 08             1355     seegoon:                        inc             r0
0752 7641           1356                                             mov             @r0,#"A";"E";
0754 08             1357                                             inc             r0
0755 7600           1358                                             mov             @r0,#00h ;=feh в нач установе для п
                             оджига всех сегм
0757 08             1359                                             inc             r0;             mov             buf
                             ind+11
0758 76C0           1360                                             mov             @r0,#0c0h
                    1361                                             
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    22

                    1362     ;;;;;;;;;;;;;;;
                    1363     ;;;;;;goonind:
075A 79AF           1364                                             mov             r1,#parN        ; ??????
075C B703ED         1365                                             cjne    @r1,#3,rno3parN ;  8.11.06
                    1366                                     
                    1367             
075F                1368     seeind:                         ;;;;;;;;;;;;;
075F 784A           1369                                             mov             r0,#bufind+10
0761 E6             1370                                             mov             a,@r0
0762 300F03         1371                                             jnb             bitnul,nnnul
0765 4408           1372                                             orl             a,#08h
0767 F6             1373                                             mov             @r0,a
0768 799A           1374      nnnul:                         mov             r1,#parT
076A B70304         1375                                             cjne    @r1,#3,nsec01
076D 4410           1376                                             orl             a,#10h
076F 800C           1377                                             jmp             nsec10   ;0,1s
0771 B70204         1378      nsec01:                        cjne    @r1,#2,nsec1
0774 4420           1379                                             orl             a,#20h    ;1s
0776 8005           1380                                             jmp             nsec10
0778 B70102         1381     nsec1:                          cjne    @r1,#1,nsec10
077B 4440           1382                                             orl             a,#40h
                    1383     
                    1384     ;;;;;;;;;;;;;;;;
077D F6             1385     nsec10:                         mov             @r0,a
077E 300504         1386                                             jnb             bitavp,nobavp
0781 4404           1387                                             orl             a,#04           ;bufind+10.2
0783 F6             1388                                             mov             @r0,a
0784 F6             1389                                             mov             @r0,a   
0785 301803         1390     nobavp:                    jnb          knizm,nobitizm
0788 4402           1391                                             orl             a,#02
078A F6             1392                                              mov            @r0,a
078B                1393     nobitizm:                       
078B 301A07         1394                                             jnb             bitakt,notakt
078E C21A           1395                                             clr             bitakt
0790 534AFE         1396                                             anl             bufind+10,#0feh
0793 8005           1397                                             jmp             taktind
0795 D21A           1398     notakt:                         setb    bitakt
0797 434A01         1399                                             orl             bufind+10,#01                      
                                          
079A 120000   F     1400     taktind:                        call    ind        ;пп выдачи на индикатор
079D                1401     norvich: 
079D 789A           1402                                     mov             r0,# parT
079F 79AC           1403                                             mov             r1,#chind
07A1 B60177         1404                                             cjne    @r0,#1,rnot1in
07A4                1405     labelB:                    ;;;;;;;;;;;
                    1406                                             ;сдвиг по алгоритму чтобы посмотреть в цапе 
07A4 789F           1407                                                     mov     r0,#rez_A3+3
                    1408                             ;;;;;;;;
07A6 79BB           1409                             mov             r1,#work+3
07A8 E6             1410                             mov             a,@r0
07A9 7F07           1411                             mov             r7,#7;кол сдв вправо
07AB C3             1412     dvig3:          clr             c
07AC 13             1413                             rrc             a
07AD DFFC           1414                             djnz    r7,dvig3 ;d7,d6,d5        мл байт
07AF FA             1415                             mov             r2,a    ;сохр байт
07B0 18             1416                             dec             r0              ;rez_A3+2
07B1 E6             1417                             mov             a,@r0
07B2 C0E0           1418                             push    acc
07B4 C3             1419                             clr             c
07B5 7F01           1420                             mov             r7,#1
07B7 C3             1421     dvig2:          clr             c
07B8 33             1422                             rlc             a
07B9 DFFC           1423                             djnz    r7,dvig2 ;d12..d11       средний байт
07BB 4A             1424                             orl             a,r2
07BC F7             1425                             mov             @r1,a;сформ мл байт
07BD 19             1426                             dec             r1
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    23

07BE D0E0           1427                             pop             acc
                    1428                             
07C0 7F07           1429                             mov             r7,#7
07C2 C3             1430     dvig1:          clr             c
07C3 13             1431                             rrc             a
07C4 DFFC           1432                             djnz    r7,dvig1 ;d18     ср байт
07C6 FA             1433                             mov             r2,a   ;сохр
07C7 18             1434                             dec             r0
07C8 E6             1435                             mov             a,@r0 ;rez_A3+1
07C9 C0E0           1436                             push    acc
                    1437                     
07CB 7F01           1438                             mov             r7,#1
07CD C3             1439     dvig0:          clr             c
07CE 33             1440                             rlc             a
07CF DFFC           1441                             djnz    r7,dvig0 ;        d21..d16
07D1 4A             1442                             orl             a,r2
07D2 F7             1443                             mov             @r1,a   ; сформ средний  байт
07D3 19             1444                             dec             r1
07D4 D0E0           1445                             pop             acc       ;rez_A3+1
                    1446                             ;;;;;;;;;;;;;;
                    1447     ;                       jb              acc.7,dvm
07D6 C3             1448                             clr             c
07D7 7F07           1449                             mov             r7,#7
07D9 C3             1450     dvig4:          clr             c
07DA 13             1451                             rrc             a
07DB DFFC           1452                             djnz    r7,dvig4 ;        d22
07DD FA             1453                             mov             r2,a   ;сохр
07DE 18             1454                             dec             r0;     rez_A3
07DF E6             1455                             mov             a,@r0
                    1456                             ;;;;;
07E0 7F01           1457                             mov             r7,#1
07E2 C3             1458     vig0:           clr             c
07E3 33             1459                             rlc             a
07E4 DFFC           1460                             djnz    r7,vig0 ;         d24..d30
07E6 4A             1461                             orl             a,r2
07E7 F7             1462                             mov             @r1,a   ; сформ   байт
07E8 19             1463                             dec             r1
07E9 E6             1464                             mov             a,@r0
                    1465                             ;;;;;
07EA 20E709         1466                             jb              acc.7,dvm
07ED C3             1467                             clr             c
07EE 7F07           1468                             mov             r7,#7
07F0 C3             1469     vig4:           clr             c
07F1 13             1470                             rrc             a
07F2 DFFC           1471                             djnz    r7,vig4 ;         d
07F4 8006           1472                             jmp             endsdv
                    1473     ;;;;;;;;;;;;                                    
07F6 7F07           1474     dvm:            mov             r7,#7
07F8 D3             1475     dvig6:          setb            c
07F9 13             1476                             rrc             a
07FA DFFC           1477                             djnz    r7,dvig6 ;        d31
07FC F7             1478     endsdv:         mov             @r1,a
                    1479                                                             
                    1480      ;->work   
                    1481                             
07FD 900000   F     1482                             mov             dptr,#chzap
0800 120000   F     1483                             call     ldc_long
0803 78BB           1484                              mov            r0,#work+3
0805 120000   F     1485                             call    ladd
0808 ED             1486                             mov             a,r5
0809 F5D5           1487                             mov             DAC1L,a
                    1488                             
080B EC             1489                             mov             a,r4
080C F5D6           1490                             mov             DAC1H,a
                    1491     
                    1492                                             ;;;;;;;;;;
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    24

080E 78AD           1493                                             mov             r0,#chbuf         ;T=1
0810 B6002F         1494                                             cjne    @r0,#0,nobuf0
0813 200907         1495                                             jb              bitprd,yesprd   ;передать   A3 в бу
                             фер
0816 200A06         1496                                             jb              bitbon,yesbuf   ;записать   A3 в бу
                             фер
0819 801A           1497                                             jmp             gocikle
081B 8028           1498     rnot1in:                jmp             not1in
081D                1499     yesprd: ;передать   A3 в буфер
081D 8000           1500                                             jmp             goonT
081F                1501     yesbuf: ;записать   A3 в буфер
081F 789A           1502     goonT:                          mov             r0,#parT
0821 79AD           1503                                             mov             r1,#chbuf
0823 B60102         1504                                             cjne    @r0,#1,nott1
                    1505                                     ;       mov             @r1,#
0826 800D           1506                                             jmp             gocikle
                    1507     
0828 B60502         1508     nott1:                          cjne    @r0,#5,nott5
                    1509     
082B 8008           1510                                             jmp             gocikle
                    1511     
082D C3             1512     nott5:           clr            c
082E 799A           1513                             mov             r1,#parT
0830 7404           1514                             mov             a,#4
0832 97             1515                             subb    a,@r1
0833 500B           1516                             jnc             yestt5          ;T<5
0835 300805         1517     gocikle:        jnb             bitbuf,nofz                                     
0838 120000   F     1518                             call    z_01s    ;0,5c
083B C208           1519                             clr     bitbuf
083D 020000   F     1520     nofz:           jmp     labelA;rebyte
                    1521     
                    1522     
0840 80F3           1523     yestt5:         jmp             gocikle
                    1524     
0842 16             1525     nobuf0:                         dec             @r0
0843 80F0           1526                                             jmp             gocikle
                    1527     
                    1528     
0845 B60205         1529     not1in:                         cjne    @r0,#2,not2in
0848 7701           1530                                             mov             @r1,#1           ;T=2
084A 020000   F     1531                                             jmp     labelB
                    1532     
084D B60305         1533     not2in:                         cjne    @r0,#3,not3in
0850 7709           1534                                             mov             @r1,#9          ;T=3
0852 020000   F     1535                                             jmp     labelB
0855 7713           1536     not3in:                         mov             @r1,#19
0857 020000   F     1537                                             jmp     labelB
                    1538     
                    1539     
                    1540     ;;;;;;;;;;;3.11.06
                    1541     
                    1542     ;;коррекция 0
085A 7883           1543     KORnul:         mov             r0,#chdel
085C B60008         1544                             cjne    @r0,#0,nonuldel
                    1545                                     
                    1546                     ;       mov             a,P5       ;p5.3=1
                    1547                     ;       orl             a,#08
                    1548                     ;       mov             P5,a
                    1549                     ;       nop
                    1550                     ;       nop
                    1551                                     
                    1552                     ;       mov             a,P5              ;p5.0=0
                    1553                     ;       anl             a,#0feh
                    1554                     ;       mov             P5,a
                    1555             
085F 900000   F     1556                             mov             dptr,#kor0us
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    25

0862 120000   F     1557                             call    lospus          ;упр слово коррекции 0
0865 8013           1558                             jmp             chdelmo
                    1559     
0867                1560     nonuldel:       ;cjne   @r0,#7,no4del
0867 B60316         1561                                                     cjne    @r0,#3,no4del
                    1562                             ;рез ->AN
086A 7862           1563                             mov             r0,#rez_A;->r2..r5
086C 120000   F     1564                             call    resar2
                    1565                     ;       mov             a,reacp         ;r2..r5 &&&&&&&&&&&
                    1566                     ;               mov             r2,a
                    1567                     ;               mov             a,reacp+1
                    1568                     ;               mov             r3,a
                    1569                     ;               mov             a,reacp+2
                    1570                     ;               mov             r4,a
                    1571                     ;               mov             a,reacp+3
                    1572                     ;               mov             r5,a
                    1573                                     ;;;;;;;;;;
086F 120402         1574                             call    altof           ;r2..r5->float
0872 7884           1575                             mov             r0,#kor0_AN;->kor0_AN
0874 120000   F     1576                             call    saver2
                    1577                                     
                    1578                     ;       mov             a,P5            ;p5.0=1
                    1579                     ;       orl             a,#01
                    1580                     ;       mov             P5,a
                    1581                     ;       nop
                    1582                     ;       nop
                    1583                                     
                    1584                     ;       mov             a,P5                    ;p5.3=0 
                    1585                     ;       anl             a,#0f7h
                    1586                     ;       mov             P5,a                    
0877 120000   F     1587                             call    loadUS          ;восстан исходное упр слово
087A 7883           1588     chdelmo:        mov             r0,#chdel
087C 06             1589                             inc             @r0             ;chdel+1
087D 020000   F     1590                             jmp              rebyte
                    1591     
0880                1592     no4del:         ;cjne   @r0,#14,chdelmo
0880 B606F7         1593                                             cjne    @r0,#6,chdelmo
0883 7600           1594                             mov             @r0,#0          ;chdel
0885 7898           1595                             mov             r0,#chinkor
0887 7600           1596                             mov             @r0,#00;1;00;02;600;
0889 08             1597                             inc             r0
088A 76C8           1598                             mov             @r0,#0c8h;90h;0c8h;58h;258h
088C 120000   F     1599                             call    clmassix;сбросить массив скольз среднего
088F 020000   F     1600                             jmp              rebyte
                    1601     
                    1602     ;автокалибровка
0892                1603     autoka:  ;;  mov                r0,#chavt
                    1604                      ;;  call               chcmp
                    1605                      ;;  jz         nulavt
                    1606                     ;;   mov                r1,#chavt
                    1607                     ;;   call               chdec;chavt-1
                    1608                      ;; jmp         rebyte
0892                1609     nulavt:  ;;;;;
0892 7883           1610                             mov             r0,#chdel
0894 B6000E         1611                             cjne    @r0,#0,nndelch
0897 E585           1612                             mov   a,p5
0899 4404           1613                             orl             a,#04              ;p5.2=1
089B 00             1614                             nop
089C 00             1615                             nop
089D 543F           1616                             anl             a,#3fh          ;p5.6,p5.7=0
089F F585           1617                             mov   p5,a
08A1 06             1618                             inc             @r0
08A2 020000   F     1619                             jmp              rebyte
                    1620     
08A5 B61E3D         1621     nndelch:        cjne    @r0,#30,n4delch
                    1622                             ;pez->A+
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    26

                    1623                             ;K+=000/(A+-AN)
                    1624                             ;mov            r0,#rez_A;->r2..r5
                    1625                             ;call   resar2
08A8 E577           1626                                     mov             a,reacp         ;r2..r5 &&&&&&&&&&&
08AA FA             1627                                     mov             r2,a
08AB E578           1628                                     mov             a,reacp+1
08AD FB             1629                                     mov             r3,a
08AE E579           1630                                     mov             a,reacp+2
08B0 FC             1631                                     mov             r4,a
08B1 E57A           1632                                     mov             a,reacp+3
08B3 FD             1633                                     mov             r5,a
                    1634                                     ;;;;;;;;;;;;;;;
08B4 120402         1635                             call    altof                   ;r2..r5->float
08B7 7888           1636                             mov             r0,#rezAp;->rezAp
08B9 120000   F     1637                             call    saver2                          
08BC 7884           1638                             mov             r0,#kor0_AN;kor0_AN->r8..r11
08BE 120000   F     1639                             call    resar8                          
08C1 1201D1         1640                             call    flsub           ; r2..r5(A+-AN)
08C4 120000   F     1641                             call    move28     ;r2..r5->r8..r11
08C7 900000   F     1642                             mov             dptr,#CH2tho;000->r2..r5 float
08CA 120000   F     1643                             call    ldc_long                
08CD 1202B7         1644                             call    fldiv
08D0 EA             1645                             mov             a,r2
08D1 547F           1646                             anl             a,#7fh
08D3 FA             1647                             mov             r2,a
08D4 7890           1648                             mov             r0,#koefKp;->koefKp
08D6 120000   F     1649                             call    saver2
                    1650                       
                    1651                     ;       anl             P5,#0feh                ;p5.0=0 
08D9 E585           1652                     mov             a,P5
08DB 543B           1653                             anl             a,#3bh;acp-
08DD F585           1654                             mov             P5,a
08DF 7883           1655                             mov             r0,#chdel
08E1 06             1656                             inc             @r0                       ;ch+1
08E2 020000   F     1657                             jmp             rebyte
                    1658     
08E5 B63C3A         1659     n4delch:        cjne    @r0,#60,n8delch
                    1660                             ; pez->A-
                    1661                             ;K-=000/(A--AN)
                    1662                     ;       mov     r0,#rez_A;->r2..r5
                    1663                     ;       call    resar2
08E8 E577           1664                             mov             a,reacp         ;r2..r5 &&&&&&&&&&&
08EA FA             1665                                     mov             r2,a
08EB E578           1666                                     mov             a,reacp+1
08ED FB             1667                                     mov             r3,a
08EE E579           1668                                     mov             a,reacp+2
08F0 FC             1669                                     mov             r4,a
08F1 E57A           1670                                     mov             a,reacp+3
08F3 FD             1671                                     mov             r5,a
                    1672                                     ;;;;;;;;;;;;;;;
08F4 120402         1673                             call    altof                   ;r2..r5->float
08F7 788C           1674                             mov             r0,#rezAm;->rezAm
08F9 120000   F     1675                             call    saver2                          
08FC 7884           1676                             mov             r0,#kor0_AN;kor0_AN->r8..r11
08FE 120000   F     1677                             call    resar8                          
0901 1201D1         1678                             call    flsub                   ; r2..r5(A--AN)
0904 120000   F     1679                             call    move28                  ;r2..r5->r8..r11
0907 900000   F     1680                             mov             dptr,#CH2tho    ;000->r2..r5 float
090A 120000   F     1681                             call    ldc_long                
090D 1202B7         1682                             call    fldiv
0910 EA             1683                             mov             a,r2
0911 547F           1684                             anl             a,#7fh
0913 FA             1685                             mov             r2,a
0914 7894           1686                             mov             r0,#koefKm;->koefKm
0916 120000   F     1687                             call    saver2
                    1688                        
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    27

0919 120000   F     1689                             call    loadus
091C 7883           1690                             mov             r0,#chdel
091E 06             1691                             inc             @r0                       ;ch+1
091F 020000   F     1692                        jmp    rebyte
                    1693     
0922 B63F0F         1694     n8delch:        cjne    @r0,#63,n12delch
0925 7600           1695                             mov             @r0,#0
0927 7981           1696                             mov             r1,#chavt
0929 770C           1697                             mov             @r1,#0ch;6;1;
092B 09             1698                             inc             r1
092C 7780           1699                             mov             @r1,#80h;40h;
092E 120000   F     1700                             call   clmassix     ;сбросить массив среднего
0931 020000   F     1701                             jmp             rebyte
0934 06             1702     n12delch:       inc             @r0
0935 020000   F     1703                             jmp             rebyte
                    1704     
                    1705     ;in-r1-count
0938                1706     chdec:          ;mov            r1,#chavt               ;chavt-1
0938 E7             1707                             mov             a,@r1
0939 FC             1708                             mov             r4,a
093A 09             1709                             inc             r1
093B E7             1710                             mov             a,@r1
093C FD             1711                             mov             r5,a
093D C202           1712                             clr             rr2
093F C203           1713                             clr             rr3
0941 900000   F     1714                             mov             dptr,#ch1        
0944 120000   F     1715                             call    ldc_ltemp
0947 120000   F     1716                             call    lsub
094A ED             1717                             mov             a,r5
094B F7             1718                             mov             @r1,a
094C 19             1719                             dec             r1
094D EC             1720                             mov             a,r4
094E F7             1721                             mov             @r1,a
094F 22             1722                             ret      
                    1723     
                    1724     
                    1725     
                    1726     ;пп выдачи на индикатор 12 байт   bufind..bufind+11
0950 75E700         1727      ind:   mov             EIE2,#00H;mov   IE,#00h
0953 120000   F     1728                     call    mign
0956 7840           1729                      mov            r0,#bufind;+11
0958 7F0C           1730                      mov            r7,#12
095A C286           1731      nexin: clr             p0.6
095C E6             1732                     mov             a,@r0
095D F59B           1733                     mov             SPI0DAT,a
095F 20FBFD         1734                     jb              TXBSY,$
0962 D286           1735                     setb    p0.6
0964 120000   F     1736                     call    z_9             ;25mks
0967 08             1737                     inc             r0;dec          r0
0968 DFF0           1738                     djnz    r7,nexin
096A 75E730         1739                     mov             EIE2,#30H;mov   IE,#80h
096D 22             1740                ret
                    1741     
                    1742     
096E 7A08           1743     zapadc:   mov R2,#8
0970 D297           1744     sdv:      setb P1.7
0972 33             1745               rlc A
0973 9296           1746                     mov P1.6,C
0975 120000   F     1747                     call tim2
                    1748                                     
0978 C297           1749                     clr P1.7
097A 120000   F     1750                     call tim2
097D DAF1           1751                     djnz R2,sdv
097F D296           1752                     setb P1.6
0981 22             1753                     ret
                    1754     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    28

0982 7A08           1755     chtadc:   mov R2,#8
0984 D297           1756     sdv1:     setb P1.7
0986 120000   F     1757               call tim2
0989 C297           1758                     clr P1.7
098B A296           1759                     mov C,P1.6
098D 33             1760                     rlc A
098E 120000   F     1761                     call tim2
0991 DAF1           1762                     djnz R2,sdv1
0993 22             1763                     ret
                    1764     
0994 7E30           1765     tim:      mov R6,#30h;38h
0996 DEFE           1766     tim1:     djnz R6,tim1
0998 22             1767               ret
                    1768               
0999 7E10           1769     tim2:     mov R6,#10h;14h
099B DEFE           1770     tim3:     djnz R6,tim3
099D 22             1771               ret
                    1772     
                    1773     ;запись из acc
099E C3             1774     write_x1: clr   c
099F                1775     writeD_x1:
099F 92B1           1776                       mov P3.1,c        ;запись
09A1 F5A0           1777               mov P2,A
09A3 D2B3           1778                       setb P3.3
09A5 120000   F     1779                       call z_5
09A8 C2B3           1780                       clr P3.3
09AA 75A0FF         1781                       mov P2,#0FFh
09AD 22             1782                       ret
                    1783     
                    1784     ;чтение в acc
09AE C3             1785     read_x2:  clr   c  
09AF 92B1           1786               mov P3.1,c        ;чтение
09B1 D2B2           1787               setb P3.2
09B3 D2B3           1788                       setb P3.3
09B5 120000   F     1789                     call z_5
09B8 E5A0           1790                       mov A,P2
09BA C2B3           1791                       clr P3.3
09BC C2B2           1792                       clr P3.2
09BE 22             1793                       ret
                    1794     
                    1795     
09BF 120000   F     1796     loop:     call read_x2;x2    ;ожидание флага готовности
09C2 20E7FA         1797                       jb ACC.7,loop     ;переход на чтение, если бит А(7)=1
09C5 22             1798                        ret           ;возврат, если бит А(7)<>1
                    1799                                      
                    1800                                        
                    1801     
                    1802     
                    1803     
                    1804     ;dptr+4-приемник
                    1805     ;dptr-источник
                    1806     ;r7-кол байт  
09C6                1807     xCIKLWR:
09C6 7F04           1808                             mov             r7,#4   
09C8 E0             1809     lwrx:   movx    a,@dptr
09C9 C083           1810                             push    dph
09CB C082           1811                             push    dpl
09CD A3             1812                             inc             dptr
09CE A3             1813                             inc             dptr
09CF A3             1814                             inc             dptr
09D0 A3             1815                             inc             dptr
09D1 F0             1816                             movx    @dptr,a
09D2 D082           1817                             pop             dpl
09D4 D083           1818                             pop             dph
                    1819                             
09D6 A3             1820                             inc             dptr
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    29

09D7 DFEF           1821                             djnz    r7,lwrx
09D9 22             1822                             ret
                    1823     ;r2..r5->@dptr..@dptr+3                         
09DA EA             1824     saveIr2:                mov     a,r2
09DB F0             1825                                             movx    @dptr,a
09DC A3             1826                                             inc     dptr
09DD EB             1827                                             mov     a,r3
09DE F0             1828                                             movx    @dptr,a
09DF A3             1829                                             inc     dptr
09E0 EC             1830                                             mov     a,r4
09E1 F0             1831                                             movx    @dptr,a
09E2 A3             1832                                             inc     dptr
09E3 ED             1833                                             mov     a,r5
09E4 F0             1834                                             movx    @dptr,a
09E5 22             1835                                             ret
                    1836     ;r2..r5-> @r0..@r0+3
                    1837     
09E6 EA             1838     saver2:         mov     a,r2
09E7 F6             1839                                             mov     @r0,a
09E8 08             1840                                             inc     r0
09E9 EB             1841                                             mov     a,r3
09EA F6             1842                                             mov     @r0,a
09EB 08             1843                                             inc     r0
09EC EC             1844                                             mov     a,r4
09ED F6             1845                                             mov     @r0,a
09EE 08             1846                                             inc     r0
09EF ED             1847                                             mov     a,r5
09F0 F6             1848                                             mov     @r0,a
09F1 22             1849                                             ret 
09F2 7F50           1850     clmassix:       mov                     r7,#50h;28h
09F4 900080         1851                             mov     dptr,#MASS0        ;забить массив A нулями
09F7 7400           1852     clmax:          mov          a,#00h
09F9 F0             1853                  movx    @dptr,a
09FA A3             1854                  inc     dptr
09FB DFFA           1855                 djnz                r7,clmax                
09FD F56E           1856                  mov     chmas,a
09FF C201           1857                  clr     bitmas
0A01 22             1858                 ret
                    1859     
                    1860     ;r1-яЁшхьшъ
                    1861     ;r0-шёЄюўшъ
                    1862     ;r7-ъюы срщЄ  
0A02                1863     CIKLWR:
0A02 7F04           1864                             mov             r7,#4   
0A04 E6             1865     lwr:    mov     a,@r0
0A05 F7             1866                             mov     @r1,a
0A06 09             1867                             inc             r1
0A07 08             1868                             inc             r0
0A08 DFFA           1869                             djnz    r7,lwr
0A0A 22             1870                             ret     
                    1871     ;r2..r5-> @dptr..@dptr+3
                    1872     
0A0B 120000   F     1873     zmul:   call    maform
0A0E 120000   F     1874                     call    lmul
0A11 120000   F     1875                     call    bform
0A14 22             1876                     ret
                    1877     
0A15 120000   F     1878     zdiv:   call    maform
0A18 120000   F     1879                     call    divide
0A1B 120000   F     1880                     call    bform
0A1E 22             1881                     ret
                    1882     
0A1F EA             1883     maform: mov a,r2
0A20 33             1884             rlc a
0A21 5006           1885             jnc             fo1m
0A23 D202           1886                     setb            znmat
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    30

0A25 120000   F     1887                     call   form4
0A28 22             1888                     ret
0A29 C202           1889     fo1m:   clr             znmat
0A2B 22             1890                     ret
                    1891     
0A2C 300203         1892     bform:  jnb             znmat,fo2m
0A2F 120000   F     1893                     call    form4
0A32 22             1894     fo2m:   ret
                    1895       
                    1896     ;r2..r5 яхЁхтхёЄш т фюя ъюф
0A33 ED             1897     form4:          mov a,r5
0A34 F4             1898             cpl a
0A35 2401           1899             add a,#1
0A37 FD             1900             mov r5,a
0A38 EC             1901             mov a,r4
0A39 F4             1902             cpl a
0A3A 3400           1903             addc    a,#0
0A3C FC             1904             mov r4,a
0A3D EB             1905             mov a,r3
0A3E F4             1906                 cpl a
0A3F 3400           1907             addc    a,#0
0A41 FB             1908             mov r3,a
0A42 EA             1909             mov a,r2
0A43 F4             1910             cpl a
0A44 3400           1911             addc    a,#0
0A46 FA             1912             mov r2,a
0A47 22             1913             ret
                    1914     
0A48 120000   F     1915     zcmp:   call            maform
0A4B 120000   F     1916                     call            lcmp
0A4E C0D0           1917                     push            psw
0A50 120000   F     1918                     call    bform
0A53 D0D0           1919                     pop             psw
0A55 22             1920                     ret
                    1921     
                    1922     
                    1923     ;@r0..@r0+3->r8..r11
                    1924     
0A56 E6             1925     resar8: mov     a,@r0
0A57 F508           1926                     mov     ltemp,a
0A59 08             1927                     inc     r0
0A5A E6             1928                     mov     a,@r0
0A5B F509           1929                     mov     ltemp+1,a
0A5D 08             1930                     inc     r0
0A5E E6             1931                     mov     a,@r0
0A5F F50A           1932                     mov     ltemp+2,a
0A61 08             1933                     inc     r0
0A62 E6             1934                     mov     a,@r0
0A63 F50B           1935                     mov     ltemp+3,a
0A65 22             1936                     ret
                    1937     
                    1938     ;
                    1939     ;r0- рфЁхё _ўхщъш єяръютрюую фтюшўюую ўшёыр  
                    1940     ;r2,a фтюшўюх ўшёыю 2 срщЄр 
                    1941     ;т_ї- @r0 єяръютрюх фхё_Єшўюх ўшёыю BCD 3 срщЄр 
                    1942     ;r2 a    ўшёыю 180
                    1943     ;00 b4
                    1944     ;т_ї- mabin..mabin+2
                    1945     ;     80 01 00
                    1946      
0A66 C8             1947     cond:   xch     a,r0    
0A67 F9             1948                     mov     r1,a
0A68 C8             1949                     xch     a,r0
0A69 7C03           1950                     mov     r4,#03
0A6B 7700           1951     dcoa:   mov     @r1,#00
0A6D 09             1952                     inc     r1
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    31

0A6E DCFB           1953                     djnz    r4,dcoa
0A70 7B10           1954                     mov     r3,#10h
0A72 C3             1955     dcob:   clr     c
0A73 33             1956                     rlc     a
0A74 CA             1957                     xch     a,r2
0A75 33             1958                     rlc     a
0A76 CA             1959                     xch     a,r2
0A77 C8             1960                     xch     a,r0
0A78 F9             1961                     mov     r1,a
0A79 C8             1962                     xch     a,r0
0A7A 7C03           1963                     mov     r4,#03
0A7C FD             1964                     mov     r5,a
0A7D E7             1965     dcoc:   mov     a,@r1 
0A7E 37             1966                     addc    a,@r1
0A7F D4             1967                     da      a
0A80 F7             1968                     mov     @r1,a
0A81 09             1969                     inc     r1
0A82 DCF9           1970                     djnz    r4,dcoc
0A84 ED             1971                     mov     a,r5
0A85 4003           1972                     jc      dcod
0A87 DBE9           1973                     djnz    r3,dcob
0A89 C3             1974                     clr     c
0A8A 00             1975     dcod:   nop
0A8B 22             1976                     ret
                    1977     
0A8C 8A08           1978     move28: mov     ltemp,r2                        ;r2..r5->ltemp
0A8E 850309         1979                     mov     ltemp+1,3
0A91 85040A         1980                     mov     ltemp+2,4
0A94 85050B         1981                     mov     ltemp+3,5
0A97 22             1982                     ret
                    1983     
                    1984     ;@r0..@r0+3->r2..r5
                    1985     
0A98 E6             1986     resar2: mov     a,@r0
0A99 FA             1987                     mov     r2,a
0A9A 08             1988                     inc     r0
0A9B E6             1989                     mov     a,@r0
0A9C FB             1990                     mov     r3,a
0A9D 08             1991                     inc     r0
0A9E E6             1992                     mov     a,@r0
0A9F FC             1993                     mov     r4,a
0AA0 08             1994                     inc     r0
0AA1 E6             1995                     mov     a,@r0
0AA2 FD             1996                     mov     r5,a
0AA3 22             1997                     ret
                    1998     
                    1999     ;25mkc !!!!!!!!!!!!!!!1
0AA4 7B4B           2000     z_9:      mov R3,#4Bh      ;загрузка числа
0AA6 DBFE           2001                    djnz R3,$
0AA8 22             2002               ret
                    2003     
                    2004     ;запись   передаваемый байт в acc
                    2005     ;передача байта послед кодом старшими разрядами  вперед
0AA9 7A08           2006     write:     mov R2,#8
0AAB C3             2007                             clr  c  
0AAC C297           2008     wr1:            clr             p1.7;P1.2
0AAE 00             2009                         nop 
0AAF 33             2010                             rlc A
0AB0 9296           2011                             mov P1.6,C;P1.1,C
0AB2 120000   F     2012                        call tim2
0AB5 D297           2013                        setb P1.7;P1.2
0AB7 120000   F     2014                call tim2
0ABA DAF0           2015                       djnz R2,wr1
0ABC C296           2016                       clr P1.6;P1.1
0ABE 22             2017                      ret
                    2018     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    32

                    2019     ;принимаемый байт в acc
                    2020     ;прием байта последовательным кодом старшими разрядами вперед
0ABF 7A08           2021     read:    mov R2,#8
0AC1 C297           2022     re1:     clr P1.7;P1.2
0AC3 120000   F     2023              call tim2        ;5mks
0AC6 A294           2024                     mov C,P1.4;P1.0
0AC8 33             2025                     rlc A           
0AC9 D297           2026                     setb P1.7;P1.2
0ACB 120000   F     2027                     call tim2
0ACE DAF1           2028                     djnz R2,re1
0AD0 22             2029                     ret
                    2030     
                    2031      ;in r0-count   
                    2032     ;r10,r11-значение с котоым сравнивается счетчик
                    2033     ;r2..r5 -значение счетчика
0AD1                2034     chcmp:; mov              r0,#chavt                                      ;>=7500(1d4ch
0AD1 E6             2035                     mov                     a,@r0
0AD2 FC             2036                     mov                     r4,a
0AD3 08             2037                     inc                     r0
0AD4 E6             2038                     mov                     a,@r0
0AD5 FD             2039                     mov                     r5,a
0AD6 7B00           2040                     mov                     r3,#0
0AD8 7A00           2041                     mov                     r2,#0
0ADA 750800         2042                     mov                     r8,#0;clr                       r8
0ADD 750900         2043                     mov                     r9,#0;clr                       r9
0AE0 120000   F     2044                     call            lcmp
0AE3 22             2045                     ret
                    2046     
                    2047     
                    2048     
                    2049     
                    2050     
                    2051     
                    2052                                 
0AE4 020000   F     2053     rout6:          jmp             out6
0AE7 020000   F     2054     rlabelF:        jmp             labelF  
0AEA 020000   F     2055     rknrazr:        jmp             knrazr  
0AED 020000   F     2056     rknopt:         jmp             knopt
0AF0 020000   F     2057     rizman:         jmp             izman   
0AF3                2058     keyb1:  ;IE6 
0AF3 C219           2059                                     clr             bitmig
0AF5 C0E0           2060                                     push    acc
0AF7 C0D0           2061                                     push    psw
0AF9 C000           2062                                     push    rr0
0AFB C001           2063                                     push    rr1
0AFD C002           2064                                     push    rr2
0AFF C003           2065                                     push    rr3
0B01 C004           2066                                     push    rr4
0B03 C005           2067                                     push    rr5
0B05 C006           2068                                     push    rr6
0B07 C007           2069                                     push    rr7
0B09 75E700         2070                                     mov             EIE2,#00H
                    2071                       ;;;;;;;;;;;;;;
0B0C 120000   F     2072                                     call    z_01s;0,1s
                    2073                                     ;восстан знакоместо при мигании
                    2074                                     ;т к в соотв яч буфера индикации пишется 20h(пробел)
0B0F 78B2           2075                                     mov             r0,#marker
0B11 7440           2076                                     mov             a,#bufind
0B13 26             2077                                     add             a,@r0                   ;a=bufind+marker
0B14 F9             2078                                     mov             r1,a
0B15 A73C           2079                                     mov             @r1,savba
                    2080                                     ;;;;;;;;;;;
0B17 E5B0           2081                             mov             a,p3
0B19 20E6C8         2082                                     jb              acc.6,rout6
0B1C E5B0           2083                                     mov             a,p3
0B1E 44FF           2084                                     orl             a,#0ffh         ; p3.(5-0)<-3f
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    33

0B20 F5B0           2085                                     mov             p3,a
0B22 E5B0           2086                                     mov             a,p3
0B24 30E6BD         2087                                     jnb             acc.6,rout6             ;error
0B27 3004BD         2088                                     jnb             bitizm,rlabelF
0B2A 75B0FE         2089                                     mov             p3,#0feh                ;реж IZM
0B2D E5B0           2090                                     mov             a,p3
0B2F 30E6BE         2091                                     jnb             acc.6,rizman
0B32 75B0FD         2092                                     mov             p3,#0fdh
0B35 E5B0           2093                                     mov             a,p3
0B37 30E6B0         2094                                     jnb             acc.6,rknrazr             ;labelC
0B3A 75B0FB         2095                                     mov             p3,#0fbh
0B3D E5B0           2096                                     mov             a,p3
0B3F 30E638         2097                                     jnb             acc.6,knright           ;->
0B42 75B0F7         2098                                     mov             p3,#0f7h
0B45 E5B0           2099                                     mov             a,p3
0B47 30E6A3         2100                                     jnb             acc.6,rknopt                    ;T
0B4A 75B0EF         2101                                     mov             p3,#0efh
0B4D E5B0           2102                                mov          a,p3
0B4F 30E60B         2103                                     jnb             acc.6,pyskst                    ;pysk/stop
0B52 75B0DF         2104                                     mov             p3,#0dfh
0B55 E5B0           2105                                     mov             a,p3
0B57 30E63C         2106                                jnb          acc.6,knvich
0B5A 020000   F     2107                                     jmp             izmpaT
                    2108     
0B5D 200A05         2109     pyskst:                 jb      bitbon,bufon            ;pysk/stop
0B60 D20A           2110                                     setb    bitbon  ;уст реж буфер вкл
0B62 020000   F     2111                                     jmp             izmpaT
0B65 C20A           2112     bufon:                  clr             bitbon  ;уст реж буфер выкл
0B67 020000   F     2113                                     jmp             izmpaT
                    2114     
0B6A 79B0           2115     tizmri:                 mov             r1,#level
0B6C B70102         2116                                     cjne    @r1,#1,right2
                    2117                                     ;10s->HET
0B6F 8004           2118                                     jmp             right3
                    2119     
0B71 07             2120     right2:                 inc             @r1
0B72 120000   F     2121                                     call    lolevT
                    2122                                     ;call   loadT   ;нажата кн-> в реж Tизм 
0B75 120000   F     2123     right3:                 call    ind
0B78 806A           2124                                     jmp             izmfun
                    2125     
                    2126                             
                    2127                             
0B7A                2128     knright:        
                    2129     
0B7A 79AE           2130                                     mov             r1,#diap
                    2131                             ;перекл диапазон 1 поз вверх сбр массив
0B7C 17             2132                                     dec             @r1
0B7D B7FF04         2133                                     cjne    @r1,#0ffh,diinc
0B80 7700           2134                                     mov             @r1,#0
0B82 8060           2135                                     jmp  izmfun
0B84 120000   F     2136     diinc:                  call     clmassix
0B87 78B3           2137                                     mov             r0,#summa
0B89 120000   F     2138                                     call    clear4
0B8C 786A           2139                                     mov             r0,#rez_A0
0B8E 120000   F     2140                                     call    clear4  
0B91 120000   F     2141                                     call    loadUS
0B94 804E           2142                                      jmp  izmfun
                    2143     
0B96 200610         2144     knvich:            jb           bitvi11,onvich
0B99 C204           2145                                     clr             bitizm
0B9B D214           2146                                     setb    bitvich
                    2147                                     
0B9D 78B1           2148                                     mov             r0,#vichR
0B9F 7611           2149                                     mov             @r0,#11h;;????????or 0
                    2150                                     ;ВЫЧИСЛИТЬ
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    34

0BA1 900000   F     2151                                     mov     dptr,#teVICH
0BA4 120000   F     2152                                     call    lotext
                    2153                               ; call                ind
0BA7 807A           2154                                     jmp              viout;izmpaT
                    2155     
0BA9 C214           2156     onvich:                 clr             bitvich
0BAB 78B1           2157                                     mov             r0,#vichR
0BAD 7600           2158                                     mov             @r0,#0
0BAF 8037           2159                                     jmp              izmpaT
                    2160     ; изм упр слова при нажатии ИЗМ d3(k5 p4),d3(u5 p5)
0BB1 301820         2161     louizm:            jnb          knizm,lou
0BB4 79AE           2162                                     mov             r1,#diap
0BB6 C3             2163                                     clr             c
0BB7 7403           2164                                     mov             a,#3
0BB9 97             2165                                     subb    a,@r1
0BBA 5006           2166                                     jnc             lldi23    ;10-2..10-5
                    2167                                     ;10-6..10-11
0BBC E584           2168                                     mov             a,p4
0BBE 54F7           2169                                     anl             a,#0f7h   ;d3
0BC0 F584           2170                                     mov             p4,a
0BC2 E7             2171     lldi23:                 mov             a,@r1
0BC3 6403           2172                                     xrl             a,#3
0BC5 7002           2173                                     jnz             lldi3
0BC7 8005           2174                                     jmp             lldi2   ;10-5
0BC9 E7             2175     lldi3:                  mov             a,@r1
0BCA 6402           2176                                     xrl             a,#2            ;
0BCC 7006           2177                                     jnz             lou             
0BCE E585           2178     lldi2:                  mov             a,p5            ;10-4
0BD0 4408           2179                                     orl             a,#08
0BD2 F585           2180                                     mov             p5,a
0BD4 22             2181     lou:                    ret
                    2182                               ;;;;;;
0BD5 201807         2183     izman:                  jb              knizm,knizmon
0BD8 D218           2184                                     setb    knizm           ;уст реж ИЗМ ВКЛ
                    2185                             ;       d3(k5 p4),d3(u5 p5)заслать us
0BDA 120000   F     2186                                     call    louizm 
0BDD 8005           2187                                     jmp             izmfun
0BDF C218           2188     knizmon:                clr             knizm           ;уст реж ИЗМ ВЫКЛ
0BE1 120000   F     2189                                     call    loadUS;восстановить us
0BE4                2190     izmfun:                 
0BE4 D208           2191                                     setb    bitbuf
0BE6 800E           2192                                     jmp             labelE;;;;;;;;;;;;
                    2193                                     ;;;;;;;;;;;;;;
0BE8                2194     izmpaT:
                    2195     ;;;;;;;;;;;;;;;;;
0BE8 C3             2196                             clr             c
0BE9 79AF           2197                             mov             r1,#parN
                    2198     
0BEB 78AE           2199                             mov             r0,#diap
0BED 7406           2200                             mov             a,#6            
0BEF 96             2201                             subb    a,@r0
0BF0 5004           2202                             jnc             labelE          ;         ;10-2..10-8
                    2203                               
0BF2 7702           2204                             mov             @r1,#2          ;10-9..10-11            
0BF4 8000           2205                             jmp             labelE
                    2206     
                    2207     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0BF6 789A           2208     labelE:                 mov             r0,#parT
0BF8 793D           2209                                     mov             r1,#chkl
0BFA B60108         2210                                     cjne    @r0,#1,izmt2
0BFD 7700           2211                                     mov             @r1,#0
0BFF 09             2212                                     inc             r1
0C00 7702           2213                                     mov             @r1,#2
0C02 020000   F     2214                                     jmp             out6
0C05 B60208         2215     izmt2:                  cjne    @r0,#2,izmt3
0C08 7700           2216                                     mov             @r1,#0
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    35

0C0A 09             2217                                     inc             r1
0C0B 7714           2218                                     mov             @r1,#20
0C0D 020000   F     2219                                     jmp             out6
                    2220     
0C10 7700           2221     izmt3:                  mov             @r1,#0
0C12 09             2222                                     inc             r1
0C13 77C8           2223                                     mov             @r1,#200
0C15 020000   F     2224                                     jmp             out6
                    2225     
                    2226     
                    2227     
                    2228     
0C18                2229     knopt: ;кнопка T
0C18 C204           2230                                clr          bitizm
0C1A D210           2231                                setb         bitt2
0C1C 79B7           2232                                mov          r1,#load
0C1E 7704           2233                                mov          @r1,#4;1s
0C20 120000   F     2234                                call         loadT           ;T=1S,10S,HET,0.1S,50mS,
                    2235                                
                    2236     
0C23 793D           2237     viout:          mov             r1,#chkl
0C25 7703           2238                             mov             @r1,#03
0C27 09             2239                             inc             r1
0C28 77E8           2240                             mov             @r1,#0e8h               ;1000
0C2A 020000   F     2241                             jmp             out6
                    2242     
0C2D                2243     knrazr:          
0C2D C3             2244     labelC:          clr            c
0C2E 78AF           2245                             mov             r0,#parN
0C30 799A           2246                             mov             r1,#parT
0C32 7402           2247                             mov             a,#2
0C34 97             2248                             subb    a,@r1
0C35 40BF           2249                             jc              labelE          ;T>2
0C37 B60104         2250                             cjne    @r0,#1,noN1c
0C3A 7602           2251                             mov             @r0,#2          ;N=2
0C3C 80B8           2252                             jmp             labelE
                    2253     
0C3E B60207         2254     noN1c:          cjne    @r0,#2,not_1
0C41 B70104         2255                             cjne    @r1,#1,not_1
                    2256                     ;       clr             c
                    2257                     ;       push    rr0
                    2258                     ;       mov             r0,#diap
                    2259                     ;       mov             a,#6            ;10-2..10-8
                    2260                     ;       subb    a,@r0
                    2261                     ;       jc              not_10
                    2262                     ;       pop             rr0         
0C44 7603           2263                             mov             @r0,#3          ;N=3      ;10-2..10-8
0C46 80AE           2264                             jmp             labelE
0C48                2265     not_10:         ;pop            rr0
0C48 7601           2266     not_1:          mov             @r0,#1                          ;N=1
0C4A 80AA           2267                             jmp     labelE
                    2268     
0C4C 020000   F     2269     rtizmri:        jmp             tizmri
0C4F                2270     labelf:                 
0C4F 301024         2271                             jnb             bitt2,nofizm
0C52 75B0FB         2272                        mov          p3,#0fbh
0C55 E5B0           2273                        mov          a,p3
0C57 20E60F         2274                        jb           acc.6,outF
0C5A 79B7           2275                        mov          r1,#load;parT
0C5C B70503         2276                        cjne         @r1,#5,noft1
                    2277                        ;t=10s
0C5F 020000   F     2278                        jmp          out6;ft1izm
                    2279     
0C62 07             2280     noft1:     inc          @r1;dec         @r1
0C63 120000   F     2281     ft1izm:         call    loadT;в буфер 2 записать текст с соотв load(parT)
                    2282                             ;call   ind
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    36

0C66 020000   F     2283                     jmp             out6;??????????????/
                    2284     
                    2285                             ;увеличить счетчик задержки клавиатуры
0C69 783D           2286     outF:           mov             r0,#chkl
0C6B 7627           2287                             mov             @r0,#27h
0C6D 08             2288                             inc             r0
0C6E 7610           2289                             mov             @r0,#10h
0C70 020000   F     2290                             jmp             out6;out7
                    2291     
0C73 020000   F     2292     noviR1:         jmp             noviR
0C76 3014FA         2293     nofizm:         jnb             bitvich,noviR1
0C79 78B1           2294                             mov             r0,#vichR
0C7B B61117         2295                             cjne    @r0,#11h,no11v6
0C7E 7612           2296                             mov             @r0,#12h                ;11= вычислить
0C80 900000   F     2297     vvrr6:          mov             dptr,#teIZMK    ;       изм конст;teVICH
0C83 120000   F     2298                             call    lotext
0C86 80E1           2299                             jmp             outF
                    2300             
                    2301                     
0C88 B61163         2302     nor13:          cjne    @r0,#11h,nor11
0C8B 7612           2303                             mov             @r0,#12h
0C8D 900000   F     2304                             mov             dptr,#teIZMK    ;       изм конст
0C90 120000   F     2305                         call        lotext             
0C93 80D4           2306                             jmp             outF
                    2307     
0C95 B6120A         2308     no11v6:         cjne    @r0,#12h,no12v6
0C98 7613           2309                             mov             @r0,#13h
0C9A 900000   F     2310                             mov             dptr,#teOUT
0C9D 120000   F     2311                             call    lotext
0CA0 80C7           2312                             jmp             outF
                    2313                     
0CA2 B6130A         2314     no12v6:         cjne    @r0,#13h,no13v6
0CA5 7611           2315                             mov             @r0,#11h
0CA7 900000   F     2316                             mov             dptr,#teVICH
0CAA 120000   F     2317                             call    lotext
0CAD 80BA           2318                             jmp             outF
                    2319     
                    2320     
0CAF 75B0FB         2321     no13v6:         mov             p3,#0fbh
0CB2 E5B0           2322                             mov             a,p3
0CB4 20E612         2323                             jb              acc.6,chanZ
                    2324                     ;clr            bitmig
0CB7 78B2           2325                             mov             r0,#marker      
0CB9 B60905         2326                             cjne    @r0,#9,mark0_8          ;курсор справа ?
0CBC E53A           2327                             mov             a,movleft
0CBE F6             2328                             mov             @r0,a                           ; уст курсор в кр л
                             евую поз+1
0CBF 80A8           2329                             jmp             outF
                    2330     
0CC1 06             2331     mark0_8:        inc             @r0             ;       сдвинуть курсор вправо на 1
0CC2 C219           2332                             clr             bitmig
0CC4 B60A00         2333                             cjne    @r0,#10,outma
0CC7 80A0           2334     outma:          jmp             outF
                    2335     
0CC9 75B0FE         2336     chanZ:          mov             p3,#0feh
0CCC E5B0           2337                             mov             a,p3
0CCE 20E60F         2338                             jb              acc.6,chanma
                    2339                             ;изм знак в старшем разряде на противоположн
0CD1 E543           2340                             mov             a,bufind+3
0CD3 B42B05         2341                             cjne            a,#2bh,noplus
0CD6 75432D         2342                             mov                     bufind+3,#2dh           ;+->-   
0CD9 808E           2343                             jmp             outF
0CDB                2344     noplus:
0CDB 75432B         2345                             mov                     bufind+3,#2bh           ;-/+-
0CDE 8089           2346                             jmp             outF
0CE0 75B0FD         2347     chanma:         mov             p3,#0fdh
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    37

0CE3 E5B0           2348                             mov             a,p3
0CE5 20E681         2349                             jb              acc.6,outF;labelL1
                    2350                             ;clr            bitmig
0CE8 120000   F     2351     labelL1:        call    vvchif  ;увеличить цифру 
                    2352     
0CEB 020000   F     2353                             jmp             outF
                    2354                     
0CEE                2355     nor11:          ;       выход
0CEE 7613           2356                     mov             @r0,#13h  ;12->13
0CF0 900000   F     2357                     mov             dptr,#teOUT
                    2358     ;               jmp             vi1113
                    2359     
                    2360     
                    2361     
0CF3 C206           2362     yesviR:         clr             bitvi11;????????/
0CF5 200C77         2363                             jb              bmem11,labelL
0CF8 020000   F     2364                             jmp             out6;???????//
0CFB 30112A         2365     noviR:          jnb             bitmenu,nbimenu
0CFE 75B0FB         2366                             mov             p3,#0fbh; реж кн меню ->
0D01 20B610         2367                             jb              p3.6,rnorim6
0D04 79B0           2368                             mov             r1,#level
0D06 B7000E         2369                             cjne    @r1,#0,rimen6
0D09 900000   F     2370                             mov             dptr,#teKALIB
0D0C 120000   F     2371                             call    lotext
0D0F 7701           2372                             mov             @r1,#1
0D11 020000   F     2373                             jmp             out6
                    2374     
0D14 020000   F     2375     rnorim6:                jmp             norim6
                    2376     
0D17 900000   F     2377     rimen6:         mov             dptr,#teTEsT
0D1A 120000   F     2378                             call    lotext
0D1D 7700           2379                             mov             @r1,#0
0D1F 020000   F     2380                             jmp             out6
                    2381     
0D22 020000   F     2382     moutF:          jmp             outF
                    2383     
0D25 020000   F     2384     rnnmemb:        jmp             nnmemb
0D28 300BFA         2385     nbimenu:        jnb             bitmem,rnnmemb
0D2B 79B0           2386                             mov             r1,#level
0D2D B71113         2387                        cjne         @r1,#11h,nomem11
                    2388                        
0D30 75B0FB         2389                        mov          p3,#0fbh
0D33 E5B0           2390                        mov          a,p3
0D35 20E6EA         2391                        jb           acc.6,moutF
0D38 7712           2392                        mov          @r1,#12h
0D3A 900000   F     2393                        mov          dptr,#teWR
0D3D 120000   F     2394                        call         lotext
0D40 020000   F     2395                        jmp          outF
                    2396     
0D43 B71213         2397     nomem11:   cjne         @r1,#12h,nomem12
0D46 75B0FB         2398                             mov             p3,#0fbh
0D49 E5B0           2399                        mov          a,p3
0D4B 20E6D4         2400                        jb           acc.6,moutF
0D4E 7713           2401                        mov          @r1,#13h
0D50 900000   F     2402                        mov          dptr,#teLIST
0D53 120000   F     2403                        call         lotext
0D56 020000   F     2404                        jmp          outF
0D59 B71313         2405     nomem12:         cjne           @r1,#13h,labelL
0D5C 75B0FB         2406                             mov             p3,#0fbh
0D5F E5B0           2407                        mov          a,p3
0D61 20E6BE         2408                        jb           acc.6,moutF
0D64 7711           2409                        mov          @r1,#11h
0D66 900000   F     2410                        mov          dptr,#teCLE
0D69 120000   F     2411                        call         lotext
0D6C 020000   F     2412                          jmp                outF
                    2413     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    38

0D6F 78B0           2414     labelL:         mov             r0,#level
0D71 B6211B         2415                             cjne    @r0,#21h,labl21
0D74 75B0FB         2416                             mov             p3,#0fbh
0D77 E5B0           2417                             mov             a,p3
0D79 20E610         2418                             jb              acc.6,loutF
0D7C B62108         2419                             cjne    @r0,#21h,lal22
0D7F 7622           2420                             mov             @r0,#22h
                    2421                             ;БЛОК
0D81 120000   F     2422                             call    lotext
0D84 020000   F     2423                             jmp             outF
0D87 7621           2424     lal22:          mov             @r0,#21h
                    2425                             ;ПОЛНАЯ
0D89 120000   F     2426                             call    lotext
0D8C 020000   F     2427     loutf:          jmp             outF
                    2428     
0D8F B6211B         2429     labl21:    cjne @r0,#21h,nolev1
0D92 75B0FB         2430                             mov             p3,#0fbh
0D95 E5B0           2431                             mov             a,p3
0D97 20E6F2         2432                             jb              acc.6,loutF
0D9A B62108         2433                             cjne    @r0,#21h,labl22
0D9D 7622           2434                             mov             @r0,#22h
                    2435                             ;БЛОК
0D9F 120000   F     2436                             call    lotext
0DA2 020000   F     2437                             jmp             outF
0DA5 7621           2438     labl22:         mov             @r0,#21h
                    2439                             ;ПОЛНАЯ
0DA7 120000   F     2440                             call    lotext
0DAA 020000   F     2441                             jmp             outF
                    2442                      
0DAD B6231A         2443     nolev1:         cjne    @r0,#23h,go31l
0DB0 75B0FB         2444     rigblo:         mov             p3,#0fbh
0DB3 20B61E         2445                             jb              p3.6,llev2
0DB6                2446     labL2:    ; mov         r1,#marker;а  уст курсор в правую позицию 
0DB6 78B2           2447                       mov           r0,#marker      ;курсор справа  ?
0DB8 E53B           2448                             mov             a,movrig
0DBA C3             2449                             clr             c
0DBB 96             2450                             subb    a,@r0
0DBC 6006           2451                             jz         equ1l
0DBE E53B           2452                             mov             a,movrig;уст в правую позицию
0DC0 F6             2453                             mov             @r0,a
0DC1 020000   F     2454                             jmp             outF                                             
0DC4 E53A           2455     equ1l:          mov             a,movleft;уст в левую позицию
0DC6 F6             2456                             mov             @r0,a   
0DC7 020000   F     2457                             jmp             outF
                    2458                     
                    2459     
0DCA B63102         2460     go31l:          cjne    @r0,#31h,go41l
0DCD 80E1           2461                             jmp             rigblo
0DCF B6410B         2462     go41l:          cjne    @r0,#41h,norig2
0DD2 80DC           2463                             jmp             rigblo
                    2464     
0DD4 75B0FD         2465     llev2:          mov             p3,#0fdh
0DD7 20B6B2         2466                             jb              p3.6,loutF
0DDA 020000   F     2467                             jmp             labelL1
                    2468     
0DDD C3             2469     norig2:    clr          c               ;32,33,34,42
0DDE 7431           2470                             mov             a,#31h
0DE0 96             2471                             subb    a,@r0
0DE1 50A9           2472                             jnc             loutF
0DE3 75B0FB         2473     rigblok:        mov             p3,#0fbh  ;32,33,34,42
0DE6 20B614         2474                             jb              p3.6,lev2go
0DE9 78B2           2475     labelN:         mov             r0,#marker      ;курсор справа  ?
0DEB E53B           2476                             mov             a,movrig
0DED C3             2477                             clr             c
0DEE 96             2478                             subb    a,@r0
0DEF 7006           2479                             jnz        noequ1
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    39

0DF1 E53A           2480                             mov             a,movleft;уст в крайнюю левую позицию
0DF3 F6             2481                             mov             @r0,a
0DF4 020000   F     2482                             jmp             outF
0DF7 120000   F     2483     noequ1:         call    marri;уст сдвиг в правую        позицию
0DFA 020000   F     2484                             jmp             outF
0DFD 75B0FD         2485     lev2go:         mov             p3,#0fdh
0E00 30B603         2486                             jnb             p3.6,rlabelL1
0E03 020000   F     2487                             jmp             outF
                    2488     
0E06 020000   F     2489     rlabelL1:       jmp             labelL1
0E09                2490     nnmemb:
0E09                2491     norim6:    ;kn menu
0E09 D007           2492     out6:                   pop             rr7     
0E0B D006           2493                                     pop             rr6
0E0D D005           2494                                     pop             rr5
0E0F D004           2495                                     pop             rr4
0E11 D003           2496                                     pop             rr3
0E13 D002           2497                                     pop             rr2
0E15 D001           2498                                     pop             rr1                             
0E17 D000           2499                                     pop             rr0
0E19 D0D0           2500                                     pop             psw
0E1B D0E0           2501                                     pop             acc
0E1D 75E730         2502                                mov          EIE2,#30H
0E20 E5AD           2503                                mov          a,P3IF
0E22 54BF           2504                                     anl             a,#0bfh
0E24 F5AD           2505                                     mov             P3IF,a
0E26 75B0C0         2506                                     mov             P3,#0c0h
0E29 32             2507                             reti
                    2508     
0E2A 020000   F     2509      rknMEM:                        jmp             knMEM
0E2D 020000   F     2510     knKMP:             jmp          out7
0E30 020000   F     2511     rout7:                  jmp             out7    
0E33 020000   F     2512     rlabelH:                jmp             labelH
0E36 020000   F     2513     rknNUL:         jmp             knNUL
0E39 020000   F     2514     rknleft:                jmp             knleft
0E3C                2515     keyb2:  ;IE7
0E3C 75E700         2516                                     mov             EIE2,#00H
0E3F C0E0           2517                                     push    acc
0E41 C0D0           2518                                     push    psw
0E43 C000           2519                                     push    rr0
0E45 C001           2520                                     push    rr1
0E47 C002           2521                                     push    rr2
0E49 C003           2522                                     push    rr3
0E4B C004           2523                                     push    rr4
0E4D C005           2524                                     push    rr5
0E4F C006           2525                                     push    rr6
0E51 C007           2526                                     push    rr7
                    2527                                     ;mov            IE,#00h
                    2528                       ;;;;;;;;;;;;;;
0E53 120000   F     2529                               call  z_01s   ;0,1s
                    2530                               ;восстан знакоместо при мигании
                    2531                               ;т к в соотв яч буфера индикации пишется 20h(пробел)
0E56 78B2           2532                                     mov             r0,#marker
0E58 7440           2533                                     mov             a,#bufind
0E5A 26             2534                                     add             a,@r0                   ;a=bufind+marker
0E5B F9             2535                                     mov             r1,a
0E5C A73C           2536                                     mov             @r1,savba
                    2537                                     ;;;;;;;;;;;
0E5E E5B0           2538                             mov             a,p3
0E60 20E7CD         2539                                     jb              acc.7,rout7
0E63 E5B0           2540                                     mov             a,p3
0E65 74FF           2541                                     mov             a,#0ffh         ; p3.(5-0)<-3f
0E67 F5B0           2542                                     mov             p3,a
0E69 E5B0           2543                                     mov             a,p3
0E6B 30E7C2         2544                                     jnb             acc.7,rout7             ;error
0E6E 3004C2         2545                                     jnb             bitizm,rlabelH
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    40

0E71 75B0FE         2546                                     mov             p3,#0feh                ;реж IZM
0E74 E5B0           2547                                     mov             a,p3
0E76 30E7BD         2548                                     jnb             acc.7,rknNUL
0E79 75B0FD         2549                                     mov             p3,#0fdh
0E7C E5B0           2550                                     mov             a,p3
0E7E 30E7AC         2551                                     jnb             acc.7,knKMP
0E81 75B0FB         2552                                     mov             p3,#0fbh
0E84 E5B0           2553                                     mov             a,p3
0E86 30E7B0         2554                                     jnb             acc.7,rknleft
0E89 75B0F7         2555                                     mov             p3,#0f7h
0E8C E5B0           2556                                     mov             a,p3
0E8E 30E74E         2557                                     jnb             acc.7,knAVP
0E91 75B0EF         2558                                 mov         p3,#0efh
0E94 E5B0           2559                                     mov             a,p3
0E96 30E791         2560                                     jnb             acc.7,rknMEM
0E99 75B0DF         2561                                     mov             p3,#0dfh
0E9C E5B0           2562                                     mov             a,p3    
0E9E 30E72E         2563                                     jnb             acc.7,knmenu
0EA1                2564     an_t7:             ;;;;;;;;;;;;
                    2565                     
0EA1 C3             2566                             clr             c
0EA2 79AF           2567                             mov             r1,#parN
                    2568     
0EA4 78AE           2569                             mov             r0,#diap
0EA6 7406           2570                             mov             a,#6            
0EA8 96             2571                             subb    a,@r0
0EA9 5002           2572                             jnc             goto7           ;         ;10-2..10-8
                    2573                               
0EAB 7702           2574                             mov             @r1,#2          ;10-9..10-11            
                    2575                             
                    2576                             ;;;;;;;;;;;;
0EAD 799A           2577     goto7:                  mov             r1,#parT
0EAF 783D           2578                                     mov             r0,#chkl
0EB1 B70108         2579                                     cjne    @r1,#1,not1_7
0EB4 7600           2580                                     mov             @r0,#00
0EB6 08             2581                                     inc             r0
0EB7 7602           2582                                     mov             @r0,#2
0EB9 020000   F     2583                                     jmp             out7
                    2584                             
                    2585     
0EBC B70208         2586     not1_7:                 cjne    @r1,#2,not2_7
0EBF 760E           2587                                     mov             @r0,#0eh;00
0EC1 08             2588                                     inc             r0
0EC2 7638           2589                                     mov             @r0,#38h;20
0EC4 020000   F     2590                                     jmp             out7
0EC7 7600           2591     not2_7:                 mov             @r0,#00
0EC9 08             2592                                     inc             r0
0ECA 76C8           2593                                     mov             @r0,#200
0ECC 020000   F     2594                                     jmp             out7
                    2595     
                    2596     
0ECF C204           2597     knmenu:                  clr            bitizm          ;off IZM
0ED1 D211           2598                                     setb            bitmenu
0ED3 900000   F     2599                                     mov             dptr,#teMENU    ;в буф2 записать ТЕСТ-ИЗМЕР
0ED6 120000   F     2600                                     call    lotext
0ED9 120000   F     2601                                     call    ind;???????/
0EDC 020000   F     2602                                     jmp             onmem11
                    2603     
0EDF 200505         2604     knAVP:                  jb              bitavp,meavp
0EE2 D205           2605                                     setb    bitavp
0EE4 020000   F     2606                                     jmp             onmem11
0EE7 C205           2607     meavp:                  clr             bitavp
0EE9 020000   F     2608                                     jmp             onmem11
                    2609     
0EEC 79AE           2610     knleft:            mov          r1,#diap
0EEE 07             2611                                     inc             @r1             ;перекл диапазон 1 поз в сб
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    41

                             р массив
0EEF B70A03         2612                                     cjne    @r1,#0ah,nodi6
0EF2 17             2613                                     dec             @r1
0EF3 80AC           2614                                     jmp             an_t7
                    2615     
0EF5                2616     nodi6:             ;    cjne    @r1,#0,an_t7
0EF5 120000   F     2617                                      call    clmassix
0EF8 78B3           2618                                     mov             r0,#summa
0EFA 120000   F     2619                                     call    clear4  
0EFD 786A           2620                                     mov             r0,#rez_A0
0EFF 120000   F     2621                                     call    clear4  
0F02 120000   F     2622                                     call    loadUS
0F05 809A           2623                                jmp          an_t7
                    2624     
0F07 200F0E         2625     knNUL:                  jb              bitnul,ybnul
0F0A D20F           2626                                     setb    bitnul
0F0C 789C           2627                                     mov             r0,#rez_A3      ;A3
0F0E 120000   F     2628                                     call    resar2
0F11 786A           2629                                     mov             r0,#rez_A0      
0F13 120000   F     2630                                     call    saver2;A0<-A3
0F16 8095           2631                                     jmp             goto7;an_t7
                    2632     
0F18 C20F           2633     ybnul:                  clr             bitnul
0F1A 900000   F     2634                                      mov    DPTR,#ch0 
0F1D 120000   F     2635                                     CALL   ldc_long          ; r2..r5 <-- 0
0F20 786A           2636                                     mov             r0,#rez_A0      ;A0=0
0F22 120000   F     2637                                     call    saver2
0F25 8086           2638                                     jmp             goto7;an_t7
                    2639     
0F27 30101E         2640     labelH:                 jnb             bitt2,nolah
0F2A 75B0FB         2641                                     mov             p3,#0fbh   ;вход в режим изм Т
0F2D 79B7           2642                                     mov             r1,#load;parT
0F2F 20B70D         2643                                     jb              p3.7,rhnot1
0F32 B70003         2644                                     cjne    @r1,#0,inct;
0F35 020000   F     2645                                     jmp             out7;hyest6
0F38 17             2646     inct:                   dec             @r1                     ;Tизм+1
                    2647                             
0F39 120000   F     2648                             call    loadT   ;в буфер2 записать текст  в соотв с     Tизм
0F3C                2649     hnot2:          ;       call    ind
0F3C 020000   F     2650                                     jmp             out7
                    2651     
0F3F 020000   F     2652      rhnot1:                jmp             hnot1
                    2653      ;rnoviR:       jmp             noviR
0F42 020000   F     2654      rlabelK:       jmp             labelK
0F45 020000   F     2655      rlabelI:       jmp             labelI          
                    2656      ;;;;;;;;;;;;;;;;;;;
0F48 3014F7         2657     nolah:          jnb             bitvich,rlabelK 
                    2658                             ;;;;;;
                    2659                             ;увеличить счетчик задержки клавиатуры
                    2660                     ;;              mov             r0,#chkl
                    2661                     ;;              mov             @r0,#27h
                    2662                     ;;              inc             r0
                    2663                     ;;              mov             @r0,#10h
                    2664                             ;;;;;;
                    2665     
0F4B 78B1           2666                             mov             r0,#vichR
0F4D B6115D         2667                             cjne    @r0,#11h,hnor11;rlabelI;;
0F50 75B0FB         2668                             mov             p3,#0fbh   ;<-
0F53 20B722         2669                             jb              p3.7,noh37;routF
0F56 B6110B         2670                     cjne    @r0,#11h,hr12
0F59 7613           2671                             mov             @r0,#13h        ;11= вычислить
0F5B 900000   F     2672                             mov             dptr,#teOUT;teVICH
0F5E 120000   F     2673     hvi1113:        call    lotext  ;в буфер 2 записать текст в соотв с состоянием
0F61 020000   F     2674                             jmp             goto7;outF
0F64 B61207         2675     hr12:           cjne    @r0,#12h,hnor12
0F67 7611           2676     lovich:         mov             @r0,#11h
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    42

0F69 900000   F     2677                             mov             dptr,#teVICH
0F6C 80F0           2678                             jmp             hvi1113         
0F6E B6133C         2679     hnor12:         cjne    @r0,#13h,hnor11
0F71 7612           2680     loizmk:         mov             @r0,#12h
0F73 900000   F     2681                             mov             dptr,#teIZMK    ;       изм конст
                    2682                                        
0F76 80E6           2683                             jmp             hvi1113
                    2684     
0F78 75B0F7         2685     noh37:          mov             p3,#0f7h
0F7B 20B707         2686                             jb              p3.7,routF
0F7E B61139         2687                             cjne    @r0,#11h,vvizko
0F81 D214           2688                             setb    bitvich    ;нажат ввод ВЫЧИСЛИТЬ
0F83 D204           2689                             setb    bitizm
0F85 020000   F     2690     routF:          jmp             goto7;outF
                    2691     ;
0F88 B6120A         2692     norr11:         cjne    @r0,#12h,norr12
0F8B 75B0FB         2693                             mov             p3,#0fbh   ;<-
0F8E 20B7E7         2694                             jb              p3.7,noh37;routF
0F91 760B           2695                             mov             @r0,#11;12->11
0F93 80D2           2696                             jmp             lovich
                    2697     
0F95 B613AD         2698     norr12:         cjne    @r0,#13h,rlabelI
0F98 75B0FB         2699                             mov             p3,#0fbh   ;<-
0F9B 20B7DA         2700                             jb              p3.7,noh37
0F9E 7612           2701                             mov             @r0,#12h
0FA0 80CF           2702                             jmp             loizmk
                    2703                             ;;;;
0FA2 C214           2704     clrvich:                clr             bitvich
0FA4 D204           2705                             setb    bitizm
0FA6 A8B2           2706                             mov             r0,marker
0FA8 76FF           2707                             mov             @r0,#0ffh
0FAA 020000   F     2708                              jmp    goto7;  routF
                    2709     
                    2710      ;ввод изм конст
0FAD B612E5         2711     hnor11:         cjne    @r0,#12h,norr12;clrvich
0FB0 75B0FB         2712                              mov            p3,#0fbh   
0FB3 20B7C2         2713                             jb              p3.7,noh37;lovich;;изм конст <-  выч
0FB6 7611           2714                             mov             @r0,#11h
0FB8 80AD           2715                             jmp             lovich
                    2716     
0FBA 78B1           2717     vvizko:         mov             r0,#vichR
0FBC E6             2718                             mov             a,@r0
                    2719                     ;       cjne    @r0,#12h,clrvich
0FBD B412E2         2720                             cjne    a,#12h,clrvich
0FC0 7621           2721                             mov             @r0,#21h                ;изм конст->a=+0000     (vv
                             od)
0FC2 78B2           2722                             mov             r0,#marker
0FC4 7603           2723                             mov             @r0,#3;9
0FC6 753A03         2724                             mov             movleft,#3
0FC9 900000   F     2725                             mov             dptr,#teAequ0
0FCC 120000   F     2726                             call    lotext
0FCF 020000   F     2727                             jmp             goto7;routF
                    2728     ;hnor13:                jmp             hnor12          
0FD2 B6210C         2729     izchi:          cjne    @r0,#21h,tlabelI
                    2730     ;<- при вводе цифр А                            
                    2731                     ;        mov            p3,#0fbh   
                    2732                     ;       jnb             p3.7,li21
                    2733             ;clr            bitmig
0FD5 78B2           2734                             mov             r0,#marker
0FD7 16             2735                             dec             @r0
0FD8 B60201         2736                             cjne    @r0,#2,li21
0FDB 06             2737                             inc             @r0;marker=3 +/-
0FDC C219           2738     li21:           clr             bitmig
0FDE 020000   F     2739                             jmp             goto7;outF
                    2740     
0FE1 020000   F     2741     tlabelI:        jmp             labelI
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    43

                    2742     
                    2743     ;                       load    0 1 2 3 4 5             
0FE4 06050403       2744     sootv:          db              6,5,4,3,2,1;parT
0FE8 0201                    
                    2745     ;
                    2746     
                    2747     ;нажата кн ввод при наборе Т
0FEA 75B0F7         2748     hnot1:                  mov             p3,#0f7h
0FED 20B795         2749                                     jb              p3.7,routF;out7
0FF0 B70541         2750                                     cjne    @r1,#5,nohnot1  ;r1=load
0FF3 794A           2751                                     mov             r1,#bufind+10;в буфере 1 зажечь 10s
0FF5 E7             2752                                     mov             a,@r1
0FF6 4440           2753                                     orl             a,#40h;.6
0FF8 F7             2754                                     mov             @r1,a
0FF9 8000           2755                                     jmp             loadb
                    2756                                     
                    2757                                     
0FFB 789A           2758     loadB:                  mov             r0,#parT
0FFD 900000   F     2759                                     mov             dptr,#sootv
1000 79B7           2760                                     mov             r1,#load                
1002 E7             2761                                     mov             a,@r1;load
1003 93             2762                                     movc    a,@a+dptr
1004 F6             2763                                     mov             @r0,a
1005 120000   F     2764                                     call            loab12  ;установить B1,B2 в соотв с Tизм   
                             ??????
                    2765                                      ;r4=b1 r5=b2
1008 120000   F     2766                                     call    iniacp;инициализация АЦП
100B 120000   F     2767                                     call    loadUS
100E 120000   F     2768                                     call    clmassix        
1011 D204           2769                                     setb    bitizm
1013 C210           2770                                     clr             bitt2
1015 C3             2771                                      clr            c
1016 789A           2772                                  mov                r0,#parT
1018 79AF           2773                                      mov            r1,#parN
101A 7402           2774                                  mov                a,#2
101C 96             2775                                 subb                a,@r0
101D 5005           2776                                 jnc                 loadB2
101F 7701           2777                                     mov             @r1,#1;N=1         ;T>=2
1021 020000   F     2778     bout7:                  jmp             goto7;out7
                    2779     
1024 B702FA         2780     loadB2:                 cjne    @r1,#2,bout7
1027 7702           2781                                     mov             @r1,#2;N=2
1029 020000   F     2782                                     jmp             goto7;out7
102C                2783     nohnot2:                ;в буфере 1 зажечь <=0,1s
102C 794A           2784                                     mov             r1,#bufind+10
102E E7             2785                                     mov             a,@r1
102F 4410           2786                                     orl             a,#10h;.4
1031 F7             2787                                     mov             @r1,a
1032 80C7           2788                                     jmp             loadB
1034 B704F5         2789     nohnot1:                cjne    @r1,#4,nohnot2  ;ввод кнопка Т  
1037 794A           2790                                     mov             r1,#bufind+10;в буфере 1 зажечь 1s
1039 E7             2791                                     mov             a,@r1
103A 4420           2792                                     orl             a,#20h;.5
103C F7             2793                                     mov             @r1,a
103D 80BC           2794                                     jmp             loadB
                    2795     
                    2796     ;кнопка ПАМЯТЬ
103F C204           2797     knMEM:                  clr             bitizm          ;off IZM
1041 900000   F     2798                                     mov             dptr,#teCLE
1044 120000   F     2799                                     call    lotext    ;в буф2 записать ОЧИСТКА
1047 D20B           2800                                     setb    bitmem     ;нажата кнопка ПАМЯТЬ
1049 78B0           2801                                     mov             r0,#level
104B 7611           2802                                     mov             @r0,#11h
104D 783D           2803     onmem11:                mov             r0,#chkl
104F 7603           2804                                     mov             @r0,#03
1051 08             2805                                     inc             r0
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    44

1052 76E8           2806                                     mov             @r0,#0e8h               ;1000
1054 020000   F     2807                                     jmp             goto7;out7
                    2808     
1057 020000   F     2809     rnomemk:                jmp             nomemk          ;
105A                2810     labelK:
                    2811     ;;;;;;;;;;;;
                    2812     ;                               jnb             bitmenu,nomenu
                    2813     ;                               mov             p3,#0fbh
                    2814     ;                               mov             r1,#level
                    2815     ;                               jb              p3.7,vvmenu
                    2816                     
                    2817     
                    2818     ;nomenu:                        mov             p3,#0f7h;0efh;0f7h;vvod
                    2819     ;                               jb              p3.7,novvmn
                    2820     ;vvmenu:;ввод меню  (тест-калибровка)
                    2821     ;                               mov             dptr,#teTEST;тест
                    2822     ;                               call    lotext
                    2823     ;                               mov             @r1,#2
                    2824     ;                               jmp             out7
                    2825     ;novvmn:                        mov             p3,#0efh
                    2826     ;                               jb              p3.7,rimenu
                    2827                             
                    2828     ;                               jmp             out7
                    2829     
                    2830      ;rimenu:
                    2831     ;;;;;;;;;;;;
105A 300BFA         2832                               jnb           bitmem,rnomemk
105D 78B0           2833                               mov           r0,#level
105F B61132         2834                               cjne          @r0,#11h,klev1;nome11
1062 75B0FB         2835     lefmem11:         mov           p3,#0fbh
1065 E5B0           2836                               mov           a,p3
1067 20E70E         2837                               jb            acc.7,rkvvod0
106A B6110E         2838                               cjne          @r0,#11h,locle          ;<-memory
106D 7613           2839                               mov           @r0,#13h
106F 900000   F     2840     lolist:           mov           dptr,#teLIST
1072 120000   F     2841                               call          lotext           ;ПРОСМОТР
1075 020000   F     2842                               jmp   goto7;  outF
                    2843     
1078 020000   F     2844     rkvvod0:        jmp             kvvod0
                    2845     
                    2846     
107B B6120B         2847     locle:          cjne            @r0,#12h,lowr           ;<-memory
107E 7611           2848                               mov           @r0,#11h                   ;ОЧИСТКА
1080 900000   F     2849     loadcle:          mov           dptr,#teCLE
1083 120000   F     2850                               call          lotext
1086 020000   F     2851                               jmp           goto7;outF
1089 7612           2852      lowr:          mov             @r0,#12h
108B 900000   F     2853      lowr1:         mov             dptr,#teWR                ;ЗАПИСЬ
108E 120000   F     2854                             call    lotext
1091 020000   F     2855                             jmp             goto7;outF
1094 B61202         2856      klev1:          cjne   @r0,#12h,klev2
1097 80C9           2857                             jmp             lefmem11
1099 B61302         2858     klev2:           cjne   @r0,#13h,klev22   ;11-13 нет
109C 80C4           2859                             jmp             lefmem11
                    2860     
                    2861     ;<- vvod на более низких уровнях
109E B62114         2862     klev22:         cjne    @r0,#21h,klev21
10A1 75B0FB         2863     lev220:         mov             p3,#0fbh
10A4 20B72C         2864                             jb              p3.7,kgo23
10A7 B6213D         2865                             cjne    @r0,#21h,kfull
10AA 7622           2866                             mov             @r0,#22h
10AC 900000   F     2867                             mov             dptr,#teBL
10AF 120000   F     2868                             call    lotext
10B2 020000   F     2869                             jmp             goto7;outF
                    2870                                     
10B5 B62205         2871     klev21:         cjne    @r0,#22h,klev23
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    45

10B8 80E7           2872                             jmp             lev220
                    2873     
10BA 020000   F     2874     rlabL2:         jmp             labL2
                    2875     
10BD B62376         2876     klev23:          cjne   @r0,#23h,labM
10C0 75B0FB         2877                              mov    p3,#0fbh
10C3 20B7F4         2878                              jb             p3.7,rlabL2
10C6 75B0F7         2879                              mov    p3,#0f7h
10C9 20B748         2880                              jb             p3.7,ddoutf
                    2881                              ;очистить блок памяти с набранным номером
10CC C20B           2882                              clr    bitmem  ;сбр признак памяти 
10CE D204           2883                              setb   bitizm
10D0 020000   F     2884                              jmp    goto7;outF
                    2885                             
10D3 75B0F7         2886     kgo23:           mov    p3,#0f7h
10D6 20B73B         2887                             jb              p3.7,ddoutf
10D9 B62107         2888                             cjne    @r0,#21h,go23no
                    2889                             ;очистить память
10DC C20B           2890                             clr             bitmem
10DE D204           2891                             setb    bitizm
10E0 020000   F     2892                             jmp             goto7;outF
                    2893     
10E3 7623           2894     go23no:    mov          @r0,#23h
10E5 8035           2895                             jmp             loblok;БЛОК 00
                    2896     
10E7 7621           2897     kfull:          mov             @r0,#21h
10E9 8023           2898                             jmp             gofull          
10EB                2899     nomemk:
10EB 020000   F     2900                                     jmp             goto7;outF
                    2901                                     ;;;;;;;;;;
10EE 75B0FB         2902     nome11:           mov           p3,#0fbh
10F1 E5B0           2903                               mov           a,p3
10F3 20E70B         2904                               jb            acc.7,kvvod0
10F6 B61204         2905                               cjne          @r0,#12h,mem12no        
10F9 7611           2906                               mov           @r0,#11h                ;ОЧИСТКА
10FB 8083           2907                               jmp            loadcle
                    2908     
10FD                2909     mem12no:        ;cjne           @r0,#13h,lowr           
10FD 7612           2910                               mov           @r0,#12h                   ;
10FF 808A           2911                               jmp           lowr1                     ;ЗАПИСЬ
                    2912     
1101 75B0F7         2913     kvvod0:           mov           p3,#0f7h
1104 20B70D         2914                               jb            p3.7,ddoutf
1107 78B0           2915                               mov           r0,#level
1109 B6110B         2916                               cjne          @r0,#11h,mvv11
110C 7621           2917                               mov           @r0,#21h                ;ПОЛНАЯ
110E 900000   F     2918     gofull:           mov           dptr,#teFULL
1111 120000   F     2919                               call          lotext
1114 020000   F     2920     ddoutf:                 jmp             goto7;outF
                    2921     
1117 B61215         2922     mvv11:            cjne          @r0,#12h,mvv12
111A 7631           2923                                     mov             @r0,#31h
111C 900000   F     2924     loblok:                 mov             dptr,#teBLOK;БЛОК 00
111F 120000   F     2925                                     call    lotext
1122 78B2           2926                                     mov             r0,#marker
1124 7607           2927                                     mov             @r0,#7
1126 753B08         2928                                     mov             movrig,#8
1129 753A07         2929                                     mov             movleft,#7
112C 020000   F     2930                                     jmp             goto7;outF
112F 7641           2931     mvv12:                  mov             @r0,#41h                ; БЛОК 00
1131 80E9           2932                                     jmp             loblok
                    2933     
                    2934     
                    2935     
1133 020000   F     2936     mlabL2:         jmp             labL2
                    2937     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    46

1136 B63137         2938     labM:                   cjne    @r0,#31h,nom31
1139 75B0FB         2939                                     mov             p3,#0fbh
113C 30B7F4         2940                                     jnb             p3.7,mlabL2
113F 75B0F7         2941                                mov          p3,#0f7h
1142 20B7CF         2942                                jb           p3.7,ddoutf
                    2943                                
1145 7632           2944                                mov          @r0,#32h
                    2945                                     ;       считать с индикатора  
1147 7F0A           2946                                     mov             r7,#10
1149 7853           2947                                     mov             r0,#adec
114B 120000   F     2948                                     call    clearN
114E 120000   F     2949                                     call    upak2                   
1151 784F           2950                                     mov             r0,#abin
1153 7953           2951                                     mov             r1,#adec                        ;мл        
                              ст
1155 120000   F     2952                                     call    decbin                  ;abin..abin+3 (hex)
                    2953                                     ;call   loadr2                  ;r2..r5
                    2954                                     ;call   altof                   ;r2..r5->int
1158 78C4           2955                                mov          r0,#nblok       ;   сохранить
115A E54F           2956                                mov          a,abin          ;;мл
115C F6             2957                                mov          @r0,a
115D 900000   F     2958                                mov          dptr,#tebBL;НАЧ БЛОК 000
1160 120000   F     2959                                call         lotext
1163 78B2           2960                                mov          r0,#marker
1165 7607           2961                                mov          @r0,#7
1167 753B09         2962                                mov          movrig,#9
116A 753A07         2963                                mov          movleft,#7
116D 020000   F     2964     rgoto7:            jmp     goto7;outF
                    2965     
1170 B6324C         2966     nom31:             cjne         @r0,#32h,nom32
1173 75B0FB         2967                                     mov             p3,#0fbh
1176 20B714         2968                                     jb              p3.7,no31n
                    2969                                     
1179 78B2           2970     lefcur:         mov             r0,#marker      ;курсор слева?
117B E53A           2971                             mov             a,movleft
117D C3             2972                             clr             c
117E 96             2973                             subb    a,@r0
117F 7006           2974                             jnz        noequ2
1181 E53B           2975                             mov             a,movrig
1183 F6             2976                             mov             @r0,a;уст в крайнюю правую позицию
1184 020000   F     2977                             jmp             goto7
1187 120000   F     2978     noequ2:         call    marle;сдвинуть курсор в  лево на 1позицию       
118A 020000   F     2979                             jmp        goto7
                    2980                                     
118D 75B0F7         2981     no31n:             mov          p3,#0f7h
1190 20B7DA         2982                                     jb              p3.7,rgoto7
1193 7633           2983                                     mov             @r0,#33h
                    2984                                     ;запомнить номер ячейки блока
1195 7F0A           2985                                             mov             r7,#10
1197 7853           2986                                     mov             r0,#adec
1199 120000   F     2987                                     call    clearN
119C 120000   F     2988                                     call    upak3                   
119F 784F           2989                                     mov             r0,#abin
11A1 7953           2990                                     mov             r1,#adec                        ;мл        
                              ст
11A3 120000   F     2991                                     call    decbin                  ;abin..abin+3 (hex)
11A6 120000   F     2992                                     call    loadr2                  ;r2..r5
11A9 120402         2993                                     call    altof                   ;r2..r5->int
                    2994     
11AC 900000   F     2995                                      mov            dptr,#teeBL;КОН БЛОК 000
11AF 120000   F     2996                                call         lotext
11B2 78B2           2997                                mov          r0,#marker
11B4 7607           2998                                mov          @r0,#7
11B6 753B09         2999                                mov          movrig,#9
11B9 753A07         3000                                mov          movleft,#7
11BC 020000   F     3001                                jmp     goto7;
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    47

                    3002     
                    3003     
11BF B63328         3004     nom32:           cjne           @r0,#33h,nom33
11C2 75B0FB         3005                              mov            p3,#0fbh
11C5 30B7B1         3006                              jnb            p3.7,lefcur
11C8 75B0F7         3007                              mov            p3,#0f7h
11CB 20B79F         3008                              jb             p3.7,rgoto7
                    3009                              ;запомнить номер ячейки конца блока
11CE 7634           3010                              mov    @r0,#34h
11D0 7F0A           3011     INTn:                   mov             r7,#10
11D2 7853           3012                                     mov             r0,#adec
11D4 120000   F     3013                                     call    clearN
11D7 120000   F     3014                                     call    upak3                   
11DA 784F           3015                                     mov             r0,#abin
11DC 7953           3016                                     mov             r1,#adec                        ;мл        
                              ст
11DE 120000   F     3017                                     call    decbin                  ;abin..abin+3 (hex)
11E1 120000   F     3018                                     call    loadr2                  ;r2..r5
11E4 120402         3019                                     call    altof                   ;r2..r5->int
11E7 020000   F     3020     dgoto7:                  jmp            goto7
                    3021     
11EA B63415         3022     nom33:          cjne            @r0,#34h,labelP
11ED 75B0FB         3023                               mov           p3,#0fbh
11F0 30B786         3024                              jnb            p3.7,lefcur
11F3 75B0F7         3025                              mov            p3,#0f7h
11F6 20B7EE         3026                              jb             p3.7,dgoto7
11F9 76FF           3027                              mov            @r0,#0ffh
                    3028                              ;T1<-число на индикаторе
11FB C20B           3029                              clr            bitmem            ;vvod КОН БЛ 000
11FD D204           3030                              setb           bitizm
                    3031                                     
11FF 020000   F     3032                             jmp        goto7
1202                3033     labelP:                                                         
                    3034     ;;;;;;;
1202                3035     labelI:
1202 75B0FE         3036                                     mov             p3,#0feh
1205 E5B0           3037                                     mov             a,p3
1207 20E703         3038                                     jb              acc.7,nopoint
                    3039                                     ;
120A 020000   F     3040                                     jmp             goto7;out7
120D 75B0FB         3041     nopoint:                mov             p3,#0fbh
1210 E5B0           3042                                     mov             a,p3
1212 20E711         3043                                     jb              acc.7,nopoin7
1215 78B2           3044                                     mov             r0,#marker
1217 B60305         3045                                     cjne    @r0,#3,nomarl;26
121A 7609           3046                                     mov             @r0,#9
121C 020000   F     3047                                     jmp             goto7;  out7
                    3048     
121F 16             3049     nomarl:                 dec             @r0                             ;нажата кн <- при в
                             воде цифр A=000000
1220 C219           3050                                     clr             bitmig
1222 B60253         3051                                     cjne    @r0,#2,out7;26
1225 06             3052                                     inc             @r0
                    3053     ;нажат ввод А =000000 запомнить константу А
1226 75B0F7         3054     nopoin7:           mov          p3,#0f7h
1229 E5B0           3055                                     mov             a,p3
122B 20E74A         3056                                     jb              acc.7,out7
122E 78B1           3057                                     mov             r0,#vichR
1230 E6             3058                                     mov             a,@r0
1231 B62124         3059                                     cjne    @r0,#21h,no21p7
1234 7631           3060                                     mov             @r0,#31h
                    3061                             ;       считать с индикатора  упаковать в плавающий формат
                    3062                             ;   сохранить
1236 120000   F     3063                                     call    upak                    
1239 784F           3064                                     mov             r0,#abin
123B 7953           3065                                     mov             r1,#adec                        ;мл        
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    48

                              ст
123D 120000   F     3066                                     call    decbin                  ;abin..abin+3 (hex)
1240 120000   F     3067                                     call    loadr2                  ;r2..r5
1243 120402         3068                                     call    altof                   ;r2..r5->int
1246 78BC           3069                                     mov             r0,#konstA
1248 120000   F     3070                                     call    saver2
                    3071     ;26
124B 78B2           3072                                     mov             r0,#marker
124D 7603           3073                                     mov             @r0,#3
124F 900000   F     3074                                     mov             dptr,#teBequ0
1252 120000   F     3075                                     call    lotext
                    3076                                     
1255 020000   F     3077                                     jmp             goto7;out7
                    3078     
1258                3079     no21p7:                 ;       считать с индикатора  упаковать в плавающий формат
                    3080                             ;   сохранить
1258 120000   F     3081                                     call    upak                    
125B 784F           3082                                     mov             r0,#abin
125D 7953           3083                                     mov             r1,#adec                        ;мл        
                              ст
125F 120000   F     3084                                     call    decbin                  ;abin..abin+3 (hex)
1262 120000   F     3085                                     call    loadr2                  ;r2..r5
1265 120402         3086                                     call    altof                   ;r2..r5->int
1268 78C0           3087                                     mov             r0,#konstB
126A 120000   F     3088                                     call    saver2
                    3089     
126D 79B2           3090                                     mov             r1,#marker       ;B=000000-> ВЫЧИСЛИТЬ
126F 77FF           3091                                     mov             @r1,#0ffh
1271 78B1           3092                                     mov             r0,#vichR
1273 7611           3093                                     mov             @r0,#11h
1275 020000   F     3094                                jmp          lovich     ;ВЫЧИСЛИТЬ
                    3095     
                    3096     
1278                3097     out7:                   ;mov            IE,#80h
1278 D007           3098                                     pop             rr7     
127A D006           3099                                     pop             rr6
127C D005           3100                                     pop             rr5
127E D004           3101                                     pop             rr4
1280 D003           3102                                     pop             rr3
1282 D002           3103                                     pop             rr2
1284 D001           3104                                     pop             rr1                             
1286 D000           3105                                     pop             rr0
1288 D0D0           3106                                     pop             psw
128A D0E0           3107                                     pop             acc
128C E5AD           3108                                     mov             a,P3IF
128E 547F           3109                                     anl             a,#7fh
1290 F5AD           3110                                     mov             P3IF,a
1292 75B0C0         3111                                     mov             P3,#0c0h
1295 75E730         3112                                     mov             EIE2,#30H
1298 32             3113                                     reti
                    3114     
1299 79AE           3115     loadUS:         mov             r1,#diap
129B E7             3116                             mov             a,@r1
129C 23             3117                             rl              a;*2
129D FC             3118                             mov             r4,a                    ;save a
129E 900000   F     3119                             mov             dptr,#tabus
12A1 93             3120                             movc    a,@a+dptr
12A2 FA             3121                             mov             r2,a                    ;high byte
12A3 E584           3122                             mov             a,p4
12A5 5401           3123                             anl             a,#01
12A7 4A             3124                             orl             a,r2
12A8 F584           3125                             mov             p4,a
12AA 0C             3126                             inc             r4
12AB EC             3127                             mov             a,r4
12AC 93             3128                             movc    a,@a+dptr
12AD FB             3129                             mov             r3,a                    ;low byte
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    49

12AE E585           3130                             mov             a,p5
12B0 5401           3131                             anl             a,#01
12B2 4B             3132                             orl             a,r3
12B3 F585           3133                             mov             p5,a
12B5 799A           3134                             mov             r1,#parT
12B7 B7010E         3135                             cjne    @r1,#1,bret
12BA 79AE           3136                             mov             r1,#diap                  ;10s (parT=1)
12BC 7405           3137                             mov             a,#5                      ;10-8..10-11 p4.1=1
12BE C3             3138                             clr             c
12BF 97             3139                             subb    a,@r1
12C0 5006           3140                             jnc             bret
12C2 E584           3141                             mov             a,p4
12C4 4402           3142                             orl             a,#02
12C6 F584           3143                             mov             p4,a                     ;10-8..10-11 p4.1=1
12C8 120000   F     3144     bret:      call          louizm         ;us если вкл кн ИЗМЕР
12CB 22             3145                             ret
                    3146     
                    3147                             
                    3148     ;загр ус для кор 0,тестов ацп и т.д.
                    3149     ;dptr-
12CC E4             3150     lospus:         clr             a
                    3151                             ;movc   a,@a+dptr
                    3152                             ;mov            r2,a                    ;high byte
                    3153                             ;mov            a,p4
                    3154                             ;anl            a,#01
                    3155                             ;orl            a,r2
                    3156                             ;mov            p4,a
                    3157                             ;inc            dptr
12CD E4             3158                             clr             a
12CE 93             3159                             movc    a,@a+dptr
12CF FB             3160                             mov             r3,a                    ;low byte
12D0 E585           3161                             mov             a,p5
12D2 54BF           3162                             anl             a,#0bfh;01
12D4 4B             3163                             orl             a,r3
12D5 F585           3164                             mov             p5,a
12D7 22             3165                             ret
                    3166     
12D8 80             3167     kor0us:         db              80h;18h,2eh             ;us режима коррекции 0
                    3168     
                    3169     ;us кнопка измерения выкл
12D9 88D6           3170     tabus:     db           88h,0d6h         ;10-2
12DB 88F6           3171                             db      88h,0f6h         ;10-3
12DD 88D6           3172                             db              88h,0d6h         ;10-4
12DF 88F6           3173                             db              88h,0f6h         ;10-5
12E1 9AD6           3174                             db      9ah,0d6h         ;10-6
12E3 9AF6           3175                             db              9ah,0f6h         ;10-7
12E5 ACD6           3176                             db              0ach,0d6h        ;10-8
12E7 ACF6           3177                             db      0ach,0f6h        ;10-9
12E9 C8D6           3178                             db              0c8h,0d6h        ;10-10
12EB C8F6           3179                             db              0c8h,0f6h        ;10-11
                    3180     
                    3181     
                    3182      ;загрузка текста в буфер 2 bufind+0..bufind9
                    3183     ;в зав от parT (Tизм)
12ED 79B7           3184     loadT:          mov             r1,#load;parT
12EF 7840           3185     lolevT:         mov             r0,#bufind+0
12F1 7B0A           3186                             mov             r3,#10
12F3 75F00A         3187                             mov             b,#10
12F6 E7             3188                             mov             a,@r1
12F7 A4             3189                             mul             ab
12F8 FC             3190                             mov             r4,a                    ;save a
12F9 900000   F     3191                             mov             dptr,#textT
12FC 93             3192             lod1:   movc    a,@a+dptr
12FD F6             3193                             mov             @r0,a
12FE 08             3194                             inc             r0
12FF 0C             3195                             inc             r4
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    50

1300 EC             3196                             mov             a,r4
1301 DBF9           3197                             djnz    r3,lod1
1303 22             3198                             ret     
                    3199     ;загрузка текста в буфер 2 bufind+0..bufind9                    
                    3200     ;dptr-адр строки текста         
1304                3201     lotext:         
1304 7B0A           3202                             mov             r3,#10
1306 7840           3203                             mov             r0,#bufind+0
1308 E4             3204     lodt:           clr             a
1309 93             3205                             movc    a,@a+dptr
130A F6             3206                             mov             @r0,a
130B 08             3207                             inc             r0
130C A3             3208                             inc             dptr
130D DBF9           3209                             djnz    r3,lodt
130F 22             3210                             ret                                     
                    3211                                     
1310                3212     textT:          
1310 FD543D32       3213                             db              0fdh,"T","=",32h,"m","S",0fdh,0fdh,0fdh,0fdh ;load=
                             0..5
1314 6D53FDFD                
1318 FDFD                    
131A FD543D31       3214                             db              0fdh,"T","=",31h,30h,"m","S",0fdh,0fdh,0fdh
131E 306D53FD                
1322 FDFD                    
1324 FD543D35       3215                             db              0fdh,"T","=",35h,30h,"m","S",0fdh,0fdh,0fdh
1328 306D53FD                
132C FDFD                    
132E FD543D64       3216                             db              0fdh,"T","=",64h,31h,"S",0fdh,0fdh,0fdh,0fdh
1332 3153FDFD                
1336 FDFD                    
1338 20202054       3217                             db              " "," "," ","T","=",31h,"S"," "," "," "
133C 3D315320                
1340 2020                    
1342 2020543D       3218                             db              " "," ","T","=",31h,30h,"S"," "," "," "  
1346 31305320                
134A 2020                    
                    3219     ;teNO:          db              0fdh,0fdh,0fdh,"H","E","T",0fdh,0fdh,0fdh,0fdh
                    3220     
134C 42753474       3221      teVICH:        db              "B",75h,34h,74h,79h,76h,74h,"T",77h," ";вычислить
1350 79767454                
1354 7720                    
1356 20413D2B       3222      teAequ0:       db              " ",'A','=','+',30h,30h,30h,30h,30h,30h
135A 30303030                
135E 3030                    
1360 20423D2B       3223      teBequ0:       db              " ",'B','=','+',30h,30h,30h,30h,30h,30h
1364 30303030                
1368 3030                    
136A 20207145       3224      teMENU:        db              " "," ",71h,"E","H",72h," "," "," "," "
136E 48722020                
1372 2020                    
                    3225     
1374 20205445       3226      teTEST:        db      " "," ","T","E",79h,"T"," "," "," "," "
1378 79542020                
137C 2020                    
                    3227     
137E 204B4176       3228      teKALIB:        db     " " ,'K','A',76h,74h,73h,"P "," "," "," ";КАЛИБР
1382 74735020                
1386 202020                  
1389 74337120       3229      teIZMK:        db      74h,33h,71h," ","K",30h,"H",79h,"T"," "
138D 4B304879                
1391 5420                    
1393 20204275       3230      teOUT:         db      " "," ","B",75h,"X",30h,78h," "," "," "  ;ВЫХОД
1397 58307820                
139B 2020                    
139D 2020304C       3231      teOLL:         db      " "," ",30h,'L','L'," "," "," "," "," "  ;OLL
13A1 4C202020                
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    51

13A5 2020                    
13A7 20203034       3232      teCLE:         db      " "," ",30h,34h,74h,79h,'T','K','A' ," " ;ОЧИСТКА
13AB 7479544B                
13AF 4120                    
13B1 20203041       3233      teMEM:         db      " "," ",30h,'A',71h,79h,'T'," " ; ПАМЯТЬ
13B5 71795420                
13B9 20203341       3234      teWR:          db      " "," ",33h,'A',61h,74h,79h,77h," "," ";ЗАПИСЬ
13BD 61747977                
13C1 2020                    
13C3 20206150       3235      teLIST:        db      " "," ",61h,'P',30h,79h,71h,30h,"T","P ";;ПРОСМОТР
13C7 30797130                
13CB 545020                  
13CE 20206130       3236      teFULL:        db      " "," ",61h,30h,76h,"H",'A',62h," "," ";ПОЛНАЯ
13D2 76484162                
13D6 2020                    
13D8 20207376       3237      teBLOK:        db      " "," ",73h,76h,30h,'K'," ",30h,30h," ";БЛОК 00
13DC 304B2030                
13E0 3020                    
13E2 20207376       3238      teBL:          db      " "," ",73h,76h,30h,'K'," "," "," "," ";БЛОК
13E6 304B2020                
13EA 2020                    
13EC 48413420       3239      tebBL:         db      "H",'A',34h," ",73h,76h," ",30h,30h,30h; НАЧ БЛОК 000
13F0 73762030                
13F4 3030                    
13F6 4B304820       3240      teeBL:         db      "K",30h,"H"," ",73h,76h," ",30h,30h,30h; КОН БЛОК 000
13FA 73762030                
13FE 3030                    
                    3241      ;;;;;;;;;;;;;;;;;;;         
                    3242     ;управление AD7731
                    3243     ;r4=b1 r5=b2
1400                3244     iniacp: ;управление AD7731
1400 7403           3245                             mov             a,#03
                    3246     
1402 120000   F     3247                             call    write
1405 EC             3248                             mov             a,r4;#80h
1406 120000   F     3249                             call    write
1409 ED             3250                             mov             a,r5;#04
140A 120000   F     3251                             call    write
140D 7402           3252                             mov             a,#02
140F 120000   F     3253                             call    write
1412 74A1           3254                             mov             a,#0a1h
1414 120000   F     3255                             call    write
1417 7474           3256                             mov             a,#74h
1419 120000   F     3257                             call    write
141C 2095FD         3258                             jb              p1.5,$;p1.3,$
141F 7402           3259                             mov             a,#02
1421 120000   F     3260                             call    write
1424 7481           3261                             mov             a,#81h
1426 120000   F     3262                             call    write
1429 7474           3263                             mov             a,#74h
142B 120000   F     3264                             call    write
142E 2095FD         3265                             jb              p1.5,$;p1.3,$
1431 7402           3266                             mov             a,#02
1433 120000   F     3267                             call    write
1436 7421           3268                             mov             a,#21h
1438 120000   F     3269                             call    write
143B 7474           3270                             mov             a,#74h
143D 120000   F     3271                             call    write
1440 22             3272                             ret
                    3273                             ;;;;;;;;;;;;;;;;
                    3274     ;;;;;;;;;;;;;;;;;
                    3275     ;;;;;;;;;;;;;;;;;
1441 0000           3276     tabB1_2:                db              00,00            ;B1,B2 в соотв с Tизм  
1443 6000           3277                                     db              60h,00h;40h,04h         ;10s
1445 6000           3278                                     db              60h,00;40h,04h          ;1s
1447 4004           3279                                     db              40h,04h         ;0,1s
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    52

1449 2004           3280                                     db              20h,04h         ;50ms
144B 2004           3281                                     db              20h,04h          ;10ms
144D 1332           3282                                     db              13h,32h         ;2ms
                    3283     
                    3284     ;загр В1,В2 в завис от Т                                
144F 799A           3285     loab12:                 mov             r1,#parT
1451 900000   F     3286                                     mov             dptr,#tabB1_2
1454 E7             3287                                     mov             a,@r1
1455 23             3288                                     rl              a;*2
1456 FF             3289                                     mov             r7,a                    ;save a
1457 93             3290                                     movc    a,@a+dptr
1458 FC             3291                                     mov             r4,a   ;b1
1459 0F             3292                                     inc             r7
145A EF             3293                                     mov             a,r7
145B 93             3294                                     movc    a,@a+dptr
145C FD             3295                                     mov             r5,a
                    3296                                     ;после загр В1,2 загр упр слово для нового Т
                    3297                             
145D 22             3298                                     ret
                    3299     
                    3300     
                    3301     
                    3302     ;пп мигания индикации
145E 78B2           3303     mign:           mov             r0,#marker
                    3304                                     
1460 B6FF03         3305                                     cjne    @r0,#0ffh,mignn
                    3306                                     ;реж изм мигает *
1463 C219           3307                                     clr             bitmig
1465 22             3308                                     ret
                    3309     
1466                3310     mignn:                  ;clr            c
1466 7440           3311                                     mov             a,#bufind
1468 26             3312                                     add             a,@r0                   ;a=bufind+marker
1469 F9             3313                                     mov             r1,a
146A 201907         3314                                     jb              bitmig,onmig
146D 873C           3315                                     mov             savba,@r1
                    3316                             ;       mov             a,@r1
                    3317                             ;       mov             savba,a
146F 7720           3318                                     mov             @r1,#" "
1471 D219           3319                                     setb    bitmig
1473 22             3320                                     ret
                    3321     
1474 A73C           3322     onmig:                  mov             @r1,savba
                    3323                                     ;mov            a,savba
                    3324                                     ; mov           @r1,a
1476 C219           3325                                     clr             bitmig
1478 120000   F     3326                                     call    z_01s
                    3327                                     
147B 22             3328                                     ret
                    3329     ;bufind=30h..39h                                                                           
                                           ;
147C C219           3330     vvchif:                 clr             bitmig
147E 79B2           3331                                     mov             r1,#marker
1480 E7             3332                                     mov             a,@r1                   ;изм цифры
1481 7840           3333                                     mov             r0,#bufind                      ;0000
1483 28             3334                                     add             a,r0
1484 F8             3335                                     mov             r0,a
1485 06             3336                                     inc             @r0
1486 B63A02         3337                                     cjne    @r0,#3ah,chif
1489 7630           3338                                     mov             @r0,#30h
148B                3339     chif:   
148B 22             3340                             ret
                    3341     
                    3342       ;перевод маркера влево
148C                3343     marle:  
148C C219           3344                     clr             bitmig
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    53

                    3345                     ;mov            savba,#0   нельзя обнулять
148E 78B2           3346             mov             r0,#marker
1490 16             3347                     dec             @r0
1491 E6             3348                     mov             a,@r0
1492 C3             3349                     clr             c
1493 953A           3350                     subb    a,movleft         ;крайне левое положение
1495 5001           3351                     jnc             rler
1497 06             3352                     inc             @r0
1498 22             3353     rler:   ret
                    3354         
                    3355     ;перевод маркера вправо
1499 C219           3356     marri:  clr             bitmig
149B 78B2           3357                     mov             r0,#marker
149D 06             3358                     inc         @r0
149E E53B           3359                     mov             a,movrig           ;крайне правое положение
14A0 C3             3360                     clr             c
14A1 96             3361                     subb    a,@r0
14A2 5001           3362                     jnc             rrir
14A4 16             3363                     dec             @r0
14A5 22             3364     rrir:   ret
                    3365         
                    3366     
                    3367     
                    3368     
14A6 7852           3369     loadr2: mov             r0,#abin+3              ;r2..r5
14A8 E6             3370                     mov             a,@r0                   ; ст мл   
14A9 FA             3371                     mov             r2,a
14AA 18             3372                     dec             r0
14AB E6             3373                     mov             a,@r0
14AC FB             3374                     mov             r3,a
14AD 18             3375                     dec             r0
14AE E6             3376                     mov             a,@r0
14AF FC             3377                     mov             r4,a
14B0 18             3378                     dec             r0
14B1 E6             3379                     mov             a,@r0
14B2 FD             3380                     mov             r5,a
14B3 22             3381                     ret
                    3382                                             
                    3383      ;;;;;;;;;;;;;;;;;;;      
                    3384      ;загрузка KD в зависимости от диап изм  
                    3385      ;koef->r8..r11
14B4 78AE           3386     loadKD:                 mov             r0,#diap
14B6 E6             3387                                     mov             a,@r0
14B7 900000   F     3388                                     mov             dptr,#diKDn
14BA 75F004         3389                                     mov             b,#4
14BD A4             3390                                     mul             ab
14BE FF             3391                                     mov             r7,a;save
14BF 93             3392                                     movc    a,@a+dptr
14C0 F508           3393                                     mov             r8,a
14C2 A3             3394                                     inc             dptr
14C3 EF             3395                                     mov             a,r7
14C4 93             3396                                     movc    a,@a+dptr
14C5 F509           3397                                     mov             r9,a
14C7 A3             3398                                     inc             dptr
14C8 EF             3399                                     mov             a,r7
14C9 93             3400                                     movc    a,@a+dptr
14CA F50A           3401                                     mov             r10,a
14CC A3             3402                                     inc             dptr
14CD EF             3403                                     mov             a,r7
14CE 93             3404                                     movc    a,@a+dptr
14CF F50B           3405                                     mov             r11,a
14D1 22             3406                                     ret
                    3407     
14D2 3F506B7B       3408      diKDn:                 db              3fh,50h,6bh,7bh;3fh,80h,00,00           ;10-2
14D6 3F507FCC       3409                                     db              3fh,50h,7fh,0cch;3fh,80h,00,00          ;10
                             -3
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    54

14DA 3F4F9D0B       3410                                     db              3fh,4fh,9dh,0bh;3fh,80h,00,00           ;10
                             -4
14DE 3F4FE869       3411                                     db              3fh,4fh,0e8h,69h;3fh,80h,00,00          ;10
                             -5
14E2 3F50294A       3412                                     db              3fh,50h,29h,4ah;3fh,80h,00,00;4fh,0e9h,11h 
                                  ;0,81215   10-6
14E6 3F50639E       3413                                      db             3fh,50h,63h,9eh;3fh,80h,00,00           ;10
                             -7
14EA 3F4BC9F0       3414                                     db              3fh,4bh,0c9h,0f0h;3fh,80h,00,00         ;10
                             -8
14EE 3F4C063B       3415                                     db              3fh,4ch,06h,3bh;3fh,80h,00,00           ;10
                             -9
14F2 3F50EFDD       3416                                     db              3fh,50h,0efh,0ddh;3fh,80h,00,00         ;10
                             -10
14F6 3F512AD9       3417                                     db              3fh,51h,2ah,0d9h;3fh,80h,00,00          ;10
                             -11
                    3418     
14FA 00000039       3419     ch57:   db      00,00,00,39h;57
14FE 00000014       3420     ch20:   db      00,00,00,14h;20
                    3421     
                    3422     
                    3423     
                    3424     
                    3425     ;$include (d:\amp\subr2.asm) 
1299            +1  3426     loadUS: ;если идет тест измерения ус восстановить для теста
*** _________________________^
*** ERROR #A8 IN 3426 (d:\amp\subr2.asm, LINE 1): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
                +1  3427                                     ;jb             biteizm,yestest
1502 79AE       +1  3428                                             mov             r1,#diap
1504 E7         +1  3429                             mov             a,@r1
1505 23         +1  3430                             rl              a;*2
1506 FC         +1  3431                             mov             r4,a                    ;save a
1507 900000   F +1  3432                             mov             dptr,#tabus
150A 93         +1  3433                             movc    a,@a+dptr
150B FA         +1  3434                             mov             r2,a                    ;high byte
150C E584       +1  3435                             mov             a,p4
150E 5401       +1  3436                             anl             a,#01
1510 4A         +1  3437                             orl             a,r2
1511 F584       +1  3438                             mov             p4,a
1513 0C         +1  3439                             inc             r4
1514 EC         +1  3440                             mov             a,r4
1515 93         +1  3441                             movc    a,@a+dptr
1516 FB         +1  3442                             mov             r3,a                    ;low byte
1517 E585       +1  3443                             mov             a,p5
1519 5401       +1  3444                             anl             a,#01
151B 4B         +1  3445                             orl             a,r3
151C F585       +1  3446                             mov             p5,a
151E 799A       +1  3447                             mov             r1,#parT
1520 B701A5     +1  3448                             cjne    @r1,#1,bret
*** ________________________________________________________________^
*** ERROR #A51 IN 3448 (d:\amp\subr2.asm, LINE 23): TARGET OUT OF RANGE
1523 79AE       +1  3449                             mov             r1,#diap                  ;10s (parT=1)
1525 7405       +1  3450                             mov             a,#5                      ;10-8..10-11 p4.1=1
1527 C3         +1  3451                             clr             c
1528 97         +1  3452                             subb    a,@r1
1529 509D       +1  3453                             jnc             bret
*** _________________________________________________________________^
*** ERROR #A51 IN 3453 (d:\amp\subr2.asm, LINE 28): TARGET OUT OF RANGE
152B E584       +1  3454                             mov             a,p4
152D 4402       +1  3455                             orl             a,#02
152F F584       +1  3456                             mov             p4,a                     ;10-8..10-11 p4.1=1
1531 120000   F +1  3457     bret:      call          louizm         ;us если вкл кн ИЗМЕР
*** _________________________^
*** ERROR #A8 IN 3457 (d:\amp\subr2.asm, LINE 32): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
1534 22         +1  3458                             ret
1535            +1  3459     yestest:
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    55

1535 120000   F +1  3460                             call            lotpus          ;ус теста измерения
1538 22         +1  3461                             ret
                +1  3462                             
                +1  3463     ;загр ус для кор 0
                +1  3464     ;dptr-
1539 E4         +1  3465     lospus:         clr             a
*** _________________________^
*** ERROR #A8 IN 3465 (d:\amp\subr2.asm, LINE 40): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
                +1  3466                             ;movc   a,@a+dptr
                +1  3467                             ;mov            r2,a                    ;high byte
                +1  3468                             ;mov            a,p4
                +1  3469                             ;anl            a,#01
                +1  3470                             ;orl            a,r2
                +1  3471                             ;mov            p4,a
                +1  3472                             ;inc            dptr
153A E4         +1  3473                             clr             a
153B 93         +1  3474                             movc    a,@a+dptr
153C FB         +1  3475                             mov             r3,a                    ;low byte
153D E585       +1  3476                             mov             a,p5
153F 54BF       +1  3477                             anl             a,#0bfh;01
1541 4B         +1  3478                             orl             a,r3
1542 F585       +1  3479                             mov             p5,a
1544 22         +1  3480                             ret
                +1  3481     
1545 80         +1  3482     kor0us:         db              80h;18h,2eh             ;us режима коррекции 0
*** _________________________^
*** ERROR #A8 IN 3482 (d:\amp\subr2.asm, LINE 57): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
                +1  3483     
                +1  3484     ;us кнопка измерения выкл
1546 88D6       +1  3485     tabus:     db           88h,0d6h         ;10-2
*** _________________________^
*** ERROR #A8 IN 3485 (d:\amp\subr2.asm, LINE 60): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
1548 88F6       +1  3486                             db      88h,0f6h         ;10-3
154A 88D6       +1  3487                             db              88h,0d6h         ;10-4
154C 88F6       +1  3488                             db              88h,0f6h         ;10-5
154E 9AD6       +1  3489                             db      9ah,0d6h         ;10-6
1550 9AF6       +1  3490                             db              9ah,0f6h         ;10-7
1552 ACD6       +1  3491                             db              0ach,0d6h        ;10-8
1554 ACF6       +1  3492                             db      0ach,0f6h        ;10-9
1556 C8D6       +1  3493                             db              0c8h,0d6h        ;10-10
1558 C8F6       +1  3494                             db              0c8h,0f6h        ;10-11
                +1  3495     
155A            +1  3496     tabt11: 
155A 66E6       +1  3497                             db              66h,0e6h;10-11
155C            +1  3498     tabt9:  
155C 32E6       +1  3499                             db              32h,0e6h;10-9
155E            +1  3500     tabt7:  
155E 18EE       +1  3501                             db              18h,0eeh;10-7
                +1  3502     
                +1  3503      ;загрузка текста в буфер 2 bufind+0..bufind9
                +1  3504     ;в зав от parT (Tизм)
1560 79B7       +1  3505     loadT:          mov             r1,#load;parT
*** _________________________^
*** ERROR #A8 IN 3505 (d:\amp\subr2.asm, LINE 80): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
1562 7840       +1  3506     lolevT:         mov             r0,#bufind+0
*** _________________________^
*** ERROR #A8 IN 3506 (d:\amp\subr2.asm, LINE 81): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
1564 7B0A       +1  3507                             mov             r3,#10
1566 75F00A     +1  3508                             mov             b,#10
1569 E7         +1  3509                             mov             a,@r1
156A A4         +1  3510                             mul             ab
156B FC         +1  3511                             mov             r4,a                    ;save a
156C 900000   F +1  3512                             mov             dptr,#textT
156F 93         +1  3513             lod1:   movc    a,@a+dptr
*** _________________________________^
*** ERROR #A8 IN 3513 (d:\amp\subr2.asm, LINE 88): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    56

1570 F6         +1  3514                             mov             @r0,a
1571 08         +1  3515                             inc             r0
1572 0C         +1  3516                             inc             r4
1573 EC         +1  3517                             mov             a,r4
1574 DB86       +1  3518                             djnz    r3,lod1
*** ____________________________________________________________^
*** ERROR #A51 IN 3518 (d:\amp\subr2.asm, LINE 93): TARGET OUT OF RANGE
1576 22         +1  3519                             ret     
                +1  3520     ;загрузка текста в буфер 2 bufind+0..bufind9                    
                +1  3521     ;dptr-адр строки текста         
1304            +1  3522     lotext:         
*** _________________________^
*** ERROR #A8 IN 3522 (d:\amp\subr2.asm, LINE 97): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
1577 7B0A       +1  3523                             mov             r3,#10
1579 7840       +1  3524                             mov             r0,#bufind+0
157B E4         +1  3525     lodt:           clr             a
*** _________________________^
*** ERROR #A8 IN 3525 (d:\amp\subr2.asm, LINE 100): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
157C 93         +1  3526                             movc    a,@a+dptr
157D F6         +1  3527                             mov             @r0,a
157E 08         +1  3528                             inc             r0
157F A3         +1  3529                             inc             dptr
1580 DB86       +1  3530                             djnz    r3,lodt
*** ____________________________________________________________^
*** ERROR #A51 IN 3530 (d:\amp\subr2.asm, LINE 105): TARGET OUT OF RANGE
1582 22         +1  3531                             ret                                     
                +1  3532     
                +1  3533     
                +1  3534     
                +1  3535     
                +1  3536      ;задержка 100 мкс
1583 7978       +1  3537     z_100:    mov R1,#78h     ;загрузка первого числа
1585 7A02       +1  3538     z100:     mov R2,#2h     ;загрузка второго числа
1587 DAFE       +1  3539     count:    djnz R2, count;декремент R2 и внутренний цикл, если R2<>0     
1589 D9FA       +1  3540               djnz R1, z100 ;декремент R1 и внутренний цикл, если R1<>0
158B 22         +1  3541               ret           
                +1  3542     
                +1  3543     ;задержка 34 мкс
158C 7B8B       +1  3544     z_5:      mov R3,#8Bh      ;загрузка числа
158E DBFE       +1  3545     ct:       djnz R3,ct
1590 22         +1  3546               ret
                +1  3547     
                +1  3548     ;задержка 15 мс
1591 79FA       +1  3549     z_15:     mov R1,#0FAh    ;загрузка первого числа
1593 7AED       +1  3550     z15:      mov R2,#0EDh   ;загрузка второго числа
1595 DAFE       +1  3551     zz:       djnz R2, zz   ;декремент R2 и внутренний цикл, если R2<>0
1597 D9FA       +1  3552               djnz R1, z15  ;декремент R1 и внутренний цикл, если R1<>0
1599 22         +1  3553               ret   
                +1  3554                                               
                +1  3555      ;задержка 1 мс
159A 7910       +1  3556     z_1ms:     mov R1,#10h     
159C 7AED       +1  3557     ss1:       mov R2,#0EDh    
159E DAFE       +1  3558                djnz R2, $    
15A0 D9FA       +1  3559                djnz R1, ss1   
15A2 22         +1  3560                ret   
                +1  3561     
                +1  3562      ;????????
                +1  3563     ;задержка 1с
15A3 7D1F       +1  3564     z_1s:   mov             r5,#01fh 
15A5 7EFF       +1  3565     co2s:   mov     R6,#0ffh     
15A7 7FFF       +1  3566     z1s:     mov    R7,#0ffh     
15A9 DFFE       +1  3567     co1s:   djnz    R7, co1s        
15AB DEFA       +1  3568             djnz    R6, z1s 
15AD DDF6       +1  3569                     djnz    r5,co2s
15AF 22         +1  3570               ret
                +1  3571     ;задержка 0,1с
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    57

15B0 7D03       +1  3572     z_01s:           mov            r5,#03h 
15B2 7EFF       +1  3573     co02s:          mov     R6,#0ffh     
15B4 7FFF       +1  3574     z01s:           mov     R7,#0ffh     
15B6 DFFE       +1  3575                             djnz    R7, $   
15B8 DEFA       +1  3576                     djnz    R6, z01s 
15BA DDF6       +1  3577                             djnz    r5,co02s
15BC 22         +1  3578                      ret              
15BD 000007FF   +1  3579     chzap:  db      00,00,07h,0ffh             
15C1 00000000   +1  3580     ch0:    db      00,00,00,00
15C5 0000000A   +1  3581     ch10:   db      00,00,00,0ah                            ;10
15C9 00000005   +1  3582     ch5:    db      00,00,00,05                                             ;5
15CD 000003B9   +1  3583     ch954:  db 00,00,03,0b9h                                                ;954
15D1 000003E8   +1  3584     ch10000:        db 00,00,03h,0e8h                                               ;10000
15D5 00000064   +1  3585     ch100:  db 00,00,00,64h ;100
15D9 00000002   +1  3586     ch2:    db      00,00,00,02                                             
                +1  3587     ;CH_953:        db 3fh,74h,37h,72h;0,953971
                +1  3588     ;CH_953:        db 3fh,74h,1ch,71h;0,953558
                +1  3589     ;CH_953:        db 3fh,74h,02,0d2h;0.953168
15DD 00000001   +1  3590     ch1:    db  00,00,00,01
15E1 3F800000   +1  3591     ch_1:   db      3fh,80h,00,00                   
15E5 3F741EDF   +1  3592     CH_953: db 3fh,74h,1eh,0dfh             ;0,953596
15E9 47C35000   +1  3593     CHtho:  db      47h,0c3h,50h,00;48h,43h,50h,00;30d40 h  -000
15ED 3F800347   +1  3594     KD:             db      3fh,80h,03h,47h;1,0001
15F1 48435000   +1  3595     CH2tho: db      48h,43h,50h,00;200000
15F5 4856D800   +1  3596     ch_220: db  48h,56h,0d8h,00;220000 -035b60 h
15F9 4856D800   +1  3597     ch_200: db  48h,56h,0d8h,00;200000 -030d40 h
15FD 461C4000   +1  3598     ch_10th:db  46h,1ch,40h,00;10000-2710h
1601 41200000   +1  3599     ch_10:  db      41h,20h,00,00;10d
1605 48742400   +1  3600     ch_250: db      48h,74h,24h,00;250000
                +1  3601     ;r1- мл байт 2х байтного числа
1609            +1  3602     tenmin:         ;-10
1609 C3         +1  3603                             clr             c
160A E7         +1  3604                     mov             a,@r1
160B 9405       +1  3605                             subb    a,#5;10
160D F7         +1  3606                             mov             @r1,a
160E 19         +1  3607                             dec             r1
160F E7         +1  3608                             mov             a,@r1
1610 9400       +1  3609                             subb    a,#0
1612 F7         +1  3610                             mov             @r1,a
1613 22         +1  3611                             ret
                +1  3612       ;r0-обнуление ячеек памяти  
1614 7F04       +1  3613       clear4:        mov    r7,#4
1616 E4         +1  3614                             clr             a
1617 F6         +1  3615       cl4:          mov             @r0,a
1618 08         +1  3616                             inc             r0
1619 DFFC       +1  3617                             djnz    r7,cl4
161B 22         +1  3618                             ret     
                +1  3619     
                +1  3620      ;r0-обнуление ячеек памяти 
                +1  3621      ;R7- 
161C            +1  3622       clearN:        
161C E4         +1  3623                             clr             a
161D F6         +1  3624       cl4N:         mov             @r0,a
161E 08         +1  3625                             inc             r0
161F DFFC       +1  3626                             djnz    r7,cl4N
1621 22         +1  3627                             ret     
                +1  3628     
                +1  3629       ;чтение номера байта с индикатора(2байта)
                +1  3630     ;bufind+8..bufind+9
                +1  3631     ;-  - - -
                +1  3632     ;- - - - - - - - - -
                +1  3633     ;adec..adec+9
                +1  3634     ;ст            мл
1622 7848       +1  3635     upak2:  mov             r0,#bufind+8;
1624 795C       +1  3636                     mov             r1,#adec+9
1626 7F02       +1  3637                     mov             r7,#2;2bait
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    58

1628 C3         +1  3638     upa2:   clr             c
1629 E6         +1  3639                     mov             a,@r0
162A 9430       +1  3640                     subb    a,#30h
162C F7         +1  3641                     mov             @r1,a
162D 18         +1  3642                     dec             r0
162E 19         +1  3643                     dec             r1
162F DFF7       +1  3644                     djnz    r7,upa2
1631 22         +1  3645                     ret  
                +1  3646         
                +1  3647      ;bufind+4..bufind+9
                +1  3648     ;-  - - -
                +1  3649     ;- - - - - - - - - -
                +1  3650     ;adec..adec+9
                +1  3651     ;ст            мл
1632 7849       +1  3652     upak:   mov             r0,#bufind+9;
1634 795C       +1  3653                     mov             r1,#adec+9
1636 7F06       +1  3654                     mov             r7,#6
1638 C3         +1  3655     upa:    clr             c
1639 E6         +1  3656                     mov             a,@r0
163A 9430       +1  3657                     subb    a,#30h
163C F7         +1  3658                     mov             @r1,a
163D 18         +1  3659                     dec             r0
163E 19         +1  3660                     dec             r1
163F DFF7       +1  3661                     djnz    r7,upa
1641 22         +1  3662                     ret
                +1  3663     
                +1  3664      ;чтение номера байта с индикатора(3байта)
                +1  3665     ;bufind+3..bufind+9
                +1  3666     ;-  - - -
                +1  3667     ;- - - - - - - - - -
                +1  3668     ;adec..adec+9
                +1  3669     ;ст            мл
1642 7849       +1  3670     upak3:  mov             r0,#bufind+9;
1644 795C       +1  3671                     mov             r1,#adec+9
1646 7F03       +1  3672                     mov             r7,#3;3bait
1648 C3         +1  3673     upa1:   clr             c
1649 E6         +1  3674                     mov             a,@r0
164A 9430       +1  3675                     subb    a,#30h
164C F7         +1  3676                     mov             @r1,a
164D 18         +1  3677                     dec             r0
164E 19         +1  3678                     dec             r1
164F DFF7       +1  3679                     djnz    r7,upa1
1651 22         +1  3680                     ret
                +1  3681     
                +1  3682     ;вых-r2,r3-адрес ячее памяти прогр
1652            +1  3683     findkoef:
1652 79AE       +1  3684                                     mov             r1,#diap
1654 E7         +1  3685                                     mov             a,@r1
1655 23         +1  3686                                     rl              a                                          
                                          ;diap*2(2bait )
1656 FC         +1  3687                                     mov             r4,a                                    ;sa
                             ve
1657 900000   F +1  3688                                     mov             dptr,#diKDw             ;адрес таблицы поис
                             ка коффициентов
                +1  3689                                     
165A 93         +1  3690                                     movc    a,@a+dptr                       ;ст байт
165B FA         +1  3691                                     mov             r2,a
165C A3         +1  3692                                     inc             dptr
165D EC         +1  3693                                     mov             a,r4
165E 93         +1  3694                                     movc    a,@a+dptr
165F FB         +1  3695                                     mov             r3,a                    ;мл байт
1660 22         +1  3696                                     ret
                +1  3697     
                +1  3698     ;адрес ячеек прзу  коффициентов диапазона KD
                +1  3699     ;(5000h..5027h)
1661 5000       +1  3700     diKDw:  dw              5000h                   ;10-2
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    59

1663 5004       +1  3701                                     dw              5004h                   ;10-3
1665 5008       +1  3702                                     dw              5008h                   ;10-4
1667 500C       +1  3703                                     dw              500ch                   ;10-5
1669 5010       +1  3704                                     dw              5010h                   ;10-6
166B 5014       +1  3705                                     dw              5014h                   ;10-7
166D 5018       +1  3706                                     dw              5018h                   ;10-8
166F 501C       +1  3707                                     dw              501ch                   ;10-9
1671 5020       +1  3708                                     dw              5020h                   ;10-10
1673 5024       +1  3709                                     dw              5024h                   ;10-11
1675 5028       +1  3710     dipar:  dw              5028h                   ;parol
                +1  3711     
1677 000186A0   +1  3712     chthou: db      00,01,86h,0a0h  ;100.000
                +1  3713     
167B AA08       +1  3714     move82:         mov     r2,ltemp                        ;ltemp->r2..r5
167D AB09       +1  3715                                             mov     r3,ltemp+1
167F AC0A       +1  3716                                             mov     r4,ltemp+2
1681 AD0B       +1  3717                                             mov     r5,ltemp+3
1683 22         +1  3718                                             ret
                +1  3719     ;bufind+4..bufind+9
                +1  3720     ;-  - - -
                +1  3721     ;- - - - - - - - - -
                +1  3722     ;adec..adec+9
                +1  3723     ;ст            мл
1684 7847       +1  3724     upakA:  mov             r0,#bufind+7;
1686 795C       +1  3725                     mov             r1,#adec+9
1688 7F04       +1  3726                     mov             r7,#4
168A C3         +1  3727     upaa:   clr             c
168B E6         +1  3728                     mov             a,@r0
168C 9430       +1  3729                     subb    a,#30h
168E F7         +1  3730                     mov             @r1,a
168F 18         +1  3731                     dec             r0
1690 19         +1  3732                     dec             r1
1691 DFF7       +1  3733                     djnz    r7,upaa
1693 22         +1  3734                     ret
                +1  3735     
                +1  3736     ;bufind+4..bufind+9
                +1  3737     ;-  - - -
                +1  3738     ;- - - - - - - - - -
                +1  3739     ;adec..adec+9
                +1  3740     ;ст            мл
1694 7848       +1  3741     upakB:  mov             r0,#bufind+8;
1696 795C       +1  3742                     mov             r1,#adec+9
1698 7F05       +1  3743                     mov             r7,#5
169A C3         +1  3744     upab:   clr             c
169B E6         +1  3745                     mov             a,@r0
169C 9430       +1  3746                     subb    a,#30h
169E F7         +1  3747                     mov             @r1,a
169F 18         +1  3748                     dec             r0
16A0 19         +1  3749                     dec             r1
16A1 DFF7       +1  3750                     djnz    r7,upab
16A3            +1  3751                     clr                     bitznB
*** _________________________________________________________________^
*** ERROR #A45 IN 3751 (d:\amp\subr2.asm, LINE 326): UNDEFINED SYMBOL (PASS-2)
16A5 E543       +1  3752                     mov             a,bufind+3
16A7 B42D02     +1  3753                     cjne            a,#2dh,abret
16AA            +1  3754                     setb            bitznB
*** _________________________________________________________^
*** ERROR #A45 IN 3754 (d:\amp\subr2.asm, LINE 329): UNDEFINED SYMBOL (PASS-2)
16AC            +1  3755     abret:
16AC 22         +1  3756                     ret
16AD            +1  3757     CH_B:                   db      ;       4bh,18h,96h,80h;989680h=10 **7
16AD 4E6E6AA8   +1  3758                                             db      4eh,6eh,6ah,0a8h;10**9
16B1 43FA0000   +1  3759     CH_500:         db              43h,0fah,00,00;1fah=500
16B5 4856D800   +1  3760     CH_22T:         db              48h,56h,0d8h,00;46h,0abh,0e0h,00;55f0h=22000
16B9 49742400   +1  3761     CH_fl:  db      49h,74h,24h,00;47h,0c3h,50h,00;100000
                +1  3762     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    60

                +1  3763     
                +1  3764     
                +1  3765     ;управление AD7731
                +1  3766     ;r4=b1 r5=b2
1400            +1  3767     iniacp: ;управление AD7731
*** _________________________^
*** ERROR #A8 IN 3767 (d:\amp\subr2.asm, LINE 342): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
16BD 7403       +1  3768                             mov             a,#03
                +1  3769     
16BF 120000   F +1  3770                             call    write
16C2 EC         +1  3771                             mov             a,r4;#80h
16C3 120000   F +1  3772                             call    write
16C6 ED         +1  3773                             mov             a,r5;#04
16C7 120000   F +1  3774                             call    write
16CA 7402       +1  3775                             mov             a,#02
16CC 120000   F +1  3776                             call    write
16CF 74A1       +1  3777                             mov             a,#0a1h
16D1 120000   F +1  3778                             call    write
16D4 7474       +1  3779                             mov             a,#74h
16D6 120000   F +1  3780                             call    write
16D9 2095FD     +1  3781                             jb              p1.5,$;p1.3,$
16DC 7402       +1  3782                             mov             a,#02
16DE 120000   F +1  3783                             call    write
16E1 7481       +1  3784                             mov             a,#81h
16E3 120000   F +1  3785                             call    write
16E6 7474       +1  3786                             mov             a,#74h
16E8 120000   F +1  3787                             call    write
16EB 2095FD     +1  3788                             jb              p1.5,$;p1.3,$
16EE 7402       +1  3789                             mov             a,#02
16F0 120000   F +1  3790                             call    write
16F3 7421       +1  3791                             mov             a,#21h
16F5 120000   F +1  3792                             call    write
16F8 7474       +1  3793                             mov             a,#74h
16FA 120000   F +1  3794                             call    write
16FD 22         +1  3795                             ret
                +1  3796                             ;;;;;;;;;;;;;;;;
                +1  3797     ;;;;;;;;;;;;;;;;;
                +1  3798     ;;;;;;;;;;;;;;;;;
16FE 0000       +1  3799     tabB1_2:                db              00,00            ;B1,B2 в соотв с Tизм  
*** _________________________^
*** ERROR #A8 IN 3799 (d:\amp\subr2.asm, LINE 374): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
1700 6000       +1  3800                                     db              60h,00h;40h,04h         ;10s
1702 6000       +1  3801                                     db              60h,00;40h,04h          ;1s
1704 4004       +1  3802                                     db              40h,04h         ;0,1s
1706 2004       +1  3803                                     db              20h,04h         ;50ms
1708 2004       +1  3804                                     db              20h,04h          ;10ms
170A 1332       +1  3805                                     db              13h,32h         ;2ms
                +1  3806     
                +1  3807     ;загр В1,В2 в завис от Т                                
170C 799A       +1  3808     loab12:                 mov             r1,#parT
*** _________________________^
*** ERROR #A8 IN 3808 (d:\amp\subr2.asm, LINE 383): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
170E 900000   F +1  3809                                     mov             dptr,#tabB1_2
1711 E7         +1  3810                                     mov             a,@r1
1712 23         +1  3811                                     rl              a;*2
1713 FF         +1  3812                                     mov             r7,a                    ;save a
1714 93         +1  3813                                     movc    a,@a+dptr
1715 FC         +1  3814                                     mov             r4,a   ;b1
1716 0F         +1  3815                                     inc             r7
1717 EF         +1  3816                                     mov             a,r7
1718 93         +1  3817                                     movc    a,@a+dptr
1719 FD         +1  3818                                     mov             r5,a
                +1  3819                                     ;после загр В1,2 загр упр слово для нового Т
                +1  3820                             
171A 22         +1  3821                                     ret
                +1  3822     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    61

                +1  3823     
171B 7852       +1  3824     loadr2: mov             r0,#abin+3              ;r2..r5
*** _________________________^
*** ERROR #A8 IN 3824 (d:\amp\subr2.asm, LINE 399): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
171D E6         +1  3825                     mov             a,@r0                   ; ст мл   
171E FA         +1  3826                     mov             r2,a
171F 18         +1  3827                     dec             r0
1720 E6         +1  3828                     mov             a,@r0
1721 FB         +1  3829                     mov             r3,a
1722 18         +1  3830                     dec             r0
1723 E6         +1  3831                     mov             a,@r0
1724 FC         +1  3832                     mov             r4,a
1725 18         +1  3833                     dec             r0
1726 E6         +1  3834                     mov             a,@r0
1727 FD         +1  3835                     mov             r5,a
1728 22         +1  3836                     ret
                +1  3837                                             
                +1  3838      ;;;;;;;;;;;;;;;;;;;      
                +1  3839      ;загрузка KD в зависимости от диап изм  
                +1  3840      ;koef->r8..r11
1729 78AE       +1  3841     loadKD:                 mov             r0,#diap
*** _________________________^
*** ERROR #A8 IN 3841 (d:\amp\subr2.asm, LINE 416): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
172B E6         +1  3842                                     mov             a,@r0
172C 900000   F +1  3843                                     mov             dptr,#diKDn
172F 75F004     +1  3844                                     mov             b,#4
1732 A4         +1  3845                                     mul             ab
1733 FF         +1  3846                                     mov             r7,a;save
1734 93         +1  3847                                     movc    a,@a+dptr
1735 F508       +1  3848                                     mov             r8,a
1737 A3         +1  3849                                     inc             dptr
1738 EF         +1  3850                                     mov             a,r7
1739 93         +1  3851                                     movc    a,@a+dptr
173A F509       +1  3852                                     mov             r9,a
173C A3         +1  3853                                     inc             dptr
173D EF         +1  3854                                     mov             a,r7
173E 93         +1  3855                                     movc    a,@a+dptr
173F F50A       +1  3856                                     mov             r10,a
1741 A3         +1  3857                                     inc             dptr
1742 EF         +1  3858                                     mov             a,r7
1743 93         +1  3859                                     movc    a,@a+dptr
1744 F50B       +1  3860                                     mov             r11,a
1746 22         +1  3861                                     ret
                +1  3862     
1747 3F506B7B   +1  3863      diKDn:                 db              3fh,50h,6bh,7bh;3fh,80h,00,00           ;10-2
*** __________________________^
*** ERROR #A8 IN 3863 (d:\amp\subr2.asm, LINE 438): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
174B 3F507FCC   +1  3864                                     db              3fh,50h,7fh,0cch;3fh,80h,00,00          ;10
                             -3
174F 3F4F9D0B   +1  3865                                     db              3fh,4fh,9dh,0bh;3fh,80h,00,00           ;10
                             -4
1753 3F4FE869   +1  3866                                     db              3fh,4fh,0e8h,69h;3fh,80h,00,00          ;10
                             -5
1757 3F50294A   +1  3867                                     db              3fh,50h,29h,4ah;3fh,80h,00,00;4fh,0e9h,11h 
                                  ;0,81215   10-6
175B 3F50639E   +1  3868                                      db             3fh,50h,63h,9eh;3fh,80h,00,00           ;10
                             -7
175F 3F4BC9F0   +1  3869                                     db              3fh,4bh,0c9h,0f0h;3fh,80h,00,00         ;10
                             -8
1763 3F4C063B   +1  3870                                     db              3fh,4ch,06h,3bh;3fh,80h,00,00           ;10
                             -9
1767 3F50EFDD   +1  3871                                     db              3fh,50h,0efh,0ddh;3fh,80h,00,00         ;10
                             -10
176B 3F512AD9   +1  3872                                     db              3fh,51h,2ah,0d9h;3fh,80h,00,00          ;10
                             -11
                +1  3873     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    62

176F 00000039   +1  3874     ch57:   db      00,00,00,39h;57
*** _________________________^
*** ERROR #A8 IN 3874 (d:\amp\subr2.asm, LINE 449): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
1773 00000014   +1  3875     ch20:   db      00,00,00,14h;20
*** _________________________^
*** ERROR #A8 IN 3875 (d:\amp\subr2.asm, LINE 450): ATTEMPT TO DEFINE AN ALREADY DEFINED LABEL
                +1  3876     
                +1  3877     ;загр ус для тестов ацп 
                +1  3878     ;dptr-
1777 78B1       +1  3879     lotpus: mov             r0,#vichR
1779 B6210D     +1  3880                                     cjne    @r0,#21h,te22
177C 900000   F +1  3881                                     mov                     dptr,#tabt11;заслать ус 11А
177F E4         +1  3882     lotp:           clr             a
1780 93         +1  3883                             movc    a,@a+dptr                               ;high byte
1781 F584       +1  3884                             mov             p4,a
1783 A3         +1  3885                             inc             dptr
1784 E4         +1  3886                             clr             a
1785 93         +1  3887                             movc    a,@a+dptr                               ;low byte
1786 F585       +1  3888                             mov             p5,a
1788 22         +1  3889                             ret
1789 B62205     +1  3890     te22:                   cjne    @r0,#22h,te23
178C 900000   F +1  3891                             mov                     dptr,#tabt9;заслать ус 9А       
178F 80EE       +1  3892                             jmp                     lotp
                +1  3893     
1791 900000   F +1  3894     te23:   mov                     dptr,#tabt7;заслать ус 7А       
1794 80E9       +1  3895                             jmp                     lotp
                +1  3896     
                +1  3897     
                +1  3898     
                +1  3899     
                +1  3900     
1796 02030405   +1  3901     Tabn:           db              2,3,4,5,6,7,8,9,10,11                           ;порядок ди
                             апазонов степени
179A 06070809                
179E 0A0B                    
                +1  3902     
17A0 78AE       +1  3903     findR:                  mov                     r0,#diap
17A2 E6         +1  3904                                                     mov                     a,@r0
17A3 900000   F +1  3905                                                     mov                     dptr,#Tabn
17A6 93         +1  3906                                                     movc            a,@a+dptr
17A7 22         +1  3907                                                     ret
                    3908     
                    3909     ;$include (d:\amp\sarifm3.asm) 
                +1  3910     ; ” ©« SARIFM.ASM 8.11.95
                +1  3911     ;файл арифметики
                +1  3912       
  0008          +1  3913     ltemp    equ       8           ;long temporary
  000C          +1  3914     xtemp    equ       12          ;other temporaries
  000A          +1  3915     DECSIZE  EQU       10
  0004          +1  3916     NUMSIZE  EQU       4
  0004          +1  3917     RR4  EQU       4
  0005          +1  3918     RR5  EQU       5
                +1  3919     
                +1  3920                                                     
                +1  3921     
                +1  3922                 ; rseg     ARIF          ; Switch to this code segment.
                +1  3923     ;             using    0              ; Specify register bank for the following
                +1  3924                                            ; program code.
                +1  3925     ;                                               cseg AT 400h
                +1  3926     ; Arithmetics:  CLEARING string
                +1  3927     ; Input:
                +1  3928     ; R0 - pointer to string,
                +1  3929     ; NUMSIZE - byte count if CLRNUM used,
                +1  3930     ; DECSIZE - byte count if CLRDEC used,
                +1  3931     ; R2 - byte count if CLEAR used;
                +1  3932     ; Output:  none.
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    63

                +1  3933     
17A8            +1  3934     CLRDEC:
17A8 7A0A       +1  3935         MOV R2, #DECSIZE
17AA 8002       +1  3936         SJMP    CLEAR
17AC            +1  3937     CLRNUM:
17AC 7A04       +1  3938         MOV R2, #NUMSIZE
                +1  3939         ;JMP    CLEAR
17AE            +1  3940     CLEAR:
17AE E4         +1  3941         CLR A
17AF F6         +1  3942     CLR11:  MOV @R0, A
17B0 08         +1  3943         INC R0
17B1 DAFC       +1  3944         DJNZ    R2, CLR11
17B3 22         +1  3945         RET
                +1  3946     
                +1  3947     ;**********************************
                +1  3948     ;mov    r1,#abin+3
                +1  3949     ;mov    r0,#adec
                +1  3950     ; _ _ _ _
                +1  3951     ;     03ff
                +1  3952     ;ст     мл   - вход
                +1  3953     ; _ _ _ _ _ _ _ _ _ _
                +1  3954     ;             1 0 2 3
                +1  3955     ;ст                мл 
                +1  3956     ;**********************************
                +1  3957     
17B4            +1  3958     BINDEC:
                +1  3959     ; Arithmetics:  CONVERTING from binary into decimal "4->10"
                +1  3960     ; Input:
                +1  3961     ; R0 - pointer to destination (high digit is the first),
                +1  3962     ; R1 - pointer to source,
                +1  3963     ; NUMSIZE - byte count in binary number;
                +1  3964     ; DECSIZE - byte count in decimal number;
                +1  3965     ; Output:  none.
                +1  3966     ; Source saved
                +1  3967     
                +1  3968         ; 1. Clear result
17B4 7A05       +1  3969         MOV R2, #DECSIZE/2
17B6 120000   F +1  3970         CALL   CLEAR  ; incrementing R0
                +1  3971     
                +1  3972         ; 2. Prepare convertion
17B9 18         +1  3973         DEC R0
17BA 8804       +1  3974         MOV RR4, R0 ; R4 - pointer to low byte of packed decimal result
17BC 8905       +1  3975         MOV RR5, R1 ; R5 - pointer to low byte of binary number
17BE 7B20       +1  3976         MOV R3, #NUMSIZE*8  ; R3 - bit counter in binary number
                +1  3977     
                +1  3978         ; 3. Convert cyrcle
17C0            +1  3979     BIN30:
                +1  3980     
                +1  3981         ; 3.1. Rotate binary number one bit to left and prepare <Carry>
17C0 A905       +1  3982         MOV R1, RR5
17C2 7A04       +1  3983         MOV R2, #NUMSIZE
17C4 E7         +1  3984     BIN31:  MOV A, @R1
17C5 33         +1  3985         RLC A
17C6 F7         +1  3986         MOV @R1, A
17C7 19         +1  3987         DEC R1
17C8 DAFA       +1  3988         DJNZ    R2, BIN31
17CA A905       +1  3989         MOV R1, RR5
17CC E7         +1  3990         MOV A, @R1
17CD 92E0       +1  3991         MOV ACC.0, C
17CF F7         +1  3992         MOV @R1, A
                +1  3993     
                +1  3994         ; 3.2. Doubling decimal result with <Carry>
17D0 A804       +1  3995         MOV R0, RR4
17D2 7A05       +1  3996         MOV R2, #DECSIZE/2
17D4 E6         +1  3997     BIN32:  MOV A, @R0
17D5 36         +1  3998         ADDC    A, @R0
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    64

17D6 D4         +1  3999         DA  A
17D7 F6         +1  4000         MOV @R0, A
17D8 18         +1  4001         DEC R0
17D9 DAF9       +1  4002         DJNZ    R2, BIN32
                +1  4003     
                +1  4004         ; 3.3. End of convert cyrcle
17DB DBE3       +1  4005         DJNZ    R3, BIN30
                +1  4006     
                +1  4007         ; 4. Make bytes from half-bytes
17DD E8         +1  4008         MOV A, R0
17DE 240A       +1  4009         ADD A, #DECSIZE
17E0 F8         +1  4010         MOV R0, A   ; R0 - pointer to low byte of unpacked decimal result
17E1 A904       +1  4011         MOV R1, RR4 ; R1 - pointer to low byte of packed decimal result
17E3 7A05       +1  4012         MOV R2, #DECSIZE/2
17E5 E7         +1  4013     BIN41:  MOV A, @R1
17E6 540F       +1  4014         ANL A, #00FH
17E8 F6         +1  4015         MOV @R0, A
17E9 18         +1  4016         DEC R0
17EA E7         +1  4017         MOV A, @R1
17EB C4         +1  4018         SWAP    A
17EC 540F       +1  4019         ANL A, #00FH
17EE F6         +1  4020         MOV @R0, A
17EF 18         +1  4021         DEC R0
17F0 19         +1  4022         DEC R1
17F1 DAF2       +1  4023         DJNZ    R2, BIN41
17F3 22         +1  4024         RET
                +1  4025     
                +1  4026     
                +1  4027     ;*********************************
                +1  4028     ;mov    r0,#abin
                +1  4029     ;mov    r1,#adec
                +1  4030     ; _ _ _ _       -выход
                +1  4031     ; ff0000
                +1  4032     ;0004
                +1  4033     ;мл      ст
                +1  4034     
                +1  4035     ;ст                       мл
                +1  4036     ;_ _ _ _ _ _ _ _ _ _     вход
                +1  4037     ;                       2 5 5
                +1  4038     ;                   1 0 2 4
                +1  4039     
17F4            +1  4040     DECBIN:
                +1  4041     ; Arithmetics:  CONVERTING from decimal into binary "10->4"
                +1  4042     ; Input:
                +1  4043     ; R0 - pointer to destination,
                +1  4044     ; R1 - pointer to source (high digit is the first),
                +1  4045     ; NUMSIZE - byte count in binary number;
                +1  4046     ; DECSIZE - byte count in decimal number;
                +1  4047     ; Output:  none
                +1  4048     ; Source cleared
                +1  4049     
                +1  4050         ; 1. Clear result
17F4 120000   F +1  4051         CALL    CLRNUM    ; + increment R0 by NUMSIZE
                +1  4052     
                +1  4053         ; 2. Prepare convertion
17F7 18         +1  4054         DEC R0
17F8 8804       +1  4055         MOV RR4, R0 ; R4 - pointer to high byte of binary result
17FA 8905       +1  4056         MOV RR5, R1 ; R5 - pointer to high byte of packed decimal number
17FC 900000   F +1  4057         MOV DPTR, #DECT2
17FF 7B20       +1  4058         MOV R3, #NUMSIZE*8  ; R3 - bit counter in binary number
                +1  4059     
                +1  4060         ; 3. Convert cyrcle
1801            +1  4061     DEC30:
                +1  4062     
                +1  4063         ; 3.1. Divide decimal number by 2 and prepare <Carry>
1801 C3         +1  4064         CLR C
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    65

1802 A905       +1  4065         MOV R1, RR5
1804 7A0A       +1  4066         MOV R2, #DECSIZE
1806 E7         +1  4067     DEC31:  MOV A, @R1
1807 540F       +1  4068         ANL A, #00FH
1809 92E4       +1  4069         MOV ACC.4, C
180B 93         +1  4070         MOVC    A,@A+DPTR
180C F7         +1  4071         MOV @R1, A
180D A2E7       +1  4072         MOV C, ACC.7
180F 09         +1  4073         INC R1
1810 DAF4       +1  4074         DJNZ    R2, DEC31
                +1  4075     
                +1  4076         ; 3.2. Rotate binary result one bit to right with <Carry>
1812 A804       +1  4077         MOV R0, RR4
1814 7A04       +1  4078         MOV R2, #NUMSIZE
1816 E6         +1  4079     DEC32:  MOV A, @R0
1817 13         +1  4080         RRC A
1818 F6         +1  4081         MOV @R0, A
1819 18         +1  4082         DEC R0
181A DAFA       +1  4083         DJNZ    R2, DEC32
                +1  4084     
                +1  4085         ; 3.3. End of convert cyrcle
181C DBE3       +1  4086         DJNZ    R3, DEC30
181E 22         +1  4087         RET
                +1  4088     
181F 00800181   +1  4089     DECT2:  DB  00,80H,001,81H,02,82H,03,83H,04,84H
1823 02820383                
1827 0484                    
1829 00000000   +1  4090         DB  00,00,00,00,00,00
182D 0000                    
182F 05850686   +1  4091         DB  05,85H,06,86H,07,87H,08H,88H,09H,89H
1833 07870888                
1837 0989                    
                +1  4092     
                +1  4093     ;   Long comparison
                +1  4094     ;   Lcmp - called with arg1 in r2-r5 and arg2 in ltemp - returns with
                +1  4095     ;   flags and acc set as though a long subtraction was done.
                +1  4096     ;*******************************
                +1  4097     ;сравнить r2..r5 с (ltemp..ltemp+3)
                +1  4098     ;c=1     r2..r5< ltemp..ltemp+3     a<b
                +1  4099     ;c=0       r2..r5> ltemp..ltemp+3   a>b
                +1  4100     ;*******************************
1839            +1  4101     lcmp:
1839 C3         +1  4102         clr c
183A EA         +1  4103         mov a,r2
183B 9508       +1  4104         subb    a,8
183D 700F       +1  4105         jnz done
183F EB         +1  4106         mov a,r3
1840 9509       +1  4107         subb    a,9
1842 7008       +1  4108         jnz done1
1844 EC         +1  4109         mov a,r4
1845 950A       +1  4110         subb    a,10
1847 7003       +1  4111         jnz done1
1849 ED         +1  4112         mov a,r5
184A 950B       +1  4113         subb    a,11
184C            +1  4114     done1:
184C C2D2       +1  4115         clr ov      ;overflow is significant only for top byte
184E            +1  4116     done:
184E 22         +1  4117         ret
                +1  4118     
                +1  4119     ;   Load long into r2-5 from [dptr]
                +1  4120     
184F            +1  4121     ldc_long:
184F E583       +1  4122         mov a,dph       ;is it in on board memory
1851 6010       +1  4123         jz  onboard     ;yes
1853 E4         +1  4124         clr a
1854 93         +1  4125         movc    a,@a+dptr
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    66

1855 FA         +1  4126         mov r2,a
1856 7401       +1  4127         mov a,#1
1858 93         +1  4128         movc    a,@a+dptr
1859 FB         +1  4129         mov r3,a
185A 7402       +1  4130         mov a,#2
185C 93         +1  4131         movc    a,@a+dptr
185D FC         +1  4132         mov r4,a
185E 7403       +1  4133         mov a,#3
1860 93         +1  4134         movc    a,@a+dptr
1861 FD         +1  4135         mov r5,a
1862 22         +1  4136         ret
1863            +1  4137     onboard:
1863 A882       +1  4138         mov r0,dpl
1865 E6         +1  4139         mov a,@r0
1866 FA         +1  4140         mov r2,a
1867 08         +1  4141         inc r0
1868 E6         +1  4142         mov a,@r0
1869 FB         +1  4143         mov r3,a
186A 08         +1  4144         inc r0
186B E6         +1  4145         mov a,@r0
186C FC         +1  4146         mov r4,a
186D 08         +1  4147         inc r0
186E E6         +1  4148         mov a,@r0
186F FD         +1  4149         mov r5,a
1870 22         +1  4150         ret
                +1  4151     
                +1  4152     ;**************************************
                +1  4153     ;загрузить ltemp...+3 из памяти программ
                +1  4154     ;mov    dptr,#CH5
                +1  4155     ;call   ldc_ltemp        ltemp <--5
                +1  4156     ;**************************************
1871            +1  4157     ldc_ltemp:
1871 E583       +1  4158         mov a,dph       ;is it in on board memory
1873 6014       +1  4159         jz  oboard      ;yes
1875 E4         +1  4160         clr a
1876 93         +1  4161         movc    a,@a+dptr
1877 F508       +1  4162         mov 8,a
1879 7401       +1  4163         mov a,#1
187B 93         +1  4164         movc    a,@a+dptr
187C F509       +1  4165         mov 9,a
187E 7402       +1  4166         mov a,#2
1880 93         +1  4167         movc    a,@a+dptr
1881 F50A       +1  4168         mov 10,a
1883 7403       +1  4169         mov a,#3
1885 93         +1  4170         movc    a,@a+dptr
1886 F50B       +1  4171         mov 11,a
1888 22         +1  4172         ret
1889            +1  4173     oboard:
1889 A882       +1  4174         mov r0,dpl
188B 8608       +1  4175         mov 8,@r0
188D 08         +1  4176         inc r0
188E 8609       +1  4177         mov 9,@r0
1890 08         +1  4178         inc r0
1891 860A       +1  4179         mov 10,@r0
1893 08         +1  4180         inc r0
1894 860B       +1  4181         mov 11,@r0
1896 22         +1  4182         ret
                +1  4183     
                +1  4184     ;*****************************
                +1  4185     ;mov    dptr,#k1
                +1  4186     ;call   ldx_long
                +1  4187     ;k1->r2..r5
                +1  4188     ;*****************************
                +1  4189     ;   Load long into r2-5 from [dptr]
                +1  4190     ;
                +1  4191     ; 01/30/90 JLZ      Updated from new library; added save/restore DPH, DPL
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    67

1897            +1  4192     ldx_long:
1897 E583       +1  4193         mov a,dph       ;is it in on board memory
1899 6014       +1  4194         jz  onboar1        ;yes
189B C082       +1  4195         push    dpl
189D C083       +1  4196         push    dph
189F E0         +1  4197         movx    a,@dptr
18A0 FA         +1  4198         mov r2,a
18A1 A3         +1  4199         inc dptr
18A2 E0         +1  4200         movx    a,@dptr
18A3 FB         +1  4201         mov r3,a
18A4 A3         +1  4202         inc dptr
18A5 E0         +1  4203         movx    a,@dptr
18A6 FC         +1  4204         mov r4,a
18A7 A3         +1  4205         inc dptr
18A8 E0         +1  4206         movx    a,@dptr
18A9 FD         +1  4207         mov r5,a
18AA D083       +1  4208         pop dph
18AC D082       +1  4209         pop dpl
18AE 22         +1  4210         ret
18AF            +1  4211     onboar1:
18AF A882       +1  4212         mov r0,dpl
18B1 E6         +1  4213         mov a,@r0
18B2 FA         +1  4214         mov r2,a
18B3 08         +1  4215         inc r0
18B4 E6         +1  4216         mov a,@r0
18B5 FB         +1  4217         mov r3,a
18B6 08         +1  4218         inc r0
18B7 E6         +1  4219         mov a,@r0
18B8 FC         +1  4220         mov r4,a
18B9 08         +1  4221         inc r0
18BA E6         +1  4222         mov a,@r0
18BB FD         +1  4223         mov r5,a
18BC 22         +1  4224         ret
                +1  4225     
                +1  4226     ;*********************************
                +1  4227     ;mov    dptr,#k2
                +1  4228     ;call   ldx_ltemp       ;k2->ltemp..ltemp+3
                +1  4229     ;**********************************
18BD            +1  4230     ldx_ltemp:
18BD E583       +1  4231         mov a,dph       ;is it in on board memory
18BF 6010       +1  4232         jz  oboard1     ;yes
18C1 E0         +1  4233         movx    a,@dptr
18C2 F508       +1  4234         mov 8,a
18C4 A3         +1  4235         inc dptr
18C5 E0         +1  4236         movx    a,@dptr
18C6 F509       +1  4237         mov 9,a
18C8 A3         +1  4238         inc dptr
18C9 E0         +1  4239         movx    a,@dptr
18CA F50A       +1  4240         mov 10,a
18CC A3         +1  4241         inc dptr
18CD E0         +1  4242         movx    a,@dptr
18CE F50B       +1  4243         mov 11,a
18D0 22         +1  4244         ret
18D1            +1  4245     oboard1:
18D1 A882       +1  4246         mov r0,dpl
18D3 8608       +1  4247         mov 8,@r0
18D5 08         +1  4248         inc r0
18D6 8609       +1  4249         mov 9,@r0
18D8 08         +1  4250         inc r0
18D9 860A       +1  4251         mov 10,@r0
18DB 08         +1  4252         inc r0
18DC 860B       +1  4253         mov 11,@r0
18DE 22         +1  4254         ret
                +1  4255     ;   Long division routines for 8051
                +1  4256     ;   Divide is called with the divisor in ltemp, the dividend in r5-r2
                +1  4257     ;   It returns with the quotient in r5-r2 and the remainder in ltemp
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    68

                +1  4258     ;   The top of bank 1 (locations 12-15) are used as a long temporary
                +1  4259     ;   and registers r0 and r1 in bank 0 are used as temporaries. R0 and
                +1  4260     ;   r1 must be saved by the caller.
                +1  4261     ;   This is long unsigned division.
                +1  4262     
                +1  4263     
                +1  4264     ;   Register usage:
                +1  4265     ;       r0 loop counter
                +1  4266     ;       xtemp (12-15) accumulates quotient
                +1  4267     ;       r5-r2 holds dividend
                +1  4268     ;       ltemp holds divisor
                +1  4269     
                +1  4270     ;************************************
                +1  4271     ;r2..r5-делимое
                +1  4272     ;ltemp..-делитель
                +1  4273     ;частное -r2..r5
                +1  4274     ;*************************************
18DF            +1  4275     divide:
18DF E4         +1  4276         clr a
18E0 F8         +1  4277         mov r0,a        ;initialize count
18E1 F50C       +1  4278         mov xtemp,a     ;zero quotient
18E3 F50D       +1  4279         mov xtemp+1,a
18E5 F50E       +1  4280         mov xtemp+2,a
18E7 F50F       +1  4281         mov xtemp+3,a
18E9 ED         +1  4282         mov a,r5        ;check for zero dividend
18EA 4C         +1  4283         orl a,r4
18EB 4B         +1  4284         orl a,r3
18EC 4A         +1  4285         orl a,r2
18ED 600B       +1  4286         jz  jfinis
18EF E508       +1  4287         mov a,ltemp     ;check for zero divisor
18F1 4509       +1  4288         orl a,ltemp+1
18F3 450A       +1  4289         orl a,ltemp+2
18F5 450B       +1  4290         orl a,ltemp+3
18F7 7037       +1  4291         jnz midl
18F9 22         +1  4292         ret
                +1  4293     
18FA 020000   F +1  4294     jfinis: jmp finis
                +1  4295     
18FD            +1  4296     loops:
18FD EA         +1  4297         mov a,r2
18FE C3         +1  4298         clr c
18FF 9508       +1  4299         subb    a,ltemp+0   ;is divisor greater than dividend yet
1901 4033       +1  4300         jc  yes     ;yes, go no further
1903 7013       +1  4301         jnz no
1905 EB         +1  4302         mov a,r3
1906 9509       +1  4303         subb    a,ltemp+1
1908 402C       +1  4304         jc  yes
190A 700C       +1  4305         jnz no
190C EC         +1  4306         mov a,r4
190D 950A       +1  4307         subb    a,ltemp+2
190F 4025       +1  4308         jc  yes
1911 7005       +1  4309         jnz no
1913 ED         +1  4310         mov a,r5
1914 950B       +1  4311         subb    a,ltemp+3
1916 401E       +1  4312         jc  yes
1918            +1  4313     no:
1918 E50B       +1  4314         mov a,ltemp+3   ;shift divisor up one bit
191A 250B       +1  4315         add a,ltemp+3
191C F50B       +1  4316         mov ltemp+3,a
191E E50A       +1  4317         mov a,ltemp+2
1920 350A       +1  4318         addc    a,ltemp+2
1922 F50A       +1  4319         mov ltemp+2,a
1924 E509       +1  4320         mov a,ltemp+1
1926 3509       +1  4321         addc    a,ltemp+1
1928 F509       +1  4322         mov ltemp+1,a
192A E508       +1  4323         mov a,ltemp+0
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    69

192C 3508       +1  4324         addc    a,ltemp+0
192E F508       +1  4325         mov ltemp+0,a
1930            +1  4326     midl:
1930 08         +1  4327         inc r0      ;increment count
1931 E508       +1  4328         mov a,ltemp+0   ;check for safe to shift some more
1933 30E7C7     +1  4329         jnb acc.7,loops  ;loop if top bit clear
1936            +1  4330     yes:
1936 E508       +1  4331         mov a,ltemp+0
1938 C3         +1  4332         clr c
1939 9A         +1  4333         subb    a,r2        ;can we subtract now?
193A 401A       +1  4334         jc  dosub       ;yes, go and do it
193C 7015       +1  4335         jnz nosub
193E E509       +1  4336         mov a,ltemp+1
1940 9B         +1  4337         subb    a,r3
1941 4013       +1  4338         jc  dosub
1943 700E       +1  4339         jnz nosub
1945 E50A       +1  4340         mov a,ltemp+2
1947 9C         +1  4341         subb    a,r4
1948 400C       +1  4342         jc  dosub
194A 7007       +1  4343         jnz nosub
194C E50B       +1  4344         mov a,ltemp+3
194E 9D         +1  4345         subb    a,r5
194F 4005       +1  4346         jc  dosub
1951 6003       +1  4347         jz  dosub
1953            +1  4348     nosub:
1953 C3         +1  4349         clr c
1954 8012       +1  4350         sjmp    dosh
1956            +1  4351     dosub:
1956 C3         +1  4352         clr c       ;subtract divisor from dividend
1957 ED         +1  4353         mov a,r5
1958 950B       +1  4354         subb    a,ltemp+3
195A FD         +1  4355         mov r5,a
195B EC         +1  4356         mov a,r4
195C 950A       +1  4357         subb    a,ltemp+2
195E FC         +1  4358         mov r4,a
195F EB         +1  4359         mov a,r3
1960 9509       +1  4360         subb    a,ltemp+1
1962 FB         +1  4361         mov r3,a
1963 EA         +1  4362         mov a,r2
1964 9508       +1  4363         subb    a,ltemp+0
1966 FA         +1  4364         mov r2,a
1967 D3         +1  4365         setb    c       ;now set bit for quotient
1968            +1  4366     dosh:
1968 E50F       +1  4367         mov a,xtemp+3
196A 33         +1  4368         rlc a
196B F50F       +1  4369         mov xtemp+3,a
196D E50E       +1  4370         mov a,xtemp+2
196F 33         +1  4371         rlc a
1970 F50E       +1  4372         mov xtemp+2,a
1972 E50D       +1  4373         mov a,xtemp+1
1974 33         +1  4374         rlc a
1975 F50D       +1  4375         mov xtemp+1,a
1977 E50C       +1  4376         mov a,xtemp+0
1979 33         +1  4377         rlc a
197A F50C       +1  4378         mov xtemp+0,a
197C E508       +1  4379         mov a,ltemp+0       ;shift divisor down
197E C3         +1  4380         clr c
197F 13         +1  4381         rrc a
1980 F508       +1  4382         mov ltemp+0,a
1982 E509       +1  4383         mov a,ltemp+1
1984 13         +1  4384         rrc a
1985 F509       +1  4385         mov ltemp+1,a
1987 E50A       +1  4386         mov a,ltemp+2
1989 13         +1  4387         rrc a
198A F50A       +1  4388         mov ltemp+2,a
198C E50B       +1  4389         mov a,ltemp+3
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    70

198E 13         +1  4390         rrc a
198F F50B       +1  4391         mov ltemp+3,a
                +1  4392     
1991 D8A3       +1  4393         djnz    r0,yes      ;and continue with the rest
                +1  4394     
1993            +1  4395     finis:
1993 8D0B       +1  4396         mov ltemp+3,r5
1995 8C0A       +1  4397         mov ltemp+2,r4
1997 8B09       +1  4398         mov ltemp+1,r3
1999 8A08       +1  4399         mov ltemp+0,r2
199B AD0F       +1  4400         mov r5,xtemp+3
199D AC0E       +1  4401         mov r4,xtemp+2
199F AB0D       +1  4402         mov r3,xtemp+1
19A1 AA0C       +1  4403         mov r2,xtemp+0
19A3 22         +1  4404         ret         ;and return with the satisfaction of a job well done
                +1  4405     
                +1  4406     
                +1  4407     ;   Long multiplication
                +1  4408     ;   The main multiply thingo. Called with one operand in r5-r2 and the
                +1  4409     ;   other in ltemp. It really doesn't matter which one is where.
                +1  4410     
                +1  4411     ;**********************************
                +1  4412     ;(r2..r5)*(ltemp..ltemp+3)=r2..r5
                +1  4413     ;ст  мл
                +1  4414     ;**********************************
19A4            +1  4415     llmul:
19A4            +1  4416     almul:
19A4            +1  4417     lmul:
19A4 ED         +1  4418         mov a,r5        ;low order byte
19A5 850BF0     +1  4419         mov b,ltemp+3       ;times low order byte
19A8 A4         +1  4420         mul ab
19A9 F50F       +1  4421         mov xtemp+3,a       ;store low
19AB 85F00E     +1  4422         mov xtemp+2,b   ;and high
19AE ED         +1  4423         mov a,r5        ;low order
19AF 850AF0     +1  4424         mov b,ltemp+2   ;times next
19B2 A4         +1  4425         mul ab
19B3 250E       +1  4426         add a,xtemp+2   ;add in
19B5 F50E       +1  4427         mov xtemp+2,a
19B7 E5F0       +1  4428         mov a,b
19B9 3400       +1  4429         addc    a,#0
19BB F50D       +1  4430         mov xtemp+1,a
19BD ED         +1  4431         mov a,r5
19BE 8509F0     +1  4432         mov b,ltemp+1
19C1 A4         +1  4433         mul ab
19C2 250D       +1  4434         add a,xtemp+1
19C4 F50D       +1  4435         mov xtemp+1,a
19C6 E5F0       +1  4436         mov a,b
19C8 3400       +1  4437         addc    a,#0
19CA F50C       +1  4438         mov xtemp+0,a
19CC ED         +1  4439         mov a,r5
19CD 8508F0     +1  4440         mov b,ltemp+0
19D0 A4         +1  4441         mul ab
19D1 250C       +1  4442         add a,xtemp+0
19D3 F50C       +1  4443         mov xtemp+0,a
19D5 EC         +1  4444         mov a,r4
19D6 850BF0     +1  4445         mov b,ltemp+3
19D9 A4         +1  4446         mul ab
19DA 250E       +1  4447         add a,xtemp+2
19DC F50E       +1  4448         mov xtemp+2,a
19DE E5F0       +1  4449         mov a,b
19E0 350D       +1  4450         addc    a,xtemp+1
19E2 F50D       +1  4451         mov xtemp+1,a
19E4 E50C       +1  4452         mov a,xtemp+0
19E6 3400       +1  4453         addc    a,#0
19E8 F50C       +1  4454         mov xtemp+0,a
19EA EC         +1  4455         mov a,r4
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    71

19EB 850AF0     +1  4456         mov b,ltemp+2
19EE A4         +1  4457         mul ab
19EF 250D       +1  4458         add a,xtemp+1
19F1 F50D       +1  4459         mov xtemp+1,a
19F3 E5F0       +1  4460         mov a,b
19F5 350C       +1  4461         addc    a,xtemp+0
19F7 F50C       +1  4462         mov xtemp+0,a
19F9 EC         +1  4463         mov a,r4
19FA 8509F0     +1  4464         mov b,ltemp+1
19FD A4         +1  4465         mul ab
19FE 250C       +1  4466         add a,xtemp+0
1A00 F50C       +1  4467         mov xtemp+0,a
                +1  4468     
1A02 EB         +1  4469         mov a,r3
1A03 850BF0     +1  4470         mov b,ltemp+3
1A06 A4         +1  4471         mul ab
1A07 250D       +1  4472         add a,xtemp+1
1A09 F50D       +1  4473         mov xtemp+1,a
1A0B E5F0       +1  4474         mov a,b
1A0D 350C       +1  4475         addc    a,xtemp+0
1A0F F50C       +1  4476         mov xtemp+0,a
1A11 EB         +1  4477         mov a,r3
1A12 850AF0     +1  4478         mov b,ltemp+2
1A15 A4         +1  4479         mul ab
1A16 250C       +1  4480         add a,xtemp+0
1A18 F50C       +1  4481         mov xtemp+0,a
                +1  4482     
1A1A EA         +1  4483         mov a,r2
1A1B 850BF0     +1  4484         mov b,ltemp+3
1A1E A4         +1  4485         mul ab
1A1F 250C       +1  4486         add a,xtemp+0
1A21 FA         +1  4487         mov r2,a
1A22 AB0D       +1  4488         mov r3,xtemp+1
1A24 AC0E       +1  4489         mov r4,xtemp+2
1A26 AD0F       +1  4490         mov r5,xtemp+3
                +1  4491     
1A28 22         +1  4492         ret         ;all done
                +1  4493     ;******************************
                +1  4494     ;из содержимого  r2-r5  вычесть
                +1  4495     ;содержимое          ltemp..ltemp+3
                +1  4496     ;******************************
1A29            +1  4497     llsub:
1A29            +1  4498      lsub:
1A29 ED         +1  4499         mov a,r5
1A2A C3         +1  4500         clr c
1A2B 950B       +1  4501         subb    a,11
1A2D FD         +1  4502         mov r5,a
1A2E EC         +1  4503         mov a,r4
1A2F 950A       +1  4504         subb    a,10
1A31 FC         +1  4505         mov r4,a
1A32 EB         +1  4506         mov a,r3
1A33 9509       +1  4507         subb    a,9
1A35 FB         +1  4508         mov r3,a
1A36 EA         +1  4509         mov a,r2
1A37 9508       +1  4510         subb    a,8
1A39 FA         +1  4511         mov r2,a
1A3A 22         +1  4512         ret
                +1  4513     
                +1  4514     ;***********************************************
                +1  4515     ;                                                      ст мл
                +1  4516     ; cложение содержимого  r2..r5 с числом по адресу
                +1  4517     ;  r0- адрес младшего байта !!!
                +1  4518     ;результат- r2..r5
                +1  4519     ;***********************************************
                +1  4520     
1A3B C3         +1  4521     ladd:    clr       c
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    72

1A3C ED         +1  4522          mov       a,r5
1A3D 26         +1  4523          add       a,@r0
1A3E FD         +1  4524          mov       r5,a
1A3F 18         +1  4525          dec       r0
1A40 EC         +1  4526          mov       a,r4
1A41 36         +1  4527          addc      a,@r0
1A42 FC         +1  4528          mov       r4,a
1A43 18         +1  4529          dec       r0
1A44 EB         +1  4530          mov       a,r3
1A45 36         +1  4531          addc      a,@r0
1A46 FB         +1  4532          mov       r3,a
1A47 18         +1  4533          dec       r0
1A48 EA         +1  4534          mov       a,r2
1A49 36         +1  4535          addc      a,@r0
1A4A FA         +1  4536          mov       r2,a
1A4B 22         +1  4537          ret
                +1  4538     ;***********************************************
                +1  4539     ;                                                      ст мл
                +1  4540     ; cложение содержимого  r2..r5 с числом по адресу
                +1  4541     ;  r0- адрес младшего байта !!!
                +1  4542     ;результат- r2..r5
                +1  4543     ;***********************************************
                +1  4544     
1A4C C3         +1  4545     laddx:    clr       c
1A4D E2         +1  4546                                             movx            a,@r0
1A4E 2D         +1  4547                                             add                     a,r5
1A4F FD         +1  4548               mov     r5,a
1A50 18         +1  4549                             dec     r0
1A51 E2         +1  4550                             movx    a,@r0
1A52 3C         +1  4551                             addc    a,r4
1A53 FC         +1  4552                             mov     r4,a
1A54 18         +1  4553                             dec     r0
1A55 E2         +1  4554                             movx    a,@r0
1A56 3B         +1  4555                             addc    a,r3
1A57 FB         +1  4556                             mov     r3,a
1A58 18         +1  4557                             dec     r0
1A59 E2         +1  4558                             movx    a,@r0
1A5A 3A         +1  4559                             addc    a,r2
1A5B FA         +1  4560                             mov       r2,a
1A5C 22         +1  4561                             ret
                +1  4562     
                +1  4563     ;***********************************************
                +1  4564     ;                                                      ст мл
                +1  4565     ; cложение содержимого  r2..r5 с числом по адресу
                +1  4566     ;  dptr- адрес младшего байта !!!
                +1  4567     ;результат- r2..r5
                +1  4568     ;***********************************************
                +1  4569     
1A5D C3         +1  4570     addx:    clr       c
1A5E E0         +1  4571                                             movx            a,@dptr
1A5F 2D         +1  4572                                             add                     a,r5
1A60 FD         +1  4573               mov     r5,a
1A61 120000   F +1  4574                             call            dedptr;dec     dptr
1A64 E0         +1  4575                             movx    a,@dptr
1A65 3C         +1  4576                             addc    a,r4
1A66 FC         +1  4577                             mov     r4,a
1A67 120000   F +1  4578                             call            dedptr;dec     dptr
1A6A E0         +1  4579                             movx    a,@dptr
1A6B 3B         +1  4580                             addc    a,r3
1A6C FB         +1  4581                             mov     r3,a
1A6D 120000   F +1  4582                             call            dedptr;dec     dptr
1A70 E0         +1  4583                             movx    a,@dptr
1A71 3A         +1  4584                             addc    a,r2
1A72 FA         +1  4585                             mov       r2,a
1A73 22         +1  4586                             ret
                +1  4587     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    73

1A74 C0D0       +1  4588     dedptr:         push    psw
1A76 C3         +1  4589                                             clr             c
1A77 E582       +1  4590                                             mov             a,dpl
1A79 9401       +1  4591                                             subb    a,#1
1A7B F582       +1  4592                                             mov             dpl,a
1A7D E583       +1  4593                                             mov             a,dph
1A7F 9400       +1  4594                                             subb    a,#0
1A81 F583       +1  4595                                             mov             dph,a
1A83 D0D0       +1  4596                                             pop             psw
1A85 22         +1  4597                                             ret
                    4598     
                    4599     ;$include (d:\amp\floatm.asm)
                +1  4600     ;       Copyright (C) 1988 HI-TECH Software
                +1  4601     
                +1  4602     ;       Single Precision Floating point arithmetic routines for 8051
                +1  4603     
                +1  4604     ;       The format of floating point numbers is as follows:
                +1  4605     
                +1  4606     ;       -----------------
                +1  4607     ;       *     sign      *  1 bit
                +1  4608     ;       -----------------
                +1  4609     ;       *   exponent    *  8 bits
                +1  4610     ;       -----------------
                +1  4611     ;       *   mantissa    *  23 bits + 1 implied bit = 24 bits
                +1  4612     ;       -----------------
                +1  4613     
                +1  4614     
                +1  4615     ;       As usual for the 8051 the memory layout has the most significant
                +1  4616     ;       byte (i.e. that containing the sign) coming first, i.e. at the
                +1  4617     ;       lowest address.
                +1  4618     
                +1  4619     ;       Calling conventions:
                +1  4620     
                +1  4621     ;       Left operand in r2-r5, right operand in ltemp (r0'-r3')
                +1  4622     ;
                +1  4623     ;       Return value is in r2-r5
                +1  4624     
                +1  4625     ;       Naming conventions: A routine name is constructed by
                +1  4626     
                +1  4627     ;             ASOP
                +1  4628     
                +1  4629     ;       Where A is the arithmetic type (f for float), and op is the operation,
                +1  4630     ;       one of mul, div, mod, add, sub and cmp. S is the size, always l.
                +1  4631     ;       Conversion routines are named
                +1  4632     
                +1  4633     ;               AStof
                +1  4634     
                +1  4635     ;       where A is the arithmetic type (a for integer, l for unsigned)
                +1  4636     ;       S is the integer size, one of b (byte), w (word) or l (long).
                +1  4637     ;       Conversion from float to integer is ftol.
                +1  4638     
                +1  4639     ;               .ORG  5000h
                +1  4640     ;               .CODE
                +1  4641     ;       seg     c_text
                +1  4642     
                +1  4643     ;;      $MOD812
----            +1  4644             CSEG
                +1  4645             ;ORG 1000h
                +1  4646     
                +1  4647                     ;;;PUBLIC       flmul,fldiv,fladd,flsub,flcmp
                +1  4648             ;;;PUBLIC       ftol,altof,lltof,awtof,lwtof,abtof,lbtof
                +1  4649     
                +1  4650     ;       EXTERNAL DELAY,KKOFU0,AKNCH,XNULLU
                +1  4651     ;       macros
                +1  4652     
                +1  4653     saveregs        macro
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    74

                +1  4654             push    7
                +1  4655             push    6
                +1  4656             push    1
                +1  4657             push    0
                +1  4658             endm
                +1  4659     
                +1  4660     restregs        macro
                +1  4661             pop     0
                +1  4662             pop     1
                +1  4663             pop     6
                +1  4664             pop     7
                +1  4665             endm
                +1  4666     
                +1  4667     ;addr   
                +1  4668     dan     macro   pad
                +1  4669             mov     a,r5
                +1  4670             add     a,pad+3
                +1  4671             mov     pad+3,a
                +1  4672             mov     a,pad+2
                +1  4673             addc    a,r4
                +1  4674             mov     pad+2,a
                +1  4675             mov     a,pad+1
                +1  4676             addc    a,r3
                +1  4677             mov     pad+1,a
                +1  4678             mov     a,pad+0
                +1  4679             addc    a,r2
                +1  4680             mov     pad,a
                +1  4681             endm
                +1  4682     
                +1  4683     addl    macro  addr
                +1  4684             mov     a,r5
                +1  4685             add     a,addr+3
                +1  4686             mov     r5,a
                +1  4687             mov     a,addr+2
                +1  4688             addc    a,r4
                +1  4689             mov     r4,a
                +1  4690             mov     a,addr+1
                +1  4691             addc    a,r3
                +1  4692             mov     r3,a
                +1  4693             mov     a,addr+0
                +1  4694             addc    a,r2
                +1  4695             mov     r2,a
                +1  4696             endm
                +1  4697     
                +1  4698     
                +1  4699     add1    macro
                +1  4700             mov     a,r5
                +1  4701             add     a,#1
                +1  4702             mov     r5,a
                +1  4703             clr     a
                +1  4704             addc    a,r4
                +1  4705             mov     r4,a
                +1  4706             clr     a
                +1  4707             addc    a,r3
                +1  4708             mov     r3,a
                +1  4709             clr     a
                +1  4710             addc    a,r2
                +1  4711             mov     r2,a
                +1  4712             endm
                +1  4713     
                +1  4714     shfdn   macro  addr
                +1  4715             clr     c
                +1  4716             mov     a,addr
                +1  4717             rrc     a
                +1  4718             mov     addr,a
                +1  4719             mov     a,addr+1
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    75

                +1  4720             rrc     a
                +1  4721             mov     addr+1,a
                +1  4722             mov     a,addr+2
                +1  4723             rrc     a
                +1  4724             mov     addr+2,a
                +1  4725             mov     a,addr+3
                +1  4726             rrc     a
                +1  4727             mov     addr+3,a
                +1  4728             endm
                +1  4729     
                +1  4730     shfup   macro  addr
                +1  4731             clr     c
                +1  4732             mov     a,addr+3
                +1  4733             rlc     a
                +1  4734             mov     addr+3,a
                +1  4735             mov     a,addr+2
                +1  4736             rlc     a
                +1  4737             mov     addr+2,a
                +1  4738             mov     a,addr+1
                +1  4739             rlc     a
                +1  4740             mov     addr+1,a
                +1  4741             mov     a,addr
                +1  4742             rlc     a
                +1  4743             mov     addr,a
                +1  4744             endm
                +1  4745     
                +1  4746     rshift  macro
                +1  4747             clr     c
                +1  4748             mov     a,r2
                +1  4749             rrc     a
                +1  4750             mov     r2,a
                +1  4751             mov     a,r3
                +1  4752             rrc     a
                +1  4753             mov     r3,a
                +1  4754             mov     a,r4
                +1  4755             rrc     a
                +1  4756             mov     r4,a
                +1  4757             mov     a,r5
                +1  4758             rrc     a
                +1  4759             mov     r5,a
                +1  4760             endm
                +1  4761     rshift1 macro
                +1  4762             setb    c
                +1  4763             mov     a,r2
                +1  4764             rrc     a
                +1  4765             mov     r2,a
                +1  4766             mov     a,r3
                +1  4767             rrc     a
                +1  4768             mov     r3,a
                +1  4769             mov     a,r4
                +1  4770             rrc     a
                +1  4771             mov     r4,a
                +1  4772             mov     a,r5
                +1  4773             rrc     a
                +1  4774             mov     r5,a
                +1  4775             endm
                +1  4776     
                +1  4777     
                +1  4778     lshift  macro
                +1  4779             mov     a,r5
                +1  4780             rlc     a
                +1  4781             mov     r5,a
                +1  4782             mov     a,r4
                +1  4783             rlc     a
                +1  4784             mov     r4,a
                +1  4785             mov     a,r3
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    76

                +1  4786             rlc     a
                +1  4787             mov     r3,a
                +1  4788             mov     a,r2
                +1  4789             rlc     a
                +1  4790             mov     r2,a
                +1  4791             endm
                +1  4792     
                +1  4793     neg1    macro
                +1  4794             clr     c
                +1  4795             clr     a
                +1  4796             subb    a,r5
                +1  4797             mov     r5,a
                +1  4798             clr     a
                +1  4799             subb    a,r4
                +1  4800             mov     r4,a
                +1  4801             clr     a
                +1  4802             subb    a,r3
                +1  4803             mov     r3,a
                +1  4804             clr     a
                +1  4805             subb    a,r2
                +1  4806             mov     r2,a
                +1  4807             endm
                +1  4808     
                +1  4809     negm    macro  addr
                +1  4810             clr     c
                +1  4811             clr     a
                +1  4812             subb    a,addr+3
                +1  4813             mov     addr+3,a
                +1  4814             clr     a
                +1  4815             subb    a,addr+2
                +1  4816             mov     addr+2,a
                +1  4817             clr     a
                +1  4818             subb    a,addr+1
                +1  4819             mov     addr+1,a
                +1  4820             clr     a
                +1  4821             subb    a,addr
                +1  4822             mov     addr,a
                +1  4823             endm
                +1  4824     
                +1  4825     copytor macro  addr
                +1  4826             mov     r2,addr
                +1  4827             mov     r3,addr+1
                +1  4828             mov     r4,addr+2
                +1  4829             mov     r5,addr+3
                +1  4830             endm
                +1  4831     
                +1  4832     
                +1  4833     copyrto macro  addr
                +1  4834             mov     addr,r2
                +1  4835             mov     addr+1,r3
                +1  4836             mov     addr+2,r4
                +1  4837             mov     addr+3,r5
                +1  4838             endm
                +1  4839     
                +1  4840     
                +1  4841     ;       Internal representation: in this set of routines a floating number
                +1  4842     ;       is unpacked into seperate mantissa, exponent and sign parts.
                +1  4843     
                +1  4844     ;       Stack offset values
                +1  4845     ;ltemp   equ     28h
                +1  4846     
  0006          +1  4847     cntr    equ     6               ;r6 is the counter
  0007          +1  4848     sign    equ     7               ;signs in r7 - left sign in bit 7, right in 6
  0000          +1  4849     exp1    equ     0               ;exponent 1 in r0
  0002          +1  4850     mant1   equ     2               ;mantissa 1 in r2-5
  0001          +1  4851     exp2    equ     1               ;exponent 1 in r1
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    77

  0008          +1  4852     mant2   equ     ltemp           ;mantissa 2 in ltemp
  000C          +1  4853     prod    equ     ltemp+4         ;product/quotient in ltemp+4 (r4'-r7')
                +1  4854     
                +1  4855     
                +1  4856     
                +1  4857     
                +1  4858     
                +1  4859     ;DECSIZE EQU     10
                +1  4860     ;NUMSIZE EQU     4
                +1  4861     ;RR4     EQU     4
                +1  4862     ;RR5     EQU     5
                +1  4863     
                +1  4864     ;       unpack1 - unpacks the left operand
                +1  4865     
009E            +1  4866     unpack1:
009E EA         +1  4867             mov     a,r2            ;get sign
009F 5480       +1  4868             anl     a,#80h
00A1 530740     +1  4869             anl     sign,#40h       ;clear other bits
00A4 4207       +1  4870             orl     sign,a          ;store sign
00A6 EB         +1  4871             mov     a,r3            ;get lsb of exponent
00A7 33         +1  4872             rlc     a               ;rotate into carry
00A8 EA         +1  4873             mov     a,r2            ;get rest of exponent
00A9 33         +1  4874             rlc     a               ;and make it 8 bits
00AA F8         +1  4875             mov     r0,a            ;store it
00AB 6006       +1  4876             jz      zer1            ;if zero, the whole thing is zero
00AD 430380     +1  4877             orl     mant1+1,#80h    ;set hidden bit
00B0 7A00       +1  4878             mov     r2,#0           ;clear upper byte of mantissa
00B2 22         +1  4879             ret
00B3            +1  4880     zer1:
00B3 E4         +1  4881             clr     a
00B4 FA         +1  4882             mov     r2,a
00B5 FB         +1  4883             mov     r3,a
00B6 FC         +1  4884             mov     r4,a
00B7 FD         +1  4885             mov     r5,a            ;zero mantissa
00B8 F8         +1  4886             mov     r0,a            ;zero exponent
00B9 22         +1  4887             ret
                +1  4888     
                +1  4889     ;       unpack2 - unpacks right operand
                +1  4890     
00BA            +1  4891     unpack2:
00BA E508       +1  4892             mov     a,ltemp         ;get sign
00BC 13         +1  4893             rrc     a               ;shift down
00BD 5440       +1  4894             anl     a,#40h          ;mask out sign
00BF 530780     +1  4895             anl     sign,#80h       ;clear old bit
00C2 4207       +1  4896             orl     sign,a
00C4 E509       +1  4897             mov     a,ltemp+1       ;get lsb of exponent
00C6 33         +1  4898             rlc     a               ;rotate into carry
00C7 E508       +1  4899             mov     a,ltemp         ;get rest of exponent
00C9 33         +1  4900             rlc     a               ;and make it 8 bits
00CA F9         +1  4901             mov     r1,a            ;store it
00CB 6007       +1  4902             jz      zer2            ;if zero, the whole thing is zero
00CD 430980     +1  4903             orl     mant2+1,#80h    ;set hidden bit
00D0 750800     +1  4904             mov     mant2,#0        ;clear upper byte
00D3 22         +1  4905             ret
00D4            +1  4906     zer2:
00D4 E4         +1  4907             clr     a
00D5 F508       +1  4908             mov     ltemp,a
00D7 F509       +1  4909             mov     ltemp+1,a
00D9 F50A       +1  4910             mov     ltemp+2,a
00DB F50B       +1  4911             mov     ltemp+3,a               ;zero mantissa
00DD 22         +1  4912             ret
                +1  4913     
                +1  4914     ;       pack1 - put operand 1 back into float format
                +1  4915     
00DE            +1  4916     pack1:
00DE E8         +1  4917             mov     a,r0            ;get exponent
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    78

00DF C3         +1  4918             clr     c
00E0 13         +1  4919             rrc     a               ;shift down 1 bit
00E1 530780     +1  4920             anl     sign,#80h       ;mask sign bit
00E4 4F         +1  4921             orl     a,r7            ;or in sign bit
00E5 FA         +1  4922             mov     r2,a            ;store
00E6 E8         +1  4923             mov     a,r0            ;get other bit
00E7 03         +1  4924             rr      a               ;rotate into hi bit
00E8 5480       +1  4925             anl     a,#80h          ;mask
00EA 53037F     +1  4926             anl     mant1+1,#7Fh    ;clear hidden bit
00ED 4203       +1  4927             orl     mant1+1,a       ;put in
00EF 22         +1  4928             ret
                +1  4929     
                +1  4930     
                +1  4931     ;       norm1 - normalize the unpacked value in 1
                +1  4932     
00F0            +1  4933     norm1:
00F0 E8         +1  4934             mov     a,r0            ;get exponent
00F1 60C0       +1  4935             jz      zer1            ;zero the mantissa if so
00F3 EA         +1  4936             mov     a,r2            ;get hi byte
00F4 6023       +1  4937             jz      norup           ;zero, so shift up if anything
00F6            +1  4938     nordn:
00F6 EA         +1  4939             mov     a,r2            ;get hi byte
00F7 B4010D     +1  4940             cjne    a,#1,nordn1     ;if not about to do last shift, skip
                +1  4941+3           add1                    ;add in a rounding bit
00FA ED         +1  4942+1           mov     a,r5
00FB 2401       +1  4943+1           add     a,#1
00FD FD         +1  4944+1           mov     r5,a
00FE E4         +1  4945+1           clr     a
00FF 3C         +1  4946+1           addc    a,r4
0100 FC         +1  4947+1           mov     r4,a
0101 E4         +1  4948+1           clr     a
0102 3B         +1  4949+1           addc    a,r3
0103 FB         +1  4950+1           mov     r3,a
0104 E4         +1  4951+1           clr     a
0105 3A         +1  4952+1           addc    a,r2
0106 FA         +1  4953+1           mov     r2,a
0107            +1  4954     nordn1:
                +1  4955+3           rshift                  ;shift down 1 bit
0107 C3         +1  4956+1           clr     c
0108 EA         +1  4957+1           mov     a,r2
0109 13         +1  4958+1           rrc     a
010A FA         +1  4959+1           mov     r2,a
010B EB         +1  4960+1           mov     a,r3
010C 13         +1  4961+1           rrc     a
010D FB         +1  4962+1           mov     r3,a
010E EC         +1  4963+1           mov     a,r4
010F 13         +1  4964+1           rrc     a
0110 FC         +1  4965+1           mov     r4,a
0111 ED         +1  4966+1           mov     a,r5
0112 13         +1  4967+1           rrc     a
0113 FD         +1  4968+1           mov     r5,a
0114 08         +1  4969             inc     r0              ;adjust exponent
0115 EA         +1  4970             mov     a,r2            ;test high byte
0116 70DE       +1  4971             jnz     nordn           ;loop
0118 22         +1  4972             ret                     ;done
                +1  4973     
0119            +1  4974     norup:
0119 4B         +1  4975             orl     a,r3
011A 4C         +1  4976             orl     a,r4
011B 4D         +1  4977             orl     a,r5            ;test for zero mantissa
011C 6095       +1  4978             jz      zer1            ;it is - make it true zero
011E            +1  4979     norup1:
011E EB         +1  4980             mov     a,r3            ;get mantissa byte
011F 20E710     +1  4981             jb      acc.7,norup2    ;jump if set
0122 C3         +1  4982             clr     c
                +1  4983+3           lshift                  ;shift mantissa up
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    79

0123 ED         +1  4984+1           mov     a,r5
0124 33         +1  4985+1           rlc     a
0125 FD         +1  4986+1           mov     r5,a
0126 EC         +1  4987+1           mov     a,r4
0127 33         +1  4988+1           rlc     a
0128 FC         +1  4989+1           mov     r4,a
0129 EB         +1  4990+1           mov     a,r3
012A 33         +1  4991+1           rlc     a
012B FB         +1  4992+1           mov     r3,a
012C EA         +1  4993+1           mov     a,r2
012D 33         +1  4994+1           rlc     a
012E FA         +1  4995+1           mov     r2,a
012F 18         +1  4996             dec     r0              ;adjust exponent
0130 80EC       +1  4997             jmp     norup1
0132            +1  4998     norup2:
0132 22         +1  4999             ret                     ;finito
                +1  5000     
                +1  5001     
                +1  5002     ;       fpdenorm - denormalize one of the two operands so that their
                +1  5003     ;       exponents are equal. This requires the smaller number to have
                +1  5004     ;       its exponent incremented and its mantissa shifted right.
                +1  5005     
0133            +1  5006     denorm:
0133 E8         +1  5007             mov     a,r0
0134 C3         +1  5008             clr     c
0135 99         +1  5009             subb    a,r1            ;compare exponents
0136 5029       +1  5010             jnc     up2a            ;shift operand 2
0138            +1  5011     up1:
0138 08         +1  5012             inc     r0              ;increment exponent
                +1  5013+3           rshift                  ;shift mantissa down
0139 C3         +1  5014+1           clr     c
013A EA         +1  5015+1           mov     a,r2
013B 13         +1  5016+1           rrc     a
013C FA         +1  5017+1           mov     r2,a
013D EB         +1  5018+1           mov     a,r3
013E 13         +1  5019+1           rrc     a
013F FB         +1  5020+1           mov     r3,a
0140 EC         +1  5021+1           mov     a,r4
0141 13         +1  5022+1           rrc     a
0142 FC         +1  5023+1           mov     r4,a
0143 ED         +1  5024+1           mov     a,r5
0144 13         +1  5025+1           rrc     a
0145 FD         +1  5026+1           mov     r5,a
0146 E8         +1  5027             mov     a,r0
0147 B501EE     +1  5028             cjne    a,exp2,up1      ;loop if still not equal
014A 22         +1  5029             ret
                +1  5030     
014B            +1  5031     up2:
014B 09         +1  5032             inc     r1              ;increment exponent 2
                +1  5033+3           shfdn   mant2           ;shift mantissa down
014C C3         +1  5034+1           clr     c
014D E508       +1  5035+1           mov     a,mant2
014F 13         +1  5036+1           rrc     a
0150 F508       +1  5037+1           mov     mant2,a
0152 E509       +1  5038+1           mov     a,mant2+1
0154 13         +1  5039+1           rrc     a
0155 F509       +1  5040+1           mov     mant2+1,a
0157 E50A       +1  5041+1           mov     a,mant2+2
0159 13         +1  5042+1           rrc     a
015A F50A       +1  5043+1           mov     mant2+2,a
015C E50B       +1  5044+1           mov     a,mant2+3
015E 13         +1  5045+1           rrc     a
015F F50B       +1  5046+1           mov     mant2+3,a
0161            +1  5047     up2a:
0161 E8         +1  5048             mov     a,r0            ;compare exponents
0162 B501E6     +1  5049             cjne    a,exp2,up2
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    80

0165 22         +1  5050             ret                     ;all done
                +1  5051     ;------------------------------------------------------------------
                +1  5052     ;       Add the number in op1 to the number in op2 and return the result in r2-r5
                +1  5053     
0166            +1  5054     fladd:
                +1  5055+3           saveregs
0166 C007       +1  5056+1           push    7
0168 C006       +1  5057+1           push    6
016A C001       +1  5058+1           push    1
016C C000       +1  5059+1           push    0
016E 119E       +1  5060             call    unpack1
0170 11BA       +1  5061             call    unpack2
0172 3133       +1  5062             call    denorm
0174 E507       +1  5063             mov     a,sign
0176 30E70D     +1  5064             jnb     acc.7,ok1       ;test left sign
                +1  5065+3           neg1                    ;negate op1
0179 C3         +1  5066+1           clr     c
017A E4         +1  5067+1           clr     a
017B 9D         +1  5068+1           subb    a,r5
017C FD         +1  5069+1           mov     r5,a
017D E4         +1  5070+1           clr     a
017E 9C         +1  5071+1           subb    a,r4
017F FC         +1  5072+1           mov     r4,a
0180 E4         +1  5073+1           clr     a
0181 9B         +1  5074+1           subb    a,r3
0182 FB         +1  5075+1           mov     r3,a
0183 E4         +1  5076+1           clr     a
0184 9A         +1  5077+1           subb    a,r2
0185 FA         +1  5078+1           mov     r2,a
0186            +1  5079     ok1:
0186 E507       +1  5080             mov     a,sign
0188 30E615     +1  5081             jnb     acc.6,ok2       ;test right sign
                +1  5082+3           negm    mant2           ;negate op2
018B C3         +1  5083+1           clr     c
018C E4         +1  5084+1           clr     a
018D 950B       +1  5085+1           subb    a,mant2+3
018F F50B       +1  5086+1           mov     mant2+3,a
0191 E4         +1  5087+1           clr     a
0192 950A       +1  5088+1           subb    a,mant2+2
0194 F50A       +1  5089+1           mov     mant2+2,a
0196 E4         +1  5090+1           clr     a
0197 9509       +1  5091+1           subb    a,mant2+1
0199 F509       +1  5092+1           mov     mant2+1,a
019B E4         +1  5093+1           clr     a
019C 9508       +1  5094+1           subb    a,mant2
019E F508       +1  5095+1           mov     mant2,a
01A0            +1  5096     ok2:
                +1  5097+3           addl    mant2           ;add mantissas
01A0 ED         +1  5098+1           mov     a,r5
01A1 250B       +1  5099+1           add     a,mant2+3
01A3 FD         +1  5100+1           mov     r5,a
01A4 E50A       +1  5101+1           mov     a,mant2+2
01A6 3C         +1  5102+1           addc    a,r4
01A7 FC         +1  5103+1           mov     r4,a
01A8 E509       +1  5104+1           mov     a,mant2+1
01AA 3B         +1  5105+1           addc    a,r3
01AB FB         +1  5106+1           mov     r3,a
01AC E508       +1  5107+1           mov     a,mant2+0
01AE 3A         +1  5108+1           addc    a,r2
01AF FA         +1  5109+1           mov     r2,a
01B0 E4         +1  5110             clr     a
01B1 FF         +1  5111             mov     r7,a            ;clear sign
01B2 EA         +1  5112             mov     a,r2            ;get sign of result
01B3 30E70E     +1  5113             jnb     acc.7,ok3       ;all ok
01B6 FF         +1  5114             mov     r7,a            ;store sign
                +1  5115+3           neg1                    ;negate mantissa
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    81

01B7 C3         +1  5116+1           clr     c
01B8 E4         +1  5117+1           clr     a
01B9 9D         +1  5118+1           subb    a,r5
01BA FD         +1  5119+1           mov     r5,a
01BB E4         +1  5120+1           clr     a
01BC 9C         +1  5121+1           subb    a,r4
01BD FC         +1  5122+1           mov     r4,a
01BE E4         +1  5123+1           clr     a
01BF 9B         +1  5124+1           subb    a,r3
01C0 FB         +1  5125+1           mov     r3,a
01C1 E4         +1  5126+1           clr     a
01C2 9A         +1  5127+1           subb    a,r2
01C3 FA         +1  5128+1           mov     r2,a
01C4            +1  5129     ok3:
01C4 11F0       +1  5130             call    norm1
01C6 11DE       +1  5131             call    pack1           ;pack normalized result
                +1  5132+3           restregs                ;and return
01C8 D000       +1  5133+1           pop     0
01CA D001       +1  5134+1           pop     1
01CC D006       +1  5135+1           pop     6
01CE D007       +1  5136+1           pop     7
01D0 22         +1  5137             ret
                +1  5138     ;-------------------------------------------------------------
                +1  5139     ;       Subtract the number ltemp from the number in r2-r5
                +1  5140     
01D1            +1  5141     flsub:
01D1 630880     +1  5142             xrl     ltemp,#80h      ;toggle sign bit
01D4 8090       +1  5143             jmp     fladd           ;and add!
                +1  5144     
                +1  5145     ;================================================================
                +1  5146     ;       Compare r2-r5 with the right operand and set flags accordingly
                +1  5147     
01D6            +1  5148     flcmp:
01D6 EA         +1  5149            mov     a,r2            ;get sign of left
01D7 6508       +1  5150            xrl     a,ltemp         ;calculate new sign
01D9 30E706     +1  5151            jnb     acc.7,cexp      ;same, go check exponent
                +1  5152     ;ifdef SMALL_MODEL
01DC EA         +1  5153             mov     a,r2            ;get sign of left again
01DD 33         +1  5154             rlc     a
01DE 5001       +1  5155             jnc     flout
                +1  5156     ;endif
01E0 D3         +1  5157             setb    c
01E1 22         +1  5158     flout:          ret                    ;return with acc < 0
                +1  5159     
01E2            +1  5160     cexp:
01E2 C3         +1  5161            clr     c
01E3 EA         +1  5162            mov     a,r2            ;compare exponent and mantissa
01E4 9508       +1  5163            subb    a,ltemp
01E6 7010       +1  5164            jnz     fnd
01E8 EB         +1  5165            mov     a,r3
01E9 9509       +1  5166            subb    a,ltemp+1
01EB 700B       +1  5167            jnz     fnd
01ED EC         +1  5168            mov     a,r4
01EE 950A       +1  5169            subb    a,ltemp+2
01F0 7006       +1  5170            jnz     fnd
01F2 ED         +1  5171            mov     a,r5
01F3 950B       +1  5172            subb    a,ltemp+3
01F5 7001       +1  5173            jnz     fnd
01F7            +1  5174     cdone:
01F7 22         +1  5175            ret                     ;return with acc == 0
01F8            +1  5176     fnd:
01F8 8AF0       +1  5177           mov     b,r2             ;get sign of left value
01FA 30F7FA     +1  5178          jnb     b.7,cdone       ;if positive, finished
01FD B2E7       +1  5179            cpl   acc.7             ;toggle sign???????/
01FF 4401       +1  5180                         orl         a,#1                          ;make non-zero
0201 B3         +1  5181             cpl     c               ;c=0->1,c=1->0
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    82

0202 22         +1  5182             ret
                +1  5183     ;==============================================================
                +1  5184     
                +1  5185     ;       Multiply the float in r2-r5 by the float in ltemp and return
                +1  5186     ;       the result in r2-r5
                +1  5187     
0203            +1  5188     flmul:
                +1  5189+3           saveregs
0203 C007       +1  5190+1           push    7
0205 C006       +1  5191+1           push    6
0207 C001       +1  5192+1           push    1
0209 C000       +1  5193+1           push    0
020B 119E       +1  5194             call    unpack1
020D 11BA       +1  5195             call    unpack2
020F E4         +1  5196             clr     a
0210 F50C       +1  5197             mov     prod,a
0212 F50D       +1  5198             mov     prod+1,a        ;clear product
0214 F50E       +1  5199             mov     prod+2,a
0216 F50F       +1  5200             mov     prod+3,a
0218 7E07       +1  5201             mov     r6,#7           ;initialize counter
021A            +1  5202     mup1:
                +1  5203+3           shfdn   mant2           ;shift multiplier right
021A C3         +1  5204+1           clr     c
021B E508       +1  5205+1           mov     a,mant2
021D 13         +1  5206+1           rrc     a
021E F508       +1  5207+1           mov     mant2,a
0220 E509       +1  5208+1           mov     a,mant2+1
0222 13         +1  5209+1           rrc     a
0223 F509       +1  5210+1           mov     mant2+1,a
0225 E50A       +1  5211+1           mov     a,mant2+2
0227 13         +1  5212+1           rrc     a
0228 F50A       +1  5213+1           mov     mant2+2,a
022A E50B       +1  5214+1           mov     a,mant2+3
022C 13         +1  5215+1           rrc     a
022D F50B       +1  5216+1           mov     mant2+3,a
022F 5014       +1  5217             jnc     nobit           ;skip if lsb was zero
                +1  5218+3           dan     prod            ;add multiplicand to product
0231 ED         +1  5219+1           mov     a,r5
0232 250F       +1  5220+1           add     a,prod+3
0234 F50F       +1  5221+1           mov     prod+3,a
0236 E50E       +1  5222+1           mov     a,prod+2
0238 3C         +1  5223+1           addc    a,r4
0239 F50E       +1  5224+1           mov     prod+2,a
023B E50D       +1  5225+1           mov     a,prod+1
023D 3B         +1  5226+1           addc    a,r3
023E F50D       +1  5227+1           mov     prod+1,a
0240 E50C       +1  5228+1           mov     a,prod+0
0242 3A         +1  5229+1           addc    a,r2
0243 F50C       +1  5230+1           mov     prod,a
0245            +1  5231     nobit:
                +1  5232+3           lshift                  ;shift multiplicand up
0245 ED         +1  5233+1           mov     a,r5
0246 33         +1  5234+1           rlc     a
0247 FD         +1  5235+1           mov     r5,a
0248 EC         +1  5236+1           mov     a,r4
0249 33         +1  5237+1           rlc     a
024A FC         +1  5238+1           mov     r4,a
024B EB         +1  5239+1           mov     a,r3
024C 33         +1  5240+1           rlc     a
024D FB         +1  5241+1           mov     r3,a
024E EA         +1  5242+1           mov     a,r2
024F 33         +1  5243+1           rlc     a
0250 FA         +1  5244+1           mov     r2,a
0251 DEC7       +1  5245             djnz    r6,mup1         ;loop if more
                +1  5246     
0253 7E11       +1  5247             mov     r6,#17          ;re-initalize counter
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    83

0255 8015       +1  5248             sjmp    mup3
0257            +1  5249     mup11:
                +1  5250+3           shfdn   prod            ;shift product right
0257 C3         +1  5251+1           clr     c
0258 E50C       +1  5252+1           mov     a,prod
025A 13         +1  5253+1           rrc     a
025B F50C       +1  5254+1           mov     prod,a
025D E50D       +1  5255+1           mov     a,prod+1
025F 13         +1  5256+1           rrc     a
0260 F50D       +1  5257+1           mov     prod+1,a
0262 E50E       +1  5258+1           mov     a,prod+2
0264 13         +1  5259+1           rrc     a
0265 F50E       +1  5260+1           mov     prod+2,a
0267 E50F       +1  5261+1           mov     a,prod+3
0269 13         +1  5262+1           rrc     a
026A F50F       +1  5263+1           mov     prod+3,a
026C            +1  5264     mup3:
                +1  5265+3           shfdn   mant2           ;shift multiplier down
026C C3         +1  5266+1           clr     c
026D E508       +1  5267+1           mov     a,mant2
026F 13         +1  5268+1           rrc     a
0270 F508       +1  5269+1           mov     mant2,a
0272 E509       +1  5270+1           mov     a,mant2+1
0274 13         +1  5271+1           rrc     a
0275 F509       +1  5272+1           mov     mant2+1,a
0277 E50A       +1  5273+1           mov     a,mant2+2
0279 13         +1  5274+1           rrc     a
027A F50A       +1  5275+1           mov     mant2+2,a
027C E50B       +1  5276+1           mov     a,mant2+3
027E 13         +1  5277+1           rrc     a
027F F50B       +1  5278+1           mov     mant2+3,a
0281 5014       +1  5279             jnc     mup2            ;skip if bit not set
                +1  5280+3           dan     prod            ;add to prod
0283 ED         +1  5281+1           mov     a,r5
0284 250F       +1  5282+1           add     a,prod+3
0286 F50F       +1  5283+1           mov     prod+3,a
0288 E50E       +1  5284+1           mov     a,prod+2
028A 3C         +1  5285+1           addc    a,r4
028B F50E       +1  5286+1           mov     prod+2,a
028D E50D       +1  5287+1           mov     a,prod+1
028F 3B         +1  5288+1           addc    a,r3
0290 F50D       +1  5289+1           mov     prod+1,a
0292 E50C       +1  5290+1           mov     a,prod+0
0294 3A         +1  5291+1           addc    a,r2
0295 F50C       +1  5292+1           mov     prod,a
0297            +1  5293     mup2:
0297 DEBE       +1  5294             djnz    r6,mup11        ;loop if more
0299 E8         +1  5295             mov     a,r0            ;get exp1
029A 29         +1  5296             add     a,r1            ;add exp2
029B 247A       +1  5297             add     a,#7ah;;;;;;;;;;;;;;;;;;;(-127-7) & 0FFh    ;adjust
029D F8         +1  5298             mov     r0,a            ;store
029E EF         +1  5299             mov     a,r7            ;get sign
029F 23         +1  5300             rl      a               ;rotate bit into msb
02A0 6207       +1  5301             xrl     sign,a          ;xor with other bit
                +1  5302+3           copytor prod            ;copy prod to mant1
02A2 AA0C       +1  5303+1           mov     r2,prod
02A4 AB0D       +1  5304+1           mov     r3,prod+1
02A6 AC0E       +1  5305+1           mov     r4,prod+2
02A8 AD0F       +1  5306+1           mov     r5,prod+3
02AA 11F0       +1  5307             call    norm1           ;normalize
02AC 11DE       +1  5308             call    pack1
                +1  5309+3           restregs
02AE D000       +1  5310+1           pop     0
02B0 D001       +1  5311+1           pop     1
02B2 D006       +1  5312+1           pop     6
02B4 D007       +1  5313+1           pop     7
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    84

02B6 22         +1  5314             ret
                +1  5315     ;-----------------------------------------------------------
                +1  5316     ;       Floating divide: divide the number in r2-r5 by ltemp
                +1  5317     
02B7            +1  5318     fldiv:
                +1  5319+3           saveregs
02B7 C007       +1  5320+1           push    7
02B9 C006       +1  5321+1           push    6
02BB C001       +1  5322+1           push    1
02BD C000       +1  5323+1           push    0
02BF 119E       +1  5324             call    unpack1
02C1 11BA       +1  5325             call    unpack2
02C3 E4         +1  5326             clr     a
02C4 F50C       +1  5327             mov     prod,a
02C6 F50D       +1  5328             mov     prod+1,a
02C8 F50E       +1  5329             mov     prod+2,a
02CA F50F       +1  5330             mov     prod+3,a
02CC E9         +1  5331             mov     a,r1            ;check for zero divisor
02CD 6067       +1  5332             jz      div9
02CF E8         +1  5333             mov     a,r0            ;check for zero dividend
02D0 6064       +1  5334             jz      div9
02D2 C3         +1  5335             clr     c
02D3 99         +1  5336             subb    a,r1            ;compute new exponent
02D4 2478       +1  5337             add     a,#127-7        ;unbias
02D6 F8         +1  5338             mov     r0,a            ;store back
02D7 EF         +1  5339             mov     a,r7            ;get sign
02D8 23         +1  5340             rl      a
02D9 6207       +1  5341             xrl     sign,a          ;compute new sign
02DB 7E1F       +1  5342             mov     r6,#24+7        ;initialize counter
02DD            +1  5343     div1:
                +1  5344+3           shfup   prod            ;shift quotient up
02DD C3         +1  5345+1           clr     c
02DE E50F       +1  5346+1           mov     a,prod+3
02E0 33         +1  5347+1           rlc     a
02E1 F50F       +1  5348+1           mov     prod+3,a
02E3 E50E       +1  5349+1           mov     a,prod+2
02E5 33         +1  5350+1           rlc     a
02E6 F50E       +1  5351+1           mov     prod+2,a
02E8 E50D       +1  5352+1           mov     a,prod+1
02EA 33         +1  5353+1           rlc     a
02EB F50D       +1  5354+1           mov     prod+1,a
02ED E50C       +1  5355+1           mov     a,prod
02EF 33         +1  5356+1           rlc     a
02F0 F50C       +1  5357+1           mov     prod,a
02F2 C3         +1  5358             clr     c
02F3 EA         +1  5359             mov     a,r2            ;compare values
02F4 9508       +1  5360             subb    a,mant2
02F6 4028       +1  5361             jc      div2            ;skip if bigger
02F8 7013       +1  5362             jnz     div3
02FA EB         +1  5363             mov     a,r3            ;compare values
02FB 9509       +1  5364             subb    a,mant2+1
02FD 4021       +1  5365             jc      div2            ;skip if bigger
02FF 700C       +1  5366             jnz     div3
0301 EC         +1  5367             mov     a,r4            ;compare values
0302 950A       +1  5368             subb    a,mant2+2
0304 401A       +1  5369             jc      div2            ;skip if bigger
0306 7005       +1  5370             jnz     div3
0308 ED         +1  5371             mov     a,r5            ;compare values
0309 950B       +1  5372             subb    a,mant2+3
030B 4013       +1  5373             jc      div2            ;skip if bigger
030D            +1  5374     div3:
030D ED         +1  5375             mov     a,r5
030E 950B       +1  5376             subb    a,mant2+3
0310 FD         +1  5377             mov     r5,a
0311 EC         +1  5378             mov     a,r4
0312 950A       +1  5379             subb    a,mant2+2               ;do subtraction
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    85

0314 FC         +1  5380             mov     r4,a
0315 EB         +1  5381             mov     a,r3
0316 9509       +1  5382             subb    a,mant2+1               ;do subtraction
0318 FB         +1  5383             mov     r3,a
0319 EA         +1  5384             mov     a,r2
031A 9508       +1  5385             subb    a,mant2         ;do subtraction
031C FA         +1  5386             mov     r2,a
031D 430F01     +1  5387             orl     prod+3,#1       ;set lsb in quotient
0320            +1  5388     div2:
                +1  5389+3           lshift                  ;shift dividend up
0320 ED         +1  5390+1           mov     a,r5
0321 33         +1  5391+1           rlc     a
0322 FD         +1  5392+1           mov     r5,a
0323 EC         +1  5393+1           mov     a,r4
0324 33         +1  5394+1           rlc     a
0325 FC         +1  5395+1           mov     r4,a
0326 EB         +1  5396+1           mov     a,r3
0327 33         +1  5397+1           rlc     a
0328 FB         +1  5398+1           mov     r3,a
0329 EA         +1  5399+1           mov     a,r2
032A 33         +1  5400+1           rlc     a
032B FA         +1  5401+1           mov     r2,a
032C DEAF       +1  5402             djnz    r6,div1         ;loop if more
                +1  5403+3           copytor prod            ;copy quotient
032E AA0C       +1  5404+1           mov     r2,prod
0330 AB0D       +1  5405+1           mov     r3,prod+1
0332 AC0E       +1  5406+1           mov     r4,prod+2
0334 AD0F       +1  5407+1           mov     r5,prod+3
0336            +1  5408     div9:
0336 11F0       +1  5409             call    norm1           ;now normalize result
0338 11DE       +1  5410             call    pack1           ;pack it up
                +1  5411+3           restregs                ;restore registers
033A D000       +1  5412+1           pop     0
033C D001       +1  5413+1           pop     1
033E D006       +1  5414+1           pop     6
0340 D007       +1  5415+1           pop     7
0342 22         +1  5416             ret
                +1  5417     ;------------------------------------------------------------------
                +1  5418     
                +1  5419     ;       Float to long conversion: if the exponent is less than the
                +1  5420     ;       excess value, the result is zero. If the exponent is so large
                +1  5421     ;       that the value would be shifted out, the result is overflow.
                +1  5422     ;       Otherwise shift the mantissa up or down as required.
                +1  5423     
0343            +1  5424     ftol:
                +1  5425+3           saveregs
0343 C007       +1  5426+1           push    7
0345 C006       +1  5427+1           push    6
0347 C001       +1  5428+1           push    1
0349 C000       +1  5429+1           push    0
034B EA         +1  5430             mov     a,r2
034C B4BF09     +1  5431             cjne    a,#0bfh,ne05
034F EB         +1  5432             mov     a,r3
0350 7006       +1  5433             jnz     ne05
0352 EC         +1  5434             mov     a,r4
0353 7003       +1  5435             jnz     ne05
0355 ED         +1  5436             mov     a,r5
0356 6024       +1  5437             jz      ftol1
0358 119E       +1  5438     ne05:   call    unpack1
035A E8         +1  5439             mov     a,r0            ;get exponent
035B 2482       +1  5440             add     a,#-(127-1)     ;unbias
035D 20E71C     +1  5441             jb      acc.7,ftol1     ;jump if < 0
0360 EF         +1  5442             mov     a,r7            ;get sign
0361 30E70D     +1  5443             jnb     acc.7,ftol4     ;skip if +ve
                +1  5444+3           neg1                    ;negate it
0364 C3         +1  5445+1           clr     c
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    86

0365 E4         +1  5446+1           clr     a
0366 9D         +1  5447+1           subb    a,r5
0367 FD         +1  5448+1           mov     r5,a
0368 E4         +1  5449+1           clr     a
0369 9C         +1  5450+1           subb    a,r4
036A FC         +1  5451+1           mov     r4,a
036B E4         +1  5452+1           clr     a
036C 9B         +1  5453+1           subb    a,r3
036D FB         +1  5454+1           mov     r3,a
036E E4         +1  5455+1           clr     a
036F 9A         +1  5456+1           subb    a,r2
0370 FA         +1  5457+1           mov     r2,a
0371            +1  5458     ftol4:
0371 E8         +1  5459             mov     a,r0            ;get exponent
0372 246A       +1  5460             add     a,#6ah;;;;;;;;(-(127-1+23+1)) & 0FFh
0374 20E727     +1  5461             jb      acc.7,ftol2     ;shift has to be right
0377 F8         +1  5462             mov     r0,a            ;save it
0378 24F8       +1  5463             add     a,#-8           ;if > 8, too big
037A 500E       +1  5464             jnc     ftol3
037C            +1  5465     ftol1:
037C E4         +1  5466             clr     a
037D FA         +1  5467             mov     r2,a
037E FB         +1  5468             mov     r3,a
037F FC         +1  5469             mov     r4,a
0380 FD         +1  5470             mov     r5,a
0381            +1  5471     ftol9:
                +1  5472+3           restregs
0381 D000       +1  5473+1           pop     0
0383 D001       +1  5474+1           pop     1
0385 D006       +1  5475+1           pop     6
0387 D007       +1  5476+1           pop     7
0389 22         +1  5477             ret
038A            +1  5478     ftol3:
038A E8         +1  5479             mov     a,r0
038B FE         +1  5480             mov     r6,a            ;store in counter
038C 60F3       +1  5481             jz      ftol9           ;if zero, do nothing
038E            +1  5482     ftol33:
                +1  5483+3           lshift                  ;shift up
038E ED         +1  5484+1           mov     a,r5
038F 33         +1  5485+1           rlc     a
0390 FD         +1  5486+1           mov     r5,a
0391 EC         +1  5487+1           mov     a,r4
0392 33         +1  5488+1           rlc     a
0393 FC         +1  5489+1           mov     r4,a
0394 EB         +1  5490+1           mov     a,r3
0395 33         +1  5491+1           rlc     a
0396 FB         +1  5492+1           mov     r3,a
0397 EA         +1  5493+1           mov     a,r2
0398 33         +1  5494+1           rlc     a
0399 FA         +1  5495+1           mov     r2,a
039A DEF2       +1  5496             djnz    r6,ftol33       ;and loop
039C 80E3       +1  5497             sjmp    ftol9
039E            +1  5498     ftol2:
039E F4         +1  5499             cpl     a               ;complement
039F FE         +1  5500             mov     r6,a
03A0 6022       +1  5501             jz      ftol22
03A2            +1  5502     ftol23:
03A2 EF         +1  5503             mov     a,r7
03A3 30E70F     +1  5504             jnb     acc.7,ftol24
                +1  5505+3           rshift1
03A6 D3         +1  5506+1           setb    c
03A7 EA         +1  5507+1           mov     a,r2
03A8 13         +1  5508+1           rrc     a
03A9 FA         +1  5509+1           mov     r2,a
03AA EB         +1  5510+1           mov     a,r3
03AB 13         +1  5511+1           rrc     a
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    87

03AC FB         +1  5512+1           mov     r3,a
03AD EC         +1  5513+1           mov     a,r4
03AE 13         +1  5514+1           rrc     a
03AF FC         +1  5515+1           mov     r4,a
03B0 ED         +1  5516+1           mov     a,r5
03B1 13         +1  5517+1           rrc     a
03B2 FD         +1  5518+1           mov     r5,a
03B3 800D       +1  5519             jmp     ftol25
03B5            +1  5520+3   ftol24: rshift                  ;shift down
03B5 C3         +1  5521+1           clr     c
03B6 EA         +1  5522+1           mov     a,r2
03B7 13         +1  5523+1           rrc     a
03B8 FA         +1  5524+1           mov     r2,a
03B9 EB         +1  5525+1           mov     a,r3
03BA 13         +1  5526+1           rrc     a
03BB FB         +1  5527+1           mov     r3,a
03BC EC         +1  5528+1           mov     a,r4
03BD 13         +1  5529+1           rrc     a
03BE FC         +1  5530+1           mov     r4,a
03BF ED         +1  5531+1           mov     a,r5
03C0 13         +1  5532+1           rrc     a
03C1 FD         +1  5533+1           mov     r5,a
03C2 DEDE       +1  5534     ftol25: djnz    r6,ftol23
03C4            +1  5535     ftol22:
                +1  5536+3           add1                    ;round
03C4 ED         +1  5537+1           mov     a,r5
03C5 2401       +1  5538+1           add     a,#1
03C7 FD         +1  5539+1           mov     r5,a
03C8 E4         +1  5540+1           clr     a
03C9 3C         +1  5541+1           addc    a,r4
03CA FC         +1  5542+1           mov     r4,a
03CB E4         +1  5543+1           clr     a
03CC 3B         +1  5544+1           addc    a,r3
03CD FB         +1  5545+1           mov     r3,a
03CE E4         +1  5546+1           clr     a
03CF 3A         +1  5547+1           addc    a,r2
03D0 FA         +1  5548+1           mov     r2,a
03D1 EF         +1  5549             mov     a,r7
03D2 30E70F     +1  5550             jnb     acc.7,ftol26
                +1  5551+3           rshift1
03D5 D3         +1  5552+1           setb    c
03D6 EA         +1  5553+1           mov     a,r2
03D7 13         +1  5554+1           rrc     a
03D8 FA         +1  5555+1           mov     r2,a
03D9 EB         +1  5556+1           mov     a,r3
03DA 13         +1  5557+1           rrc     a
03DB FB         +1  5558+1           mov     r3,a
03DC EC         +1  5559+1           mov     a,r4
03DD 13         +1  5560+1           rrc     a
03DE FC         +1  5561+1           mov     r4,a
03DF ED         +1  5562+1           mov     a,r5
03E0 13         +1  5563+1           rrc     a
03E1 FD         +1  5564+1           mov     r5,a
03E2 809D       +1  5565             jmp     ftol9
03E4            +1  5566+3   ftol26: rshift
03E4 C3         +1  5567+1           clr     c
03E5 EA         +1  5568+1           mov     a,r2
03E6 13         +1  5569+1           rrc     a
03E7 FA         +1  5570+1           mov     r2,a
03E8 EB         +1  5571+1           mov     a,r3
03E9 13         +1  5572+1           rrc     a
03EA FB         +1  5573+1           mov     r3,a
03EB EC         +1  5574+1           mov     a,r4
03EC 13         +1  5575+1           rrc     a
03ED FC         +1  5576+1           mov     r4,a
03EE ED         +1  5577+1           mov     a,r5
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    88

03EF 13         +1  5578+1           rrc     a
03F0 FD         +1  5579+1           mov     r5,a
03F1 808E       +1  5580             jmp     ftol9
                +1  5581     
                +1  5582     ;       arithmetic integer to floating conversions
                +1  5583     
03F3            +1  5584     abtof:
03F3 ED         +1  5585             mov     a,r5
03F4 23         +1  5586             rl      a
03F5 FC         +1  5587             mov     r4,a
03F6 9C         +1  5588             subb    a,r4
03F7 FC         +1  5589             mov     r4,a
03F8 FB         +1  5590             mov     r3,a
03F9 FA         +1  5591             mov     r2,a
03FA 8006       +1  5592             jmp     altof
03FC            +1  5593     awtof:
03FC EC         +1  5594             mov     a,r4
03FD 23         +1  5595             rl      a
03FE FB         +1  5596             mov     r3,a
03FF 9B         +1  5597             subb    a,r3
0400 FB         +1  5598             mov     r3,a
0401 FA         +1  5599             mov     r2,a
0402            +1  5600     altof:
                +1  5601+3           saveregs
0402 C007       +1  5602+1           push    7
0404 C006       +1  5603+1           push    6
0406 C001       +1  5604+1           push    1
0408 C000       +1  5605+1           push    0
040A EA         +1  5606             mov     a,r2            ;get sign
040B 5480       +1  5607             anl     a,#80h
040D FF         +1  5608             mov     r7,a            ;store it
040E 30E70D     +1  5609             jnb     acc.7,altof1    ;skip if +ve
                +1  5610+3           neg1
0411 C3         +1  5611+1           clr     c
0412 E4         +1  5612+1           clr     a
0413 9D         +1  5613+1           subb    a,r5
0414 FD         +1  5614+1           mov     r5,a
0415 E4         +1  5615+1           clr     a
0416 9C         +1  5616+1           subb    a,r4
0417 FC         +1  5617+1           mov     r4,a
0418 E4         +1  5618+1           clr     a
0419 9B         +1  5619+1           subb    a,r3
041A FB         +1  5620+1           mov     r3,a
041B E4         +1  5621+1           clr     a
041C 9A         +1  5622+1           subb    a,r2
041D FA         +1  5623+1           mov     r2,a
041E            +1  5624     altof1:
041E 7896       +1  5625             mov     r0,#127+23      ;initialize exponent
0420 11F0       +1  5626             call    norm1           ;normalize it
0422 11DE       +1  5627             call    pack1           ;and pack up
                +1  5628+3           restregs
0424 D000       +1  5629+1           pop     0
0426 D001       +1  5630+1           pop     1
0428 D006       +1  5631+1           pop     6
042A D007       +1  5632+1           pop     7
042C 22         +1  5633             ret
                +1  5634     
042D            +1  5635     lbtof:
042D 7C00       +1  5636             mov     r4,#0
042F            +1  5637     lwtof:
042F E4         +1  5638             clr     a
0430 FB         +1  5639             mov     r3,a
0431 FA         +1  5640             mov     r2,a
0432            +1  5641     lltof:
                +1  5642+3           saveregs
0432 C007       +1  5643+1           push    7
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    89

0434 C006       +1  5644+1           push    6
0436 C001       +1  5645+1           push    1
0438 C000       +1  5646+1           push    0
043A 7F00       +1  5647             mov     r7,#0           ;zero sign
043C 80E0       +1  5648             sjmp    altof1
                +1  5649     
                +1  5650     ;-------------------------------------------------------
                +1  5651     
                +1  5652     
                    5653     
                    5654     ;$include (d:\amp\wriread.asm)
                +1  5655     ;dptr-адрес ячейки страницы памяти
043E 75A800     +1  5656     cle256:          mov            IE,#00H
0441 75B601     +1  5657                              mov            FLSCL,#01                       ;стирание страницы 
                             байт(запись в ячейки ff)
0444 758F03     +1  5658                              MOV            PSCTL,#03
                +1  5659                                             
0447 7400       +1  5660                                     mov             a,#00h  ;запись любого значения стирает стр
                             аницу
0449 F0         +1  5661                                     movx    @dptr,a                         ;wr
044A 758F00     +1  5662                                     mov             PSCTL,#00
044D 75B600     +1  5663                                 mov         FLSCL,#00
0450 75A880     +1  5664                               mov           IE,#80H
0453 22         +1  5665                                     ret
                +1  5666     
                +1  5667     ;чтение памяти программ в r8..r11
                +1  5668     ;вх-r2,r3-адр яч памяти прогр
0454 8A83       +1  5669     re4byte:        mov                     dph,r2
0456 8B82       +1  5670                                             mov                     dpl,r3
0458 E4         +1  5671                                             clr                     a
0459 93         +1  5672                                             movc            a,@a+dptr
045A F508       +1  5673                                             mov                     r8,a
045C A3         +1  5674                                             inc                     dptr
045D E4         +1  5675                                             clr                     a
045E 93         +1  5676                                             movc            a,@a+dptr
045F F509       +1  5677                                             mov                     r9,a
0461 A3         +1  5678                                             inc                     dptr
0462 E4         +1  5679                                             clr                     a
0463 93         +1  5680                                             movc            a,@a+dptr
0464 F50A       +1  5681                                             mov                     r10,a
0466 A3         +1  5682                                             inc                     dptr
0467 E4         +1  5683                                             clr                     a
0468 93         +1  5684                                             movc            a,@a+dptr
0469 F50B       +1  5685                                             mov                     r11,a                      
                                                  ;r8..r11
046B 22         +1  5686                                             ret
                +1  5687      ;чтение памяти программ в r2..r5
                +1  5688     ;вх-r2,r3-адр яч памяти прогр
046C 8A83       +1  5689     rebyte2:        mov                     dph,r2
046E 8B82       +1  5690                                             mov                     dpl,r3
0470 E4         +1  5691                                             clr                     a
0471 93         +1  5692                                             movc            a,@a+dptr
0472 FA         +1  5693                                             mov                     r2,a
0473 A3         +1  5694                                             inc                     dptr
0474 E4         +1  5695                                             clr                     a
0475 93         +1  5696                                             movc            a,@a+dptr
0476 FB         +1  5697                                             mov                     r3,a
0477 A3         +1  5698                                             inc                     dptr
0478 E4         +1  5699                                             clr                     a
0479 93         +1  5700                                             movc            a,@a+dptr
047A FC         +1  5701                                             mov                     r4,a
047B A3         +1  5702                                             inc                     dptr
047C E4         +1  5703                                             clr                     a
047D 93         +1  5704                                             movc            a,@a+dptr
047E FD         +1  5705                                             mov                     r5,a                       
                                                  ;r8..r11
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    90

047F 22         +1  5706                                             ret
                +1  5707      
                +1  5708     
                +1  5709      ;r7-количество байт
                +1  5710     ;dptr-адр ячейки для записи
                +1  5711     ;r1-адр ячейки  внешнего озу
                +1  5712     
0480 75A800     +1  5713     wrpage:  mov            IE,#00H
0483 75B601     +1  5714     WW5:     mov            FLSCL,#01               ;обязательно для каждого записи байта
0486 758F01     +1  5715                      mov            PSCTL,#01               ;обязательно для каждого записи бай
                             та
0489 E3         +1  5716                      movx           a,@r1
048A F0         +1  5717                      movx           @dptr,a                         ;wr
048B 758F00     +1  5718                      mov            PSCTL,#0
048E 75B600     +1  5719                      mov            FLSCL,#00
0491 A3         +1  5720                     inc                     dptr
0492 09         +1  5721                     inc                     r1
0493 DFEE       +1  5722                     djnz            r7,WW5
0495 75A880     +1  5723                     mov             IE,#80H
0498 22         +1  5724                     ret
                +1  5725                             
                +1  5726     
                +1  5727     
                +1  5728                                                             
                +1  5729     
                +1  5730     
                +1  5731     ;;;;;;;;;;;;;;;;;;;;;;;;;
                +1  5732     ;чтение памяти программ во внешнее озу
                +1  5733     ;вх-r2,r3-адр яч памяти прогр
                +1  5734     ;r1- яч внешнее озу
0499 8A83       +1  5735     copyPP:         mov                     dph,r2
049B 8B82       +1  5736                                             mov                     dpl,r3
049D 7FFF       +1  5737                                             mov                     r7,#0ffh
049F E4         +1  5738     copy1:          clr                     a
04A0 93         +1  5739                                             movc            a,@a+dptr
04A1 F3         +1  5740                                             movx                    @r1,a
04A2 A3         +1  5741                                             inc                     dptr
04A3 09         +1  5742                                             inc                     r1
04A4 DFF9       +1  5743                                             djnz            r7,copy1
04A6 22         +1  5744                                             ret
                +1  5745     ;;;;;;;;;;;;;;;;;;;;;;;;;
                +1  5746     
                +1  5747                                     
                +1  5748     
                +1  5749     ;r8..r11->@r0..@r0+3
                +1  5750     ;r0-адр ячейки
                +1  5751     ;сохранить в ячейке озу
04A7 E508       +1  5752     savelte:        mov     a,ltemp
04A9 F6         +1  5753                                             mov     @r0,a
04AA 08         +1  5754                                             inc     r0
04AB E509       +1  5755                                             mov     a,ltemp+1
04AD F6         +1  5756                                             mov     @r0,a
04AE 08         +1  5757                                             inc     r0
04AF E50A       +1  5758                                             mov     a,ltemp+2
04B1 F6         +1  5759                                             mov     @r0,a
04B2 08         +1  5760                                             inc     r0
04B3 E50B       +1  5761                                             mov     a,ltemp+3
04B5 F6         +1  5762                                             mov     @r0,a
04B6 22         +1  5763                                             ret
                +1  5764     
                +1  5765     ;
                +1  5766     
                +1  5767     
                +1  5768     
                +1  5769     
                +1  5770     
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    91

                +1  5771                     
                +1  5772     
                +1  5773     
                +1  5774     
                +1  5775     
                +1  5776      
                    5777     
                    5778                                                   
                    5779     END
                                                                             
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    92

XREF SYMBOL TABLE LISTING
---- ------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES / REFERENCES

AA . . . . . . . .  B ADDR   00C0H.2 A      182#
AAPAR. . . . . . .  C ADDR   0328H   R   SEG=MAIN   771 774#
ABIN . . . . . . .  D ADDR   004FH   A      300# 1309 1314 2950 2956 2989 3015 3064 3082 3369 3824
ABRET. . . . . . .  C ADDR   16ACH   R   SEG=MAIN   3753 3755#
ABTOF. . . . . . .  C ADDR   03F3H   A      5584#
AC . . . . . . . .  B ADDR   00D0H.6 A      205#
ACC. . . . . . . .  D ADDR   00E0H   A      106# 617 664 672 680 688 690 710 1017 1025 1101 1260 1418 1427 1436 1445
                                           1466 1797 2060 2082 2087 2091 2094 2097 2100 2103 2106 2274 2323 2338 2349
                                           2391 2400 2408 2418 2432 2501 2517 2539 2544 2548 2551 2554 2557 2560 2563
                                           2837 2904 3038 3043 3056 3107 3991 4069 4072 4329 4981 5064 5081 5113 5151
                                           5179 5441 5443 5461 5504 5550 5609
AD0BUSY. . . . . .  B ADDR   00E8H.4 A      222#
AD0EN. . . . . . .  B ADDR   00E8H.7 A      225#
AD0INT . . . . . .  B ADDR   00E8H.5 A      223#
AD0LJST. . . . . .  B ADDR   00E8H.0 A      218#
AD0STM0. . . . . .  B ADDR   00E8H.2 A      220#
AD0STM1. . . . . .  B ADDR   00E8H.3 A      221#
AD0TM. . . . . . .  B ADDR   00E8H.6 A      224#
AD0WINT. . . . . .  B ADDR   00E8H.1 A      219#
ADC0CF . . . . . .  D ADDR   00BCH   A      72#
ADC0CN . . . . . .  D ADDR   00E8H   A      114# 218 219 220 221 222 223 224 225
ADC0GTH. . . . . .  D ADDR   00C5H   A      81#
ADC0GTL. . . . . .  D ADDR   00C4H   A      80#
ADC0H. . . . . . .  D ADDR   00BFH   A      75#
ADC0L. . . . . . .  D ADDR   00BEH   A      74#
ADC0LTH. . . . . .  D ADDR   00C7H   A      83#
ADC0LTL. . . . . .  D ADDR   00C6H   A      82#
ADC1 . . . . . . .  D ADDR   009CH   A      43#
ADC1CF . . . . . .  D ADDR   00ABH   A      57#
ADC1CN . . . . . .  D ADDR   00AAH   A      56#
ADDX . . . . . . .  C ADDR   1A5DH   R   SEG=MAIN   801 837 839 841 843 845 847 849 851 853 916 918 920 922 924 926
                                           928 930 932 935 937 939 941 943 945 947 949 951 953 4570#
ADEC . . . . . . .  D ADDR   0053H   A      301# 1313 1317 2947 2951 2986 2990 3012 3016 3065 3083 3636 3653 3671
                                           3725 3742
AFTERK . . . . . .  C ADDR   05D0H   R   SEG=MAIN   1034 1113#
AGE2 . . . . . . .  C ADDR   01C2H   R   SEG=MAIN   547# 550
AGEON. . . . . . .  C ADDR   01D0H   R   SEG=MAIN   556# 558
ALESS0 . . . . . .  C ADDR   06E6H   R   SEG=MAIN   1260 1281#
ALLSUM . . . . . .  C ADDR   02E1H   R   SEG=MAIN   730# 766
ALMUL. . . . . . .  C ADDR   19A4H   R   SEG=MAIN   4416#
ALTOF. . . . . . .  C ADDR   0402H   A      1009 1045 1094 1126 1139 1574 1635 1673 2993 3019 3068 3086 5592 5600#
ALTOF1 . . . . . .  C ADDR   041EH   A      5609 5624# 5648
AMX0CF . . . . . .  D ADDR   00BAH   A      70#
AMX0SL . . . . . .  D ADDR   00BBH   A      71#
AMX1SL . . . . . .  D ADDR   00ACH   A      58#
ANKOR. . . . . . .  C ADDR   0523H   R   SEG=MAIN   1007 1014#
AN_T7. . . . . . .  C ADDR   0EA1H   R   SEG=MAIN   2564# 2614 2623
AUTOKA . . . . . .  C ADDR   0892H   R   SEG=MAIN   1032 1603#
AVPGO. . . . . . .  C ADDR   0650H   R   SEG=MAIN   1185 1187#
AVTDEC1. . . . . .  C ADDR   0595H   R   SEG=MAIN   1067 1074#
AWTOF. . . . . . .  C ADDR   03FCH   A      5593#
B. . . . . . . . .  D ADDR   00F0H   A      122# 3187 3389 3508 3844 4419 4422 4424 4428 4432 4436 4440 4445 4449
                                           4456 4460 4464 4470 4474 4478 4484 5177 5178
BEGIN. . . . . . .  C ADDR   0100H   R   SEG=MAIN   249 441#
BFORM. . . . . . .  C ADDR   0A2CH   R   SEG=MAIN   1875 1880 1892# 1918
BIN30. . . . . . .  C ADDR   17C0H   R   SEG=MAIN   3979# 4005
BIN31. . . . . . .  C ADDR   17C4H   R   SEG=MAIN   3984# 3988
BIN32. . . . . . .  C ADDR   17D4H   R   SEG=MAIN   3997# 4002
BIN41. . . . . . .  C ADDR   17E5H   R   SEG=MAIN   4013# 4023
BINDEC . . . . . .  C ADDR   17B4H   R   SEG=MAIN   1315 3958#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    93

BITAKT . . . . . .  B ADDR   0023H.2 A      348# 1394 1395 1398
BITAVP . . . . . .  B ADDR   0020H.5 A      319# 1145 1214 1386 2604 2605 2607
BITBON . . . . . .  B ADDR   0021H.2 A      326# 1496 2109 2110 2112
BITBUF . . . . . .  B ADDR   0021H.0 A      324# 1517 1519 2191
BITIZM . . . . . .  B ADDR   0020H.4 A      318# 527 638 2088 2145 2230 2545 2597 2689 2705 2769 2797 2883 2891 3030
BITMAS . . . . . .  B ADDR   0020H.1 A      315# 962 965 1857
BITMEM . . . . . .  B ADDR   0021H.3 A      327# 2385 2800 2832 2882 2890 3029
BITMENU. . . . . .  B ADDR   0022H.1 A      335# 2365 2598
BITMIG . . . . . .  B ADDR   0023H.1 A      347# 2059 2332 2738 3050 3307 3314 3319 3325 3330 3344 3356
BITNUL . . . . . .  B ADDR   0021H.7 A      331# 1371 2625 2626 2633
BITOLL . . . . . .  B ADDR   0022H.7 A      341# 593 1221 1298
BITPRD . . . . . .  B ADDR   0021H.1 A      325# 1495
BITRS. . . . . . .  B ADDR   0020H.3 A      317#
BITT2. . . . . . .  B ADDR   0022H.0 A      334# 1297 2231 2271 2640 2770
BITVI11. . . . . .  B ADDR   0020H.6 A      320# 1146 2144 2362
BITVI12. . . . . .  B ADDR   0022H.2 A      336#
BITVI13. . . . . .  B ADDR   0022H.3 A      337#
BITVI21. . . . . .  B ADDR   0022H.5 A      339#
BITVI31. . . . . .  B ADDR   0022H.6 A      340#
BITVICH. . . . . .  B ADDR   0022H.4 A      338# 1296 2146 2156 2293 2657 2688 2704
BITZNAK. . . . . .  B ADDR   0020H.0 A      314# 618 647
BITZNB . . . . . .    ----   -----          3751 3754
BITZUS . . . . . .  B ADDR   0020H.7 A      321# 1237
BMEM11 . . . . . .  B ADDR   0021H.4 A      328# 2363
BMEM12 . . . . . .  B ADDR   0021H.5 A      329#
BMEM13 . . . . . .  B ADDR   0021H.6 A      330#
BOUT7. . . . . . .  C ADDR   1021H   R   SEG=MAIN   2778# 2780
BRET . . . . . . .  C ADDR   12C8H   R   SEG=MAIN   3135 3140 3144# 3448 3453 3457#
BUFDEC . . . . . .  C ADDR   071AH   R   SEG=MAIN   1320# 1325
BUFIND . . . . . .  D ADDR   0040H   A      298# 546 550 555 558 562 1270 1275 1318 1326 1328 1333 1369 1396 1399
                                           1729 2076 2340 2342 2345 2533 2751 2784 2790 3185 3203 3311 3333 3506 3524
                                           3635 3652 3670 3724 3741 3752
BUFON. . . . . . .  C ADDR   0B65H   R   SEG=MAIN   2109 2112#
CCF0 . . . . . . .  B ADDR   00D8H.0 A      209#
CCF1 . . . . . . .  B ADDR   00D8H.1 A      210#
CCF2 . . . . . . .  B ADDR   00D8H.2 A      211#
CCF3 . . . . . . .  B ADDR   00D8H.3 A      212#
CCF4 . . . . . . .  B ADDR   00D8H.4 A      213#
CDONE. . . . . . .  C ADDR   01F7H   A      5174# 5178
CELLBIT. . . . . .  D ADDR   0020H   A      313# 314 315 316 317 318 319 320 321
CELLBIT1 . . . . .  D ADDR   0021H   A      323# 324 325 326 327 328 329 330 331
CELLBIT2 . . . . .  D ADDR   0022H   A      333# 334 335 336 337 338 339 340 341
CELLBIT3 . . . . .  D ADDR   0023H   A      345# 346 347 348
CEXP . . . . . . .  C ADDR   01E2H   A      5151 5160#
CF . . . . . . . .  B ADDR   00D8H.7 A      215#
CH0. . . . . . . .  C ADDR   15C1H   R   SEG=MAIN   2634 3580#
CH1. . . . . . . .  C ADDR   15DDH   R   SEG=MAIN   1714 3590#
CH10 . . . . . . .  C ADDR   15C5H   R   SEG=MAIN   976 3581#
CH100. . . . . . .  C ADDR   15D5H   R   SEG=MAIN   729 1255 3585#
CH10000. . . . . .  C ADDR   15D1H   R   SEG=MAIN   3584#
CH2. . . . . . . .  C ADDR   15D9H   R   SEG=MAIN   971 3586#
CH20 . . . . . . .  C ADDR   14FEH   R   SEG=MAIN   765 981 3420# 3875#
CH2THO . . . . . .  C ADDR   15F1H   R   SEG=MAIN   1642 1680 3595#
CH5. . . . . . . .  C ADDR   15C9H   R   SEG=MAIN   3582#
CH57 . . . . . . .  C ADDR   14FAH   R   SEG=MAIN   3419# 3874#
CH954. . . . . . .  C ADDR   15CDH   R   SEG=MAIN   3583#
CHANMA . . . . . .  C ADDR   0CE0H   R   SEG=MAIN   2338 2347#
CHANZ. . . . . . .  C ADDR   0CC9H   R   SEG=MAIN   2323 2336#
CHAVT. . . . . . .  D ADDR   0081H   A      363# 507 1023 1068 1074 1696
CHBEFORE . . . . .  D ADDR   009BH   A      373# 529 726 741 760
CHBUF. . . . . . .  D ADDR   00ADH   A      380# 1493 1503
CHCMP. . . . . . .  C ADDR   0AD1H   R   SEG=MAIN   630 1029 2034#
CHDEC. . . . . . .  C ADDR   0938H   R   SEG=MAIN   637 1075 1086 1706#
CHDEL. . . . . . .  D ADDR   0083H   A      364# 1543 1588 1610 1655 1690
CHDELMO. . . . . .  C ADDR   087AH   R   SEG=MAIN   1558 1588# 1593
CHIF . . . . . . .  C ADDR   148BH   R   SEG=MAIN   3337 3339#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    94

CHIND. . . . . . .  D ADDR   00ACH   A      379# 1160 1403
CHINKOR. . . . . .  D ADDR   0098H   A      362# 502 708 1015 1028 1070 1082 1085 1595
CHKL . . . . . . .  D ADDR   003DH   A      305# 629 636 2209 2237 2286 2578 2803
CHMAS. . . . . . .  D ADDR   006EH   A      302# 959 966 984 1856
CHMASN . . . . . .  D ADDR   003FH   A      306# 715 724 761 778 790 964 966 967
CHTADC . . . . . .  C ADDR   0982H   R   SEG=MAIN   1755#
CHTHO. . . . . . .  C ADDR   15E9H   R   SEG=MAIN   1046 1127 3593#
CHTHOU . . . . . .  C ADDR   1677H   R   SEG=MAIN   3712#
CHZAP. . . . . . .  C ADDR   15BDH   R   SEG=MAIN   1482 3579#
CH_1 . . . . . . .  C ADDR   15E1H   R   SEG=MAIN   532 3591#
CH_10. . . . . . .  C ADDR   1601H   R   SEG=MAIN   3599#
CH_10TH. . . . . .  C ADDR   15FDH   R   SEG=MAIN   1180 3598#
CH_200 . . . . . .  C ADDR   15F9H   R   SEG=MAIN   1140 3597#
CH_220 . . . . . .  C ADDR   15F5H   R   SEG=MAIN   1119 3596#
CH_22T . . . . . .  C ADDR   16B5H   R   SEG=MAIN   3760#
CH_250 . . . . . .  C ADDR   1605H   R   SEG=MAIN   3600#
CH_500 . . . . . .  C ADDR   16B1H   R   SEG=MAIN   3759#
CH_953 . . . . . .  C ADDR   15E5H   R   SEG=MAIN   3592#
CH_B . . . . . . .  C ADDR   16ADH   R   SEG=MAIN   3757#
CH_FL. . . . . . .  C ADDR   16B9H   R   SEG=MAIN   3761#
CIKLWR . . . . . .  C ADDR   0A02H   R   SEG=MAIN   1863#
CKCON. . . . . . .  D ADDR   008EH   A      30# 459
CL4. . . . . . . .  C ADDR   1617H   R   SEG=MAIN   3615# 3617
CL4N . . . . . . .  C ADDR   161DH   R   SEG=MAIN   3624# 3626
CLE256 . . . . . .  C ADDR   043EH   A      5656#
CLEAR. . . . . . .  C ADDR   17AEH   R   SEG=MAIN   3936 3940# 3970
CLEAR4 . . . . . .  C ADDR   1614H   R   SEG=MAIN   738 1196 1198 1234 1236 2138 2140 2619 2621 3613#
CLEARN . . . . . .  C ADDR   161CH   R   SEG=MAIN   2948 2987 3013 3622#
CLMASSIX . . . . .  C ADDR   09F2H   R   SEG=MAIN   501 1194 1232 1599 1700 1850# 2136 2617 2768
CLMASV . . . . . .  C ADDR   0655H   R   SEG=MAIN   1189 1191#
CLMAX. . . . . . .  C ADDR   09F7H   R   SEG=MAIN   1852# 1855
CLR11. . . . . . .  C ADDR   17AFH   R   SEG=MAIN   3942# 3944
CLRDEC . . . . . .  C ADDR   17A8H   R   SEG=MAIN   3934#
CLRNUM . . . . . .  C ADDR   17ACH   R   SEG=MAIN   3937# 4051
CLRVICH. . . . . .  C ADDR   0FA2H   R   SEG=MAIN   2704# 2720
CNTR . . . . . . .  N NUMB   0006H   A      4847#
CO02S. . . . . . .  C ADDR   15B2H   R   SEG=MAIN   3573# 3577
CO1S . . . . . . .  C ADDR   15A9H   R   SEG=MAIN   3567# 3567
CO2S . . . . . . .  C ADDR   15A5H   R   SEG=MAIN   3565# 3569
COND . . . . . . .  C ADDR   0A66H   R   SEG=MAIN   1947#
CONSTE . . . . . .  D ADDR   00A4H   A      377# 1202
CONSTF . . . . . .  D ADDR   00A8H   A      378# 1207
COPY1. . . . . . .  C ADDR   049FH   A      5738# 5743
COPYPP . . . . . .  C ADDR   0499H   A      5735#
COUNT. . . . . . .  C ADDR   1587H   R   SEG=MAIN   3539# 3539
CPRL2. . . . . . .  B ADDR   00C8H.0 A      189#
CPT0CN . . . . . .  D ADDR   009EH   A      45#
CPT1CN . . . . . .  D ADDR   009FH   A      46#
CR . . . . . . . .  B ADDR   00D8H.6 A      214#
CT . . . . . . . .  C ADDR   158EH   R   SEG=MAIN   3545# 3545
CT2. . . . . . . .  B ADDR   00C8H.1 A      190#
CY . . . . . . . .  B ADDR   00D0H.7 A      206#
DAC0CN . . . . . .  D ADDR   00D4H   A      95# 464
DAC0H. . . . . . .  D ADDR   00D3H   A      94# 1262 1283
DAC0L. . . . . . .  D ADDR   00D2H   A      93# 1265 1287
DAC1CN . . . . . .  D ADDR   00D7H   A      98# 465
DAC1H. . . . . . .  D ADDR   00D6H   A      97# 1490
DAC1L. . . . . . .  D ADDR   00D5H   A      96# 1487
DCOA . . . . . . .  C ADDR   0A6BH   R   SEG=MAIN   1951# 1953
DCOB . . . . . . .  C ADDR   0A72H   R   SEG=MAIN   1955# 1973
DCOC . . . . . . .  C ADDR   0A7DH   R   SEG=MAIN   1965# 1970
DCOD . . . . . . .  C ADDR   0A8AH   R   SEG=MAIN   1972 1975#
DD . . . . . . . .  C ADDR   01FCH   R   SEG=MAIN   584#
DDOUTF . . . . . .  C ADDR   1114H   R   SEG=MAIN   2880 2887 2914 2920# 2942
DEC30. . . . . . .  C ADDR   1801H   R   SEG=MAIN   4061# 4086
DEC31. . . . . . .  C ADDR   1806H   R   SEG=MAIN   4067# 4074
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    95

DEC32. . . . . . .  C ADDR   1816H   R   SEG=MAIN   4079# 4083
DECBIN . . . . . .  C ADDR   17F4H   R   SEG=MAIN   2952 2991 3017 3066 3084 4040#
DECSIZE. . . . . .  N NUMB   000AH   A      3915# 3935 3969 3996 4009 4012 4066
DECT2. . . . . . .  C ADDR   181FH   R   SEG=MAIN   4057 4089#
DEDPTR . . . . . .  C ADDR   1A74H   R   SEG=MAIN   4574 4578 4582 4588#
DENORM . . . . . .  C ADDR   0133H   A      5006# 5062
DGOTO7 . . . . . .  C ADDR   11E7H   R   SEG=MAIN   3020# 3026
DIAP . . . . . . .  D ADDR   00AEH   A      381# 521 1184 1216 1332 2130 2162 2199 2569 2610 3115 3136 3386 3428 3449
                                           3684 3841 3903
DIINC. . . . . . .  C ADDR   0B84H   R   SEG=MAIN   2133 2136#
DIKDN. . . . . . .  C ADDR   14D2H   R   SEG=MAIN   3388 3408# 3843 3863#
DIKDW. . . . . . .  C ADDR   1661H   R   SEG=MAIN   3688 3700#
DIPAR. . . . . . .  C ADDR   1675H   R   SEG=MAIN   3710#
DIV1 . . . . . . .  C ADDR   02DDH   A      5343# 5402
DIV2 . . . . . . .  C ADDR   0320H   A      5361 5365 5369 5373 5388#
DIV3 . . . . . . .  C ADDR   030DH   A      5362 5366 5370 5374#
DIV9 . . . . . . .  C ADDR   0336H   A      5332 5334 5408#
DIVIDE . . . . . .  C ADDR   18DFH   R   SEG=MAIN   1879 4275#
DONE . . . . . . .  C ADDR   184EH   R   SEG=MAIN   4105 4116#
DONE1. . . . . . .  C ADDR   184CH   R   SEG=MAIN   4108 4111 4114#
DOSH . . . . . . .  C ADDR   1968H   R   SEG=MAIN   4350 4366#
DOSUB. . . . . . .  C ADDR   1956H   R   SEG=MAIN   4334 4338 4342 4346 4347 4351#
DPH. . . . . . . .  D ADDR   0083H   A      19# 1810 1818 4122 4158 4193 4196 4208 4231 4593 4595 5669 5689 5735
DPL. . . . . . . .  D ADDR   0082H   A      18# 1811 1817 4138 4174 4195 4209 4212 4246 4590 4592 5670 5690 5736
DVIG0. . . . . . .  C ADDR   07CDH   R   SEG=MAIN   1439# 1441
DVIG1. . . . . . .  C ADDR   07C2H   R   SEG=MAIN   1430# 1432
DVIG2. . . . . . .  C ADDR   07B7H   R   SEG=MAIN   1421# 1423
DVIG3. . . . . . .  C ADDR   07ABH   R   SEG=MAIN   1412# 1414
DVIG4. . . . . . .  C ADDR   07D9H   R   SEG=MAIN   1450# 1452
DVIG6. . . . . . .  C ADDR   07F8H   R   SEG=MAIN   1475# 1477
DVM. . . . . . . .  C ADDR   07F6H   R   SEG=MAIN   1466 1474#
EA . . . . . . . .  B ADDR   00A8H.7 A      169#
EIE1 . . . . . . .  D ADDR   00E6H   A      112# 462
EIE2 . . . . . . .  D ADDR   00E7H   A      113# 488 1727 1739 2070 2502 2516 3112
EIP1 . . . . . . .  D ADDR   00F6H   A      128#
EIP2 . . . . . . .  D ADDR   00F7H   A      129#
EMI0CF . . . . . .  D ADDR   00A3H   A      49#
EMI0CN . . . . . .  D ADDR   00AFH   A      61#
EMI0TC . . . . . .  D ADDR   00A1H   A      48#
ENDSDV . . . . . .  C ADDR   07FCH   R   SEG=MAIN   1472 1478#
ENDSUM . . . . . .  C ADDR   04CFH   R   SEG=MAIN   802 854 958#
ENSMB. . . . . . .  B ADDR   00C0H.6 A      186#
EQU1L. . . . . . .  C ADDR   0DC4H   R   SEG=MAIN   2451 2455#
ES . . . . . . . .  B ADDR   00A8H.4 A      167#
ET0. . . . . . . .  B ADDR   00A8H.1 A      164#
ET1. . . . . . . .  B ADDR   00A8H.3 A      166#
ET2. . . . . . . .  B ADDR   00A8H.5 A      168#
EX0. . . . . . . .  B ADDR   00A8H.0 A      163#
EX1. . . . . . . .  B ADDR   00A8H.2 A      165#
EXEN2. . . . . . .  B ADDR   00C8H.3 A      192#
EXF2 . . . . . . .  B ADDR   00C8H.6 A      195#
EXP1 . . . . . . .  N NUMB   0000H   A      4849#
EXP2 . . . . . . .  N NUMB   0001H   A      4851# 5028 5049
F0 . . . . . . . .  B ADDR   00D0H.5 A      204#
F1 . . . . . . . .  B ADDR   00D0H.1 A      200#
FINDKOEF . . . . .  C ADDR   1652H   R   SEG=MAIN   1042 1123 3683#
FINDR. . . . . . .  C ADDR   17A0H   R   SEG=MAIN   3903#
FINIS. . . . . . .  C ADDR   1993H   R   SEG=MAIN   4294 4395#
FLACL. . . . . . .  D ADDR   00B7H   A      67#
FLADD. . . . . . .  C ADDR   0166H   A      1209 5054# 5143
FLCMP. . . . . . .  C ADDR   01D6H   A      1121 1142 1182 5148#
FLDIV. . . . . . .  C ADDR   02B7H   A      1048 1129 1206 1644 1682 5318#
FLMUL. . . . . . .  C ADDR   0203H   A      1053 1106 1134 5188#
FLOUT. . . . . . .  C ADDR   01E1H   A      5155 5158#
FLSCL. . . . . . .  D ADDR   00B6H   A      66# 5657 5663 5714 5719
FLSUB. . . . . . .  C ADDR   01D1H   A      1098 1640 1678 5141#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    96

FND. . . . . . . .  C ADDR   01F8H   A      5164 5167 5170 5173 5176#
FO1M . . . . . . .  C ADDR   0A29H   R   SEG=MAIN   1885 1889#
FO2M . . . . . . .  C ADDR   0A32H   R   SEG=MAIN   1892 1894#
FORM4. . . . . . .  C ADDR   0A33H   R   SEG=MAIN   1887 1893 1897#
FT1IZM . . . . . .  C ADDR   0C63H   R   SEG=MAIN   2281#
FTOL . . . . . . .  C ADDR   0343H   A      1054 1136 1303 5424#
FTOL1. . . . . . .  C ADDR   037CH   A      5437 5441 5465#
FTOL2. . . . . . .  C ADDR   039EH   A      5461 5498#
FTOL22 . . . . . .  C ADDR   03C4H   A      5501 5535#
FTOL23 . . . . . .  C ADDR   03A2H   A      5502# 5534
FTOL24 . . . . . .  C ADDR   03B5H   A      5504 5520#
FTOL25 . . . . . .  C ADDR   03C2H   A      5519 5534#
FTOL26 . . . . . .  C ADDR   03E4H   A      5550 5566#
FTOL3. . . . . . .  C ADDR   038AH   A      5464 5478#
FTOL33 . . . . . .  C ADDR   038EH   A      5482# 5496
FTOL4. . . . . . .  C ADDR   0371H   A      5443 5458#
FTOL9. . . . . . .  C ADDR   0381H   A      5471# 5481 5497 5565 5580
GENER. . . . . . .  C ADDR   0145H   R   SEG=MAIN   470# 471
GO23NO . . . . . .  C ADDR   10E3H   R   SEG=MAIN   2888 2894#
GO31L. . . . . . .  C ADDR   0DCAH   R   SEG=MAIN   2443 2460#
GO41L. . . . . . .  C ADDR   0DCFH   R   SEG=MAIN   2460 2462#
GOA2 . . . . . . .  C ADDR   0617H   R   SEG=MAIN   1144 1147#
GOA3A2 . . . . . .  C ADDR   0621H   R   SEG=MAIN   1152# 1212
GOCIKLE. . . . . .  C ADDR   0835H   R   SEG=MAIN   1497 1506 1510 1517# 1523 1526
GOFULL . . . . . .  C ADDR   110EH   R   SEG=MAIN   2898 2918#
GOONIN . . . . . .  C ADDR   062EH   R   SEG=MAIN   1159# 1199 1222 1238
GOONIND. . . . . .  C ADDR   06EFH   R   SEG=MAIN   1162 1288#
GOONT. . . . . . .  C ADDR   081FH   R   SEG=MAIN   1500 1502#
GOPART . . . . . .  C ADDR   02BFH   R   SEG=MAIN   710 713#
GOTO7. . . . . . .  C ADDR   0EADH   R   SEG=MAIN   2572 2577# 2631 2638 2674 2690 2708 2727 2739 2778 2782 2807 2842
                                           2851 2855 2869 2884 2892 2900 2920 2930 2964 2977 2979 3001 3020 3032 3040
                                           3047 3077
GOTOKD . . . . . .  C ADDR   0545H   R   SEG=MAIN   1012 1036#
GOZNAK . . . . . .  C ADDR   0271H   R   SEG=MAIN   624 653#
HNOR11 . . . . . .  C ADDR   0FADH   R   SEG=MAIN   2667 2679 2711#
HNOR12 . . . . . .  C ADDR   0F6EH   R   SEG=MAIN   2675 2679#
HNOT1. . . . . . .  C ADDR   0FEAH   R   SEG=MAIN   2652 2748#
HNOT2. . . . . . .  C ADDR   0F3CH   R   SEG=MAIN   2649#
HR12 . . . . . . .  C ADDR   0F64H   R   SEG=MAIN   2670 2675#
HVI1113. . . . . .  C ADDR   0F5EH   R   SEG=MAIN   2673# 2678 2683
IE . . . . . . . .  D ADDR   00A8H   A      54# 163 164 165 166 167 168 169 489 5656 5664 5713 5723
IE0. . . . . . . .  B ADDR   0088H.1 A      144#
IE1. . . . . . . .  B ADDR   0088H.3 A      146#
INCT . . . . . . .  C ADDR   0F38H   R   SEG=MAIN   2644 2646#
IND. . . . . . . .  C ADDR   0950H   R   SEG=MAIN   551 559 584 641 1400 1727# 2123 2601
INDA3. . . . . . .  C ADDR   06B6H   R   SEG=MAIN   1253#
INDOLL . . . . . .  C ADDR   068EH   R   SEG=MAIN   1214 1215 1219#
INIACP . . . . . .  C ADDR   1400H   R   SEG=MAIN   590 2766 3244# 3767#
INTN . . . . . . .  C ADDR   11D0H   R   SEG=MAIN   3011#
IP . . . . . . . .  D ADDR   00B8H   A      68# 172 173 174 175 176 177
IT0. . . . . . . .  B ADDR   0088H.0 A      143#
IT1. . . . . . . .  B ADDR   0088H.2 A      145#
IZCHI. . . . . . .  C ADDR   0FD2H   R   SEG=MAIN   2729#
IZMAN. . . . . . .  C ADDR   0BD5H   R   SEG=MAIN   2057 2183#
IZMFUN . . . . . .  C ADDR   0BE4H   R   SEG=MAIN   2124 2135 2142 2187 2190#
IZMPAT . . . . . .  C ADDR   0BE8H   R   SEG=MAIN   2107 2111 2113 2159 2194#
IZMT2. . . . . . .  C ADDR   0C05H   R   SEG=MAIN   2210 2215#
IZMT3. . . . . . .  C ADDR   0C10H   R   SEG=MAIN   2215 2221#
JFINIS . . . . . .  C ADDR   18FAH   R   SEG=MAIN   4286 4294#
KD . . . . . . . .  C ADDR   15EDH   R   SEG=MAIN   3594#
KEYB1. . . . . . .  C ADDR   0AF3H   R   SEG=MAIN   283 2058#
KEYB2. . . . . . .  C ADDR   0E3CH   R   SEG=MAIN   286 2515#
KFULL. . . . . . .  C ADDR   10E7H   R   SEG=MAIN   2865 2897#
KGO23. . . . . . .  C ADDR   10D3H   R   SEG=MAIN   2864 2886#
KLEV1. . . . . . .  C ADDR   1094H   R   SEG=MAIN   2834 2856#
KLEV2. . . . . . .  C ADDR   1099H   R   SEG=MAIN   2856 2858#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    97

KLEV21 . . . . . .  C ADDR   10B5H   R   SEG=MAIN   2862 2871#
KLEV22 . . . . . .  C ADDR   109EH   R   SEG=MAIN   2858 2862#
KLEV23 . . . . . .  C ADDR   10BDH   R   SEG=MAIN   2871 2876#
KLMAS. . . . . . .  C ADDR   0344H   R   SEG=MAIN   743 781 789#
KNAVP. . . . . . .  C ADDR   0EDFH   R   SEG=MAIN   2557 2604#
KNIZM. . . . . . .  B ADDR   0023H.0 A      346# 1144 1215 1390 2161 2183 2184 2188
KNIZMON. . . . . .  C ADDR   0BDFH   R   SEG=MAIN   2183 2188#
KNKMP. . . . . . .  C ADDR   0E2DH   R   SEG=MAIN   2510# 2551
KNLEFT . . . . . .  C ADDR   0EECH   R   SEG=MAIN   2514 2610#
KNMEM. . . . . . .  C ADDR   103FH   R   SEG=MAIN   2509 2797#
KNMENU . . . . . .  C ADDR   0ECFH   R   SEG=MAIN   2563 2597#
KNNUL. . . . . . .  C ADDR   0F07H   R   SEG=MAIN   2513 2625#
KNOPT. . . . . . .  C ADDR   0C18H   R   SEG=MAIN   2056 2229#
KNRAZR . . . . . .  C ADDR   0C2DH   R   SEG=MAIN   2055 2243#
KNRIGHT. . . . . .  C ADDR   0B7AH   R   SEG=MAIN   2097 2128#
KNVICH . . . . . .  C ADDR   0B96H   R   SEG=MAIN   2106 2144#
KOEFKD . . . . . .  D ADDR   00A0H   A      376# 538
KOEFKM . . . . . .  D ADDR   0094H   A      370# 536 1104 1686
KOEFKP . . . . . .  D ADDR   0090H   A      369# 534 1099 1648
KONSTA . . . . . .  D ADDR   00BCH   A      389# 3069
KONSTB . . . . . .  D ADDR   00C0H   A      390# 3087
KOR0US . . . . . .  C ADDR   12D8H   R   SEG=MAIN   1556 3167# 3482#
KOR0_AN. . . . . .  D ADDR   0084H   A      366# 1095 1575 1638 1676
KORDEC1. . . . . .  C ADDR   05A8H   R   SEG=MAIN   1080 1085#
KORDEC10 . . . . .  C ADDR   058EH   R   SEG=MAIN   1070#
KORNUL . . . . . .  C ADDR   085AH   R   SEG=MAIN   1019 1543#
KVVOD0 . . . . . .  C ADDR   1101H   R   SEG=MAIN   2844 2904 2913#
LABELA . . . . . .  C ADDR   0246H   R   SEG=MAIN   627# 645 1520
LABELB . . . . . .  C ADDR   07A4H   R   SEG=MAIN   1062 1241 1405# 1531 1535 1537
LABELC . . . . . .  C ADDR   0C2DH   R   SEG=MAIN   2244#
LABELE . . . . . .  C ADDR   0BF6H   R   SEG=MAIN   2192 2202 2205 2208# 2249 2252 2264 2267
LABELF . . . . . .  C ADDR   0C4FH   R   SEG=MAIN   2054 2270#
LABELH . . . . . .  C ADDR   0F27H   R   SEG=MAIN   2512 2640#
LABELI . . . . . .  C ADDR   1202H   R   SEG=MAIN   2655 2741 3035#
LABELK . . . . . .  C ADDR   105AH   R   SEG=MAIN   2654 2810#
LABELL . . . . . .  C ADDR   0D6FH   R   SEG=MAIN   2363 2405 2414#
LABELL1. . . . . .  C ADDR   0CE8H   R   SEG=MAIN   2351# 2467 2489
LABELN . . . . . .  C ADDR   0DE9H   R   SEG=MAIN   2475#
LABELP . . . . . .  C ADDR   1202H   R   SEG=MAIN   3022 3033#
LABL2. . . . . . .  C ADDR   0DB6H   R   SEG=MAIN   2446# 2874 2936
LABL21 . . . . . .  C ADDR   0D8FH   R   SEG=MAIN   2415 2429#
LABL22 . . . . . .  C ADDR   0DA5H   R   SEG=MAIN   2433 2438#
LABM . . . . . . .  C ADDR   1136H   R   SEG=MAIN   2876 2938#
LADD . . . . . . .  C ADDR   1A3BH   R   SEG=MAIN   721 757 1485 4521#
LADDX. . . . . . .  C ADDR   1A4CH   R   SEG=MAIN   4545#
LAL22. . . . . . .  C ADDR   0D87H   R   SEG=MAIN   2419 2424#
LBTOF. . . . . . .  C ADDR   042DH   A      5635#
LCMP . . . . . . .  C ADDR   1839H   R   SEG=MAIN   1916 2044 4101#
LDC_LONG . . . . .  C ADDR   184FH   R   SEG=MAIN   533 1483 1643 1681 2635 4121#
LDC_LTEMP. . . . .  C ADDR   1871H   R   SEG=MAIN   730 972 977 982 1047 1120 1128 1141 1181 1256 1715 4157#
LDX_LONG . . . . .  C ADDR   1897H   R   SEG=MAIN   4192#
LDX_LTEMP. . . . .  C ADDR   18BDH   R   SEG=MAIN   4230#
LEFCUR . . . . . .  C ADDR   1179H   R   SEG=MAIN   2970# 3006 3024
LEFMEM11 . . . . .  C ADDR   1062H   R   SEG=MAIN   2835# 2857 2859
LEV220 . . . . . .  C ADDR   10A1H   R   SEG=MAIN   2863# 2872
LEV2GO . . . . . .  C ADDR   0DFDH   R   SEG=MAIN   2474 2485#
LEVEL. . . . . . .  D ADDR   00B0H   A      383# 2115 2368 2386 2414 2801 2833 2915
LI21 . . . . . . .  C ADDR   0FDCH   R   SEG=MAIN   2736 2738#
LLDI2. . . . . . .  C ADDR   0BCEH   R   SEG=MAIN   2174 2178#
LLDI23 . . . . . .  C ADDR   0BC2H   R   SEG=MAIN   2166 2171#
LLDI3. . . . . . .  C ADDR   0BC9H   R   SEG=MAIN   2173 2175#
LLEV2. . . . . . .  C ADDR   0DD4H   R   SEG=MAIN   2445 2465#
LLMUL. . . . . . .  C ADDR   19A4H   R   SEG=MAIN   4415#
LLSUB. . . . . . .  C ADDR   1A29H   R   SEG=MAIN   4497#
LLTOF. . . . . . .  C ADDR   0432H   A      5641#
LMUL . . . . . . .  C ADDR   19A4H   R   SEG=MAIN   1874 4417#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    98

LOAB12 . . . . . .  C ADDR   144FH   R   SEG=MAIN   2764 3285# 3808#
LOAD . . . . . . .  D ADDR   00B7H   A      387# 2232 2275 2642 2760 3184 3505
LOADB. . . . . . .  C ADDR   0FFBH   R   SEG=MAIN   2755 2758# 2788 2794
LOADB2 . . . . . .  C ADDR   1024H   R   SEG=MAIN   2776 2780#
LOADCLE. . . . . .  C ADDR   1080H   R   SEG=MAIN   2849# 2907
LOADKD . . . . . .  C ADDR   14B4H   R   SEG=MAIN   3386# 3841#
LOADR2 . . . . . .  C ADDR   14A6H   R   SEG=MAIN   2992 3018 3067 3085 3369# 3824#
LOADT. . . . . . .  C ADDR   12EDH   R   SEG=MAIN   2234 2281 2648 3184# 3505#
LOADUS . . . . . .  C ADDR   1299H   R   SEG=MAIN   591 1192 1229 1587 1689 2141 2189 2622 2767 3115# 3426#
LOBLOK . . . . . .  C ADDR   111CH   R   SEG=MAIN   2895 2924# 2932
LOCLE. . . . . . .  C ADDR   107BH   R   SEG=MAIN   2838 2847#
LOD1 . . . . . . .  C ADDR   12FCH   R   SEG=MAIN   3192# 3197 3513# 3518
LODT . . . . . . .  C ADDR   1308H   R   SEG=MAIN   3204# 3209 3525# 3530
LOIZMK . . . . . .  C ADDR   0F71H   R   SEG=MAIN   2680# 2702
LOLEVT . . . . . .  C ADDR   12EFH   R   SEG=MAIN   2121 3185# 3506#
LOLIST . . . . . .  C ADDR   106FH   R   SEG=MAIN   2840#
LOOP . . . . . . .  C ADDR   09BFH   R   SEG=MAIN   1796# 1797
LOOPS. . . . . . .  C ADDR   18FDH   R   SEG=MAIN   4296# 4329
LOSPUS . . . . . .  C ADDR   12CCH   R   SEG=MAIN   1557 3150# 3465#
LOTEXT . . . . . .  C ADDR   1304H   R   SEG=MAIN   1220 2152 2298 2305 2311 2317 2371 2378 2394 2403 2411 2422 2426
                                           2436 2440 2600 2673 2726 2799 2841 2850 2854 2868 2919 2925 2959 2996 3075
                                           3201# 3522#
LOTP . . . . . . .  C ADDR   177FH   R   SEG=MAIN   3882# 3892 3895
LOTPUS . . . . . .  C ADDR   1777H   R   SEG=MAIN   3460 3879#
LOU. . . . . . . .  C ADDR   0BD4H   R   SEG=MAIN   2161 2177 2181#
LOUIZM . . . . . .  C ADDR   0BB1H   R   SEG=MAIN   2161# 2186 3144 3457
LOUTF. . . . . . .  C ADDR   0D8CH   R   SEG=MAIN   2418 2427# 2432 2466 2472
LOVICH . . . . . .  C ADDR   0F67H   R   SEG=MAIN   2676# 2696 2715 3094
LOWR . . . . . . .  C ADDR   1089H   R   SEG=MAIN   2847 2852#
LOWR1. . . . . . .  C ADDR   108BH   R   SEG=MAIN   2853# 2911
LSUB . . . . . . .  C ADDR   1A29H   R   SEG=MAIN   1059 1155 1716 4498#
LTEMP. . . . . . .  N NUMB   0008H   A      984 986 987 988 1926 1929 1932 1935 1978 1979 1980 1981 3714 3715 3716
                                           3717 3913# 4287 4288 4289 4290 4299 4303 4307 4311 4314 4315 4316 4317
                                           4318 4319 4320 4321 4322 4323 4324 4325 4328 4331 4336 4340 4344 4354 4357
                                           4360 4363 4379 4382 4383 4385 4386 4388 4389 4391 4396 4397 4398 4399 4419
                                           4424 4432 4440 4445 4456 4464 4470 4478 4484 4852 4853 4892 4897 4899 4908
                                           4909 4910 4911 5142 5150 5163 5166 5169 5172 5752 5755 5758 5761
LWR. . . . . . . .  C ADDR   0A04H   R   SEG=MAIN   1865# 1869
LWRX . . . . . . .  C ADDR   09C8H   R   SEG=MAIN   1809# 1821
LWTOF. . . . . . .  C ADDR   042FH   A      5637#
MABIN. . . . . . .  D ADDR   006FH   A      303#
MAFORM . . . . . .  C ADDR   0A1FH   R   SEG=MAIN   1308 1873 1878 1883# 1915
MAIN . . . . . . .  C SEG    1A86H       REL=UNIT   237 294# 434
MANT1. . . . . . .  N NUMB   0002H   A      4850# 4877 4926 4927
MANT2. . . . . . .  N NUMB   0008H   A      4852# 4903 4904 5035 5037 5038 5040 5041 5043 5044 5046 5085 5086 5088
                                           5089 5091 5092 5094 5095 5099 5101 5104 5107 5205 5207 5208 5210 5211 5213
                                           5214 5216 5267 5269 5270 5272 5273 5275 5276 5278 5360 5364 5368 5372 5376
                                           5379 5382 5385
MARK0_8. . . . . .  C ADDR   0CC1H   R   SEG=MAIN   2326 2331#
MARKER . . . . . .  D ADDR   00B2H   A      385# 512 2075 2325 2447 2475 2532 2706 2722 2734 2926 2960 2970 2997 3044
                                           3072 3090 3303 3331 3346 3357
MARLE. . . . . . .  C ADDR   148CH   R   SEG=MAIN   2978 3343#
MARRI. . . . . . .  C ADDR   1499H   R   SEG=MAIN   2483 3356#
MAS10. . . . . . .  C ADDR   0363H   R   SEG=MAIN   791 803#
MAS20. . . . . . .  C ADDR   03E0H   R   SEG=MAIN   803 856#
MAS5DIV. . . . . .  C ADDR   0509H   R   SEG=MAIN   973 978 983 990#
MASFULL. . . . . .  C ADDR   04DBH   R   SEG=MAIN   962 966#
MASS0. . . . . . .  X ADDR   0080H   A      397 398# 792 797 825 833 904 912 1851
MASS1. . . . . . .  X ADDR   0084H   A      399# 800 822 836 901 915
MASS10 . . . . . .  X ADDR   00A8H   A      408# 877 934
MASS11 . . . . . .  X ADDR   00ACH   A      409# 874 936
MASS12 . . . . . .  X ADDR   00B0H   A      410# 871 938
MASS13 . . . . . .  X ADDR   00B4H   A      411# 868 940
MASS14 . . . . . .  X ADDR   00B8H   A      412# 865 942
MASS15 . . . . . .  X ADDR   00BCH   A      413# 862 944
MASS16 . . . . . .  X ADDR   00C0H   A      414# 860 946
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE    99

MASS17 . . . . . .  X ADDR   00C4H   A      415# 858 948
MASS18 . . . . . .  X ADDR   00C8H   A      416# 856 950
MASS19 . . . . . .  X ADDR   00CCH   A      417# 952
MASS2. . . . . . .  X ADDR   0088H   A      400# 819 838 898 917
MASS3. . . . . . .  X ADDR   008CH   A      401# 816 840 895 919
MASS4. . . . . . .  X ADDR   0090H   A      402# 813 842 892 921
MASS5. . . . . . .  X ADDR   0094H   A      403# 810 844 889 923
MASS6. . . . . . .  X ADDR   0098H   A      404# 808 846 887 925
MASS7. . . . . . .  X ADDR   009CH   A      405# 806 848 885 927
MASS8. . . . . . .  X ADDR   00A0H   A      406# 804 850 883 929
MASS9. . . . . . .  X ADDR   00A4H   A      407# 852 880 931
MASX5. . . . . . .  C ADDR   04FFH   R   SEG=MAIN   964 984#
MEAVP. . . . . . .  C ADDR   0EE7H   R   SEG=MAIN   2604 2607#
MECLE. . . . . . .  C ADDR   016FH   R   SEG=MAIN   493# 495
MEFF . . . . . . .  C ADDR   0176H   R   SEG=MAIN   497# 500
MEM12NO. . . . . .  C ADDR   10FDH   R   SEG=MAIN   2905 2909#
MIDL . . . . . . .  C ADDR   1930H   R   SEG=MAIN   4291 4326#
MIGN . . . . . . .  C ADDR   145EH   R   SEG=MAIN   1728 3303#
MIGNN. . . . . . .  C ADDR   1466H   R   SEG=MAIN   3305 3310#
MLABL2 . . . . . .  C ADDR   1133H   R   SEG=MAIN   2936# 2940
MMM. . . . . . . .  C ADDR   0241H   R   SEG=MAIN   622#
MO220. . . . . . .  C ADDR   0683H   R   SEG=MAIN   1173 1214#
MODF . . . . . . .  B ADDR   00F8H.5 A      233#
MOUTF. . . . . . .  C ADDR   0D22H   R   SEG=MAIN   2382# 2391 2400 2408
MOVE28 . . . . . .  C ADDR   0A8CH   R   SEG=MAIN   1049 1130 1641 1679 1978#
MOVE82 . . . . . .  C ADDR   167BH   R   SEG=MAIN   3714#
MOVEA3 . . . . . .  C ADDR   06EFH   R   SEG=MAIN   1266 1291#
MOVLEFT. . . . . .  D ADDR   003AH   A      309# 2327 2455 2480 2724 2929 2963 2971 3000 3350
MOVRIG . . . . . .  D ADDR   003BH   A      308# 2448 2452 2476 2928 2962 2975 2999 3359
MSTEN. . . . . . .  B ADDR   00F8H.1 A      229#
MUP1 . . . . . . .  C ADDR   021AH   A      5202# 5245
MUP11. . . . . . .  C ADDR   0257H   A      5249# 5294
MUP2 . . . . . . .  C ADDR   0297H   A      5279 5293#
MUP3 . . . . . . .  C ADDR   026CH   A      5248 5264#
MVV11. . . . . . .  C ADDR   1117H   R   SEG=MAIN   2916 2922#
MVV12. . . . . . .  C ADDR   112FH   R   SEG=MAIN   2922 2931#
N12DELCH . . . . .  C ADDR   0934H   R   SEG=MAIN   1694 1702#
N4DELCH. . . . . .  C ADDR   08E5H   R   SEG=MAIN   1621 1659#
N8DELCH. . . . . .  C ADDR   0922H   R   SEG=MAIN   1659 1694#
NBIMENU. . . . . .  C ADDR   0D28H   R   SEG=MAIN   2365 2385#
NBLOK. . . . . . .  D ADDR   00C4H   A      391# 2955
NE05 . . . . . . .  C ADDR   0358H   A      5431 5433 5435 5438#
NEXIN. . . . . . .  C ADDR   095AH   R   SEG=MAIN   1731# 1738
NMINUS . . . . . .  C ADDR   05C5H   R   SEG=MAIN   1101 1105#
NNDELCH. . . . . .  C ADDR   08A5H   R   SEG=MAIN   1611 1621#
NNMEMB . . . . . .  C ADDR   0E09H   R   SEG=MAIN   2384 2490#
NNNUL. . . . . . .  C ADDR   0768H   R   SEG=MAIN   1371 1374#
NO . . . . . . . .  C ADDR   1918H   R   SEG=MAIN   4301 4305 4309 4313#
NO0KEY . . . . . .  C ADDR   0253H   R   SEG=MAIN   631 636#
NO11V6 . . . . . .  C ADDR   0C95H   R   SEG=MAIN   2295 2308#
NO12V6 . . . . . .  C ADDR   0CA2H   R   SEG=MAIN   2308 2314#
NO13V6 . . . . . .  C ADDR   0CAFH   R   SEG=MAIN   2314 2321#
NO21P7 . . . . . .  C ADDR   1258H   R   SEG=MAIN   3059 3079#
NO2PARN. . . . . .  C ADDR   06DBH   R   SEG=MAIN   1268 1274#
NO31N. . . . . . .  C ADDR   118DH   R   SEG=MAIN   2968 2981#
NO3PARN. . . . . .  C ADDR   06D1H   R   SEG=MAIN   1268# 1351
NO4DEL . . . . . .  C ADDR   0880H   R   SEG=MAIN   1561 1592#
NOAVK. . . . . . .  C ADDR   059AH   R   SEG=MAIN   1030 1077#
NOAVP. . . . . . .  C ADDR   0614H   R   SEG=MAIN   1146# 1183 1186
NOBAVP . . . . . .  C ADDR   0785H   R   SEG=MAIN   1386 1390#
NOBEF99. . . . . .  C ADDR   02FCH   R   SEG=MAIN   727 744# 763
NOBIT. . . . . . .  C ADDR   0245H   A      5217 5231#
NOBITIZM . . . . .  C ADDR   078BH   R   SEG=MAIN   1390 1393#
NOBUF0 . . . . . .  C ADDR   0842H   R   SEG=MAIN   1494 1525#
NOCHI0 . . . . . .  C ADDR   06B2H   R   SEG=MAIN   1174 1240#
NOCHN10. . . . . .  C ADDR   04F7H   R   SEG=MAIN   975 980#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE   100

NOCHN2 . . . . . .  C ADDR   04ECH   R   SEG=MAIN   970 975#
NODI2. . . . . . .  C ADDR   0698H   R   SEG=MAIN   1217 1224#
NODI6. . . . . . .  C ADDR   0EF5H   R   SEG=MAIN   2612 2616#
NODI8. . . . . . .  C ADDR   073FH   R   SEG=MAIN   1335 1341#
NODI9. . . . . . .  C ADDR   069DH   R   SEG=MAIN   1226 1229#
NODIS9 . . . . . .  C ADDR   074EH   R   SEG=MAIN   1341 1353#
NOEQU1 . . . . . .  C ADDR   0DF7H   R   SEG=MAIN   2479 2483#
NOEQU2 . . . . . .  C ADDR   1187H   R   SEG=MAIN   2974 2978#
NOFIZM . . . . . .  C ADDR   0C76H   R   SEG=MAIN   2271 2293#
NOFT1. . . . . . .  C ADDR   0C62H   R   SEG=MAIN   2276 2280#
NOFZ . . . . . . .  C ADDR   083DH   R   SEG=MAIN   1517 1520#
NOH37. . . . . . .  C ADDR   0F78H   R   SEG=MAIN   2669 2685# 2694 2700 2713
NOHNOT1. . . . . .  C ADDR   1034H   R   SEG=MAIN   2750 2789#
NOHNOT2. . . . . .  C ADDR   102CH   R   SEG=MAIN   2783# 2789
NOKORR . . . . . .  C ADDR   052CH   R   SEG=MAIN   1017 1020#
NOLAH. . . . . . .  C ADDR   0F48H   R   SEG=MAIN   2640 2657#
NOLEV1 . . . . . .  C ADDR   0DADH   R   SEG=MAIN   2429 2443#
NOM31. . . . . . .  C ADDR   1170H   R   SEG=MAIN   2938 2966#
NOM32. . . . . . .  C ADDR   11BFH   R   SEG=MAIN   2966 3004#
NOM33. . . . . . .  C ADDR   11EAH   R   SEG=MAIN   3004 3022#
NOMARL . . . . . .  C ADDR   121FH   R   SEG=MAIN   3045 3049#
NOME11 . . . . . .  C ADDR   10EEH   R   SEG=MAIN   2902#
NOMEM11. . . . . .  C ADDR   0D43H   R   SEG=MAIN   2387 2397#
NOMEM12. . . . . .  C ADDR   0D59H   R   SEG=MAIN   2397 2405#
NOMEMK . . . . . .  C ADDR   10EBH   R   SEG=MAIN   2809 2899#
NON1C. . . . . . .  C ADDR   0C3EH   R   SEG=MAIN   2250 2254#
NONULAVT . . . . .  C ADDR   0582H   R   SEG=MAIN   1025 1064#
NONULDEL . . . . .  C ADDR   0867H   R   SEG=MAIN   1544 1560#
NOP3_0 . . . . . .  C ADDR   06B6H   R   SEG=MAIN   1246#
NOPART1. . . . . .  C ADDR   0300H   R   SEG=MAIN   716 751#
NOPART2. . . . . .  C ADDR   0320H   R   SEG=MAIN   751 770#
NOPART3. . . . . .  C ADDR   0325H   R   SEG=MAIN   770 773#
NOPART4. . . . . .  C ADDR   0338H   R   SEG=MAIN   773 782#
NOPLUS . . . . . .  C ADDR   0CDBH   R   SEG=MAIN   2341 2344#
NOPOIN7. . . . . .  C ADDR   1226H   R   SEG=MAIN   3043 3054#
NOPOINT. . . . . .  C ADDR   120DH   R   SEG=MAIN   3038 3041#
NOR11. . . . . . .  C ADDR   0CEEH   R   SEG=MAIN   2302 2355#
NOR13. . . . . . .  C ADDR   0C88H   R   SEG=MAIN   2302#
NORDN. . . . . . .  C ADDR   00F6H   A      4938# 4971
NORDN1 . . . . . .  C ADDR   0107H   A      4940 4954#
NORIG2 . . . . . .  C ADDR   0DDDH   R   SEG=MAIN   2462 2469#
NORIM6 . . . . . .  C ADDR   0E09H   R   SEG=MAIN   2375 2491#
NORM1. . . . . . .  C ADDR   00F0H   A      4933# 5130 5307 5409 5626
NORR11 . . . . . .  C ADDR   0F88H   R   SEG=MAIN   2692#
NORR12 . . . . . .  C ADDR   0F95H   R   SEG=MAIN   2692 2698# 2711
NORUP. . . . . . .  C ADDR   0119H   A      4937 4974#
NORUP1 . . . . . .  C ADDR   011EH   A      4979# 4997
NORUP2 . . . . . .  C ADDR   0132H   A      4981 4998#
NORVICH. . . . . .  C ADDR   079DH   R   SEG=MAIN   1350 1401#
NOSUB. . . . . . .  C ADDR   1953H   R   SEG=MAIN   4335 4339 4343 4348#
NOT1IN . . . . . .  C ADDR   0845H   R   SEG=MAIN   1498 1529#
NOT1_7 . . . . . .  C ADDR   0EBCH   R   SEG=MAIN   2579 2586#
NOT2IN . . . . . .  C ADDR   084DH   R   SEG=MAIN   1529 1533#
NOT2_7 . . . . . .  C ADDR   0EC7H   R   SEG=MAIN   2586 2591#
NOT3IN . . . . . .  C ADDR   0855H   R   SEG=MAIN   1533 1536#
NOTAKT . . . . . .  C ADDR   0795H   R   SEG=MAIN   1394 1398#
NOTT1. . . . . . .  C ADDR   0828H   R   SEG=MAIN   1504 1508#
NOTT5. . . . . . .  C ADDR   082DH   R   SEG=MAIN   1508 1512#
NOT_1. . . . . . .  C ADDR   0C48H   R   SEG=MAIN   2254 2255 2266#
NOT_10 . . . . . .  C ADDR   0C48H   R   SEG=MAIN   2265#
NOVIR. . . . . . .  C ADDR   0CFBH   R   SEG=MAIN   2292 2365#
NOVIR1 . . . . . .  C ADDR   0C73H   R   SEG=MAIN   2292# 2293
NOZZMI . . . . . .  C ADDR   072FH   R   SEG=MAIN   1330 1332#
NSEC01 . . . . . .  C ADDR   0771H   R   SEG=MAIN   1375 1378#
NSEC1. . . . . . .  C ADDR   0778H   R   SEG=MAIN   1378 1381#
NSEC10 . . . . . .  C ADDR   077DH   R   SEG=MAIN   1377 1380 1381 1385#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE   101

NULAVT . . . . . .  C ADDR   0892H   R   SEG=MAIN   1609#
NUMSIZE. . . . . .  N NUMB   0004H   A      3916# 3938 3976 3983 4058 4078
OBOARD . . . . . .  C ADDR   1889H   R   SEG=MAIN   4159 4173#
OBOARD1. . . . . .  C ADDR   18D1H   R   SEG=MAIN   4232 4245#
OK1. . . . . . . .  C ADDR   0186H   A      5064 5079#
OK2. . . . . . . .  C ADDR   01A0H   A      5081 5096#
OK3. . . . . . . .  C ADDR   01C4H   A      5113 5129#
ONBOAR1. . . . . .  C ADDR   18AFH   R   SEG=MAIN   4194 4211#
ONBOARD. . . . . .  C ADDR   1863H   R   SEG=MAIN   4123 4137#
ONMEM11. . . . . .  C ADDR   104DH   R   SEG=MAIN   2602 2606 2608 2803#
ONMIG. . . . . . .  C ADDR   1474H   R   SEG=MAIN   3314 3322#
ONVICH . . . . . .  C ADDR   0BA9H   R   SEG=MAIN   2144 2156#
OSCICN . . . . . .  D ADDR   00B2H   A      64# 473
OSCXCN . . . . . .  D ADDR   00B1H   A      63# 466 470
OUT6 . . . . . . .  C ADDR   0E09H   R   SEG=MAIN   2053 2214 2219 2224 2241 2278 2283 2290 2364 2373 2380 2492#
OUT7 . . . . . . .  C ADDR   1278H   R   SEG=MAIN   2510 2511 2583 2590 2594 2645 2650 3051 3056 3097#
OUTF . . . . . . .  C ADDR   0C69H   R   SEG=MAIN   2274 2286# 2299 2306 2312 2318 2329 2334 2343 2346 2349 2353 2382
                                           2395 2404 2412 2423 2427 2437 2441 2454 2457 2482 2484 2487
OUTMA. . . . . . .  C ADDR   0CC7H   R   SEG=MAIN   2333 2334#
OV . . . . . . . .  B ADDR   00D0H.2 A      201# 4115
P. . . . . . . . .  B ADDR   00D0H.0 A      199#
P0 . . . . . . . .  D ADDR   0080H   A      16# 1731 1735
P0MDOUT. . . . . .  D ADDR   00A4H   A      50# 444
P1 . . . . . . . .  D ADDR   0090H   A      32# 594 595 1744 1746 1749 1752 1756 1758 1759 2008 2011 2013 2016 2022
                                           2024 2026 3258 3265 3781 3788
P1MDIN . . . . . .  D ADDR   00BDH   A      73#
P1MDOUT. . . . . .  D ADDR   00A5H   A      51# 445
P2 . . . . . . . .  D ADDR   00A0H   A      47# 1777 1781 1790
P2MDOUT. . . . . .  D ADDR   00A6H   A      52# 446
P3 . . . . . . . .  D ADDR   00B0H   A      62# 455 1776 1778 1780 1786 1787 1788 1791 1792 2081 2083 2085 2086 2089
                                           2090 2092 2093 2095 2096 2098 2099 2101 2102 2104 2105 2272 2273 2321 2322
                                           2336 2337 2347 2348 2366 2367 2389 2390 2398 2399 2406 2407 2416 2417 2430
                                           2431 2444 2445 2465 2466 2473 2474 2485 2486 2506 2538 2540 2542 2543 2546
                                           2547 2549 2550 2552 2553 2555 2556 2558 2559 2561 2562 2641 2643 2668 2669
                                           2685 2686 2693 2694 2699 2700 2712 2713 2748 2749 2835 2836 2863 2864 2877
                                           2878 2879 2880 2886 2887 2902 2903 2913 2914 2939 2940 2941 2942 2967 2968
                                           2981 2982 3005 3006 3007 3008 3023 3024 3025 3026 3036 3037 3041 3042 3054
                                           3055 3111
P3IF . . . . . . .  D ADDR   00ADH   A      59# 2503 2505 3108 3110
P3MDOUT. . . . . .  D ADDR   00A7H   A      53# 448
P4 . . . . . . . .  D ADDR   0084H   A      20# 2168 2170 3122 3125 3141 3143 3435 3438 3454 3456 3884
P5 . . . . . . . .  D ADDR   0085H   A      21# 518 526 1612 1617 1652 1654 2178 2180 3130 3133 3161 3164 3443 3446
                                           3476 3479 3888
P6 . . . . . . . .  D ADDR   0086H   A      22# 596 598 602 604
P7 . . . . . . . .  D ADDR   0096H   A      38#
P74OUT . . . . . .  D ADDR   00B5H   A      65# 449
PACK1. . . . . . .  C ADDR   00DEH   A      4916# 5131 5308 5410 5627
PARN . . . . . . .  D ADDR   00AFH   A      382# 523 1364 2197 2245 2567 2773
PART . . . . . . .  D ADDR   009AH   A      372# 519 714 1004 1037 1064 1077 1374 1402 1502 1513 2208 2246 2577 2758
                                           2772 3134 3285 3447 3808
PCA0CN . . . . . .  D ADDR   00D8H   A      99# 209 210 211 212 213 214 215
PCA0CPH0 . . . . .  D ADDR   00FAH   A      132#
PCA0CPH1 . . . . .  D ADDR   00FBH   A      133#
PCA0CPH2 . . . . .  D ADDR   00FCH   A      134#
PCA0CPH3 . . . . .  D ADDR   00FDH   A      135#
PCA0CPH4 . . . . .  D ADDR   00FEH   A      136#
PCA0CPL0 . . . . .  D ADDR   00EAH   A      116#
PCA0CPL1 . . . . .  D ADDR   00EBH   A      117#
PCA0CPL2 . . . . .  D ADDR   00ECH   A      118#
PCA0CPL3 . . . . .  D ADDR   00EDH   A      119#
PCA0CPL4 . . . . .  D ADDR   00EEH   A      120#
PCA0CPM0 . . . . .  D ADDR   00DAH   A      101#
PCA0CPM1 . . . . .  D ADDR   00DBH   A      102#
PCA0CPM2 . . . . .  D ADDR   00DCH   A      103#
PCA0CPM3 . . . . .  D ADDR   00DDH   A      104#
PCA0CPM4 . . . . .  D ADDR   00DEH   A      105#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE   102

PCA0H. . . . . . .  D ADDR   00F9H   A      131#
PCA0L. . . . . . .  D ADDR   00E9H   A      115# 442
PCA0MD . . . . . .  D ADDR   00D9H   A      100# 443
PCON . . . . . . .  D ADDR   0087H   A      23#
PROD . . . . . . .  N NUMB   000CH   A      4853# 5197 5198 5199 5200 5220 5221 5222 5224 5225 5227 5228 5230 5252
                                           5254 5255 5257 5258 5260 5261 5263 5282 5283 5284 5286 5287 5289 5290 5292
                                           5303 5304 5305 5306 5327 5328 5329 5330 5346 5348 5349 5351 5352 5354 5355
                                           5357 5387 5404 5405 5406 5407
PS . . . . . . . .  B ADDR   00B8H.4 A      176#
PSCTL. . . . . . .  D ADDR   008FH   A      31# 5658 5662 5715 5718
PSW. . . . . . . .  D ADDR   00D0H   A      91# 199 200 201 202 203 204 205 206 1917 1919 2061 2500 2518 3106 4588
                                           4596
PT0. . . . . . . .  B ADDR   00B8H.1 A      173#
PT1. . . . . . . .  B ADDR   00B8H.3 A      175#
PT2. . . . . . . .  B ADDR   00B8H.5 A      177#
PX0. . . . . . . .  B ADDR   00B8H.0 A      172#
PX1. . . . . . . .  B ADDR   00B8H.2 A      174#
PYSKST . . . . . .  C ADDR   0B5DH   R   SEG=MAIN   2103 2109#
R10. . . . . . . .  N NUMB   000AH   A      429# 627 1026 3401 3856 5681
R11. . . . . . . .  N NUMB   000BH   A      430# 628 1027 3405 3860 5685
R8 . . . . . . . .  N NUMB   0008H   A      427# 2042 3393 3848 5673
R9 . . . . . . . .  N NUMB   0009H   A      428# 2043 3397 3852 5677
RAFTERK. . . . . .  C ADDR   0542H   R   SEG=MAIN   1034# 1040
RB8. . . . . . . .  B ADDR   0098H.2 A      155#
RCAP2H . . . . . .  D ADDR   00CBH   A      87#
RCAP2L . . . . . .  D ADDR   00CAH   A      86#
RCAP4H . . . . . .  D ADDR   00E5H   A      111#
RCAP4L . . . . . .  D ADDR   00E4H   A      110#
RCLK . . . . . . .  B ADDR   00C8H.5 A      194#
RE1. . . . . . . .  C ADDR   0AC1H   R   SEG=MAIN   2022# 2028
RE4BYTE. . . . . .  C ADDR   0454H   A      5669#
REACP. . . . . . .  D ADDR   0077H   A      304# 609 611 613 615 655 671 679 687 696 703 718 754 774 783 1626 1628
                                           1630 1632 1664 1666 1668 1670
READ . . . . . . .  C ADDR   0ABFH   R   SEG=MAIN   608 610 612 2021#
READYACP . . . . .  C ADDR   02B7H   R   SEG=MAIN   697 707#
READ_X2. . . . . .  C ADDR   09AEH   R   SEG=MAIN   1785# 1796
REBYTE . . . . . .  C ADDR   020CH   R   SEG=MAIN   593# 638 745 1590 1600 1619 1657 1692 1701 1703
REBYTE2. . . . . .  C ADDR   046CH   A      1043 1124 5689#
REF0CN . . . . . .  D ADDR   00D1H   A      92# 450
REN. . . . . . . .  B ADDR   0098H.4 A      157#
RESAR2 . . . . . .  C ADDR   0A98H   R   SEG=MAIN   719 755 775 784 796 831 910 1052 1093 1132 1149 1203 1254 1302
                                           1306 1564 1986# 2628
RESAR8 . . . . . .  C ADDR   0A56H   R   SEG=MAIN   1058 1096 1105 1154 1205 1208 1639 1677 1925#
REZAM. . . . . . .  D ADDR   008CH   A      368# 1674
REZAP. . . . . . .  D ADDR   0088H   A      367# 1636
REZMUL . . . . . .  C ADDR   05ADH   R   SEG=MAIN   1072 1084 1091#
REZ_A. . . . . . .  D ADDR   0062H   A      357# 732 776 785 795 830 909 1563
REZ_A0 . . . . . .  D ADDR   006AH   A      359# 1057 1153 1197 1235 2139 2620 2629 2636
REZ_A1 . . . . . .  D ADDR   0066H   A      358# 998 1055 1092 1137 1148 1204
REZ_A2 . . . . . .  D ADDR   007BH   A      360# 1150 1210
REZ_A3 . . . . . .  D ADDR   009CH   A      374# 1060 1156 1253 1301 1305 1407 2627
REZ_AME. . . . . .  D ADDR   005EH   A      355# 1010 1051 1109 1131
REZ_DEL. . . . . .  D ADDR   00C5H   A      392# 734
RGOTO7 . . . . . .  C ADDR   116DH   R   SEG=MAIN   2964# 2982 3008
RHNOT1 . . . . . .  C ADDR   0F3FH   R   SEG=MAIN   2643 2652#
RI . . . . . . . .  B ADDR   0098H.0 A      153#
RIGBLO . . . . . .  C ADDR   0DB0H   R   SEG=MAIN   2444# 2461 2463
RIGBLOK. . . . . .  C ADDR   0DE3H   R   SEG=MAIN   2473#
RIGHT2 . . . . . .  C ADDR   0B71H   R   SEG=MAIN   2116 2120#
RIGHT3 . . . . . .  C ADDR   0B75H   R   SEG=MAIN   2118 2123#
RIMEN6 . . . . . .  C ADDR   0D17H   R   SEG=MAIN   2369 2377#
RIZMAN . . . . . .  C ADDR   0AF0H   R   SEG=MAIN   2057# 2091
RKNLEFT. . . . . .  C ADDR   0E39H   R   SEG=MAIN   2514# 2554
RKNMEM . . . . . .  C ADDR   0E2AH   R   SEG=MAIN   2509# 2560
RKNNUL . . . . . .  C ADDR   0E36H   R   SEG=MAIN   2513# 2548
RKNOPT . . . . . .  C ADDR   0AEDH   R   SEG=MAIN   2056# 2100
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE   103

RKNRAZR. . . . . .  C ADDR   0AEAH   R   SEG=MAIN   2055# 2094
RKVVOD0. . . . . .  C ADDR   1078H   R   SEG=MAIN   2837 2844#
RLABELF. . . . . .  C ADDR   0AE7H   R   SEG=MAIN   2054# 2088
RLABELH. . . . . .  C ADDR   0E33H   R   SEG=MAIN   2512# 2545
RLABELI. . . . . .  C ADDR   0F45H   R   SEG=MAIN   2655# 2698
RLABELK. . . . . .  C ADDR   0F42H   R   SEG=MAIN   2654# 2657
RLABELL1 . . . . .  C ADDR   0E06H   R   SEG=MAIN   2486 2489#
RLABL2 . . . . . .  C ADDR   10BAH   R   SEG=MAIN   2874# 2878
RLER . . . . . . .  C ADDR   1498H   R   SEG=MAIN   3351 3353#
RMO220 . . . . . .  C ADDR   0636H   R   SEG=MAIN   1173#
RNNMEMB. . . . . .  C ADDR   0D25H   R   SEG=MAIN   2384# 2385
RNO3PARN . . . . .  C ADDR   074CH   R   SEG=MAIN   1351# 1365
RNOCHI0. . . . . .  C ADDR   0638H   R   SEG=MAIN   1161 1174#
RNOMEMK. . . . . .  C ADDR   1057H   R   SEG=MAIN   2809# 2832
RNORIM6. . . . . .  C ADDR   0D14H   R   SEG=MAIN   2367 2375#
RNORVICH . . . . .  C ADDR   074AH   R   SEG=MAIN   1296 1297 1350#
RNOT1IN. . . . . .  C ADDR   081BH   R   SEG=MAIN   1404 1498#
ROUT6. . . . . . .  C ADDR   0AE4H   R   SEG=MAIN   2053# 2082 2087
ROUT7. . . . . . .  C ADDR   0E30H   R   SEG=MAIN   2511# 2539 2544
ROUTF. . . . . . .  C ADDR   0F85H   R   SEG=MAIN   2686 2690# 2749
RR0. . . . . . . .  N NUMB   0000H   A      420# 2062 2499 2519 3105
RR1. . . . . . . .  N NUMB   0001H   A      421# 2063 2498 2520 3104
RR2. . . . . . . .  N NUMB   0002H   A      423# 1712 2064 2497 2521 3103
RR3. . . . . . . .  N NUMB   0003H   A      424# 1713 2065 2496 2522 3102
RR4. . . . . . . .  N NUMB   0004H   A      2066 2495 2523 3101 3917# 3974 3995 4011 4055 4077
RR5. . . . . . . .  N NUMB   0005H   A      2067 2494 2524 3100 3918# 3975 3982 3989 4056 4065
RR6. . . . . . . .  N NUMB   0006H   A      422# 2068 2493 2525 3099
RR7. . . . . . . .  N NUMB   0007H   A      425# 2069 2492 2526 3098
RRIR . . . . . . .  C ADDR   14A5H   R   SEG=MAIN   3362 3364#
RS0. . . . . . . .  B ADDR   00D0H.3 A      202#
RS1. . . . . . . .  B ADDR   00D0H.4 A      203#
RSEEIND. . . . . .  C ADDR   06E4H   R   SEG=MAIN   1280# 1298
RSTSRC . . . . . .  D ADDR   00EFH   A      121# 480
RTIZMRI. . . . . .  C ADDR   0C4CH   R   SEG=MAIN   2269#
RXOVRN . . . . . .  B ADDR   00F8H.4 A      232#
SADDR0 . . . . . .  D ADDR   00A9H   A      55#
SADDR1 . . . . . .  D ADDR   00F3H   A      125#
SADEN0 . . . . . .  D ADDR   00B9H   A      69#
SADEN1 . . . . . .  D ADDR   00AEH   A      60#
SAVBA. . . . . . .  D ADDR   003CH   A      307# 2079 2536 3315 3322
SAVEIR2. . . . . .  C ADDR   09DAH   R   SEG=MAIN   798 834 913 1824#
SAVELTE. . . . . .  C ADDR   04A7H   A      5752#
SAVER2 . . . . . .  C ADDR   09E6H   R   SEG=MAIN   535 537 539 723 733 735 759 777 786 999 1011 1056 1061 1110 1138
                                           1151 1157 1211 1310 1576 1637 1649 1675 1687 1838# 2630 2637 3070 3088
SBUF0. . . . . . .  D ADDR   0099H   A      40#
SBUF1. . . . . . .  D ADDR   00F2H   A      124#
SCON0. . . . . . .  D ADDR   0098H   A      39# 153 154 155 156 157 158 159 160
SCON1. . . . . . .  D ADDR   00F1H   A      123#
SDV. . . . . . . .  C ADDR   0970H   R   SEG=MAIN   1744# 1751
SDV1 . . . . . . .  C ADDR   0984H   R   SEG=MAIN   1756# 1762
SDVIG0 . . . . . .  C ADDR   0298H   R   SEG=MAIN   683# 685
SDVIG1 . . . . . .  C ADDR   028DH   R   SEG=MAIN   675# 677
SDVIG2 . . . . . .  C ADDR   0282H   R   SEG=MAIN   667# 669
SDVIG3 . . . . . .  C ADDR   0276H   R   SEG=MAIN   658# 660
SDVIG4 . . . . . .  C ADDR   02A7H   R   SEG=MAIN   693# 695
SDVIG6 . . . . . .  C ADDR   02B1H   R   SEG=MAIN   700# 702
SDVM . . . . . . .  C ADDR   02AFH   R   SEG=MAIN   690 699#
SEEGOON. . . . . .  C ADDR   0751H   R   SEG=MAIN   1340 1348 1355#
SEEIND . . . . . .  C ADDR   075FH   R   SEG=MAIN   1272 1279 1280 1368#
SI . . . . . . . .  B ADDR   00C0H.3 A      183#
SIGN . . . . . . .  N NUMB   0007H   A      4848# 4869 4870 4895 4896 4920 5063 5080 5301 5341
SLVSEL . . . . . .  B ADDR   00F8H.2 A      230#
SM0. . . . . . . .  B ADDR   0098H.7 A      160#
SM1. . . . . . . .  B ADDR   0098H.6 A      159#
SM2. . . . . . . .  B ADDR   0098H.5 A      158#
SMB0ADR. . . . . .  D ADDR   00C3H   A      79#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE   104

SMB0CN . . . . . .  D ADDR   00C0H   A      76# 180 181 182 183 184 185 186
SMB0CR . . . . . .  D ADDR   00CFH   A      90#
SMB0DAT. . . . . .  D ADDR   00C2H   A      78#
SMB0STA. . . . . .  D ADDR   00C1H   A      77#
SMBFTE . . . . . .  B ADDR   00C0H.1 A      181#
SMBTOE . . . . . .  B ADDR   00C0H.0 A      180#
SOOTV. . . . . . .  C ADDR   0FE4H   R   SEG=MAIN   2744# 2759
SP . . . . . . . .  D ADDR   0081H   A      17# 441
SPI0CFG. . . . . .  D ADDR   009AH   A      41#
SPI0CKR. . . . . .  D ADDR   009DH   A      44# 486
SPI0CN . . . . . .  D ADDR   00F8H   A      130# 228 229 230 231 232 233 234 235 485
SPI0DAT. . . . . .  D ADDR   009BH   A      42# 1733
SPIEN. . . . . . .  B ADDR   00F8H.0 A      228#
SPIF . . . . . . .  B ADDR   00F8H.7 A      235#
SS1. . . . . . . .  C ADDR   159CH   R   SEG=MAIN   3557# 3559
STA. . . . . . . .  B ADDR   00C0H.5 A      185#
STO. . . . . . . .  B ADDR   00C0H.4 A      184#
SUMMA. . . . . . .  D ADDR   00B3H   A      386# 720 722 737 756 758 1195 1233 2137 2618
SUMT2. . . . . . .  C ADDR   0303H   R   SEG=MAIN   711 753#
T2CON. . . . . . .  D ADDR   00C8H   A      84# 189 190 191 192 193 194 195 196
T4CON. . . . . . .  D ADDR   00C9H   A      85#
TABB1_2. . . . . .  C ADDR   1441H   R   SEG=MAIN   3276# 3286 3799# 3809
TABN . . . . . . .  C ADDR   1796H   R   SEG=MAIN   3901# 3905
TABT11 . . . . . .  C ADDR   155AH   R   SEG=MAIN   3496# 3881
TABT7. . . . . . .  C ADDR   155EH   R   SEG=MAIN   3500# 3894
TABT9. . . . . . .  C ADDR   155CH   R   SEG=MAIN   3498# 3891
TABUS. . . . . . .  C ADDR   12D9H   R   SEG=MAIN   3119 3170# 3432 3485#
TAKTIND. . . . . .  C ADDR   079AH   R   SEG=MAIN   1397 1400#
TB8. . . . . . . .  B ADDR   0098H.3 A      156#
TCLK . . . . . . .  B ADDR   00C8H.4 A      193#
TCON . . . . . . .  D ADDR   0088H   A      24# 143 144 145 146 147 148 149 150 477 478
TE22 . . . . . . .  C ADDR   1789H   R   SEG=MAIN   3880 3890#
TE23 . . . . . . .  C ADDR   1791H   R   SEG=MAIN   3890 3894#
TEAEQU0. . . . . .  C ADDR   1356H   R   SEG=MAIN   2725 3222#
TEBBL. . . . . . .  C ADDR   13ECH   R   SEG=MAIN   2958 3239#
TEBEQU0. . . . . .  C ADDR   1360H   R   SEG=MAIN   3074 3223#
TEBL . . . . . . .  C ADDR   13E2H   R   SEG=MAIN   2867 3238#
TEBLOK . . . . . .  C ADDR   13D8H   R   SEG=MAIN   2924 3237#
TECLE. . . . . . .  C ADDR   13A7H   R   SEG=MAIN   2410 2798 2849 3232#
TEEBL. . . . . . .  C ADDR   13F6H   R   SEG=MAIN   2995 3240#
TEFULL . . . . . .  C ADDR   13CEH   R   SEG=MAIN   2918 3236#
TEIZMK . . . . . .  C ADDR   1389H   R   SEG=MAIN   2297 2304 2681 3229#
TEKALIB. . . . . .  C ADDR   137EH   R   SEG=MAIN   2370 3228#
TELIST . . . . . .  C ADDR   13C3H   R   SEG=MAIN   2402 2840 3235#
TEMEM. . . . . . .  C ADDR   13B1H   R   SEG=MAIN   3233#
TEMENU . . . . . .  C ADDR   136AH   R   SEG=MAIN   2599 3224#
TENMIN . . . . . .  C ADDR   1609H   R   SEG=MAIN   1069 1071 1083 3602#
TEOLL. . . . . . .  C ADDR   139DH   R   SEG=MAIN   1219 3231#
TEOUT. . . . . . .  C ADDR   1393H   R   SEG=MAIN   2310 2357 2672 3230#
TETEST . . . . . .  C ADDR   1374H   R   SEG=MAIN   2377 3226#
TEVICH . . . . . .  C ADDR   134CH   R   SEG=MAIN   2151 2316 2677 3221#
TEWR . . . . . . .  C ADDR   13B9H   R   SEG=MAIN   2393 2853 3234#
TEXTT. . . . . . .  C ADDR   1310H   R   SEG=MAIN   3191 3212# 3512
TF0. . . . . . . .  B ADDR   0088H.5 A      148#
TF1. . . . . . . .  B ADDR   0088H.7 A      150#
TF2. . . . . . . .  B ADDR   00C8H.7 A      196#
TH0. . . . . . . .  D ADDR   008CH   A      28# 460
TH1. . . . . . . .  D ADDR   008DH   A      29#
TH2. . . . . . . .  D ADDR   00CDH   A      89#
TH4. . . . . . . .  D ADDR   00F5H   A      127#
TI . . . . . . . .  B ADDR   0098H.1 A      154#
TIM. . . . . . . .  C ADDR   0994H   R   SEG=MAIN   1765#
TIM1 . . . . . . .  C ADDR   0996H   R   SEG=MAIN   1766# 1766
TIM2 . . . . . . .  C ADDR   0999H   R   SEG=MAIN   1747 1750 1757 1761 1769# 2012 2014 2023 2027
TIM3 . . . . . . .  C ADDR   099BH   R   SEG=MAIN   1770# 1770
TIZMRI . . . . . .  C ADDR   0B6AH   R   SEG=MAIN   2115# 2269
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE   105

TL0. . . . . . . .  D ADDR   008AH   A      26# 461
TL1. . . . . . . .  D ADDR   008BH   A      27#
TL2. . . . . . . .  D ADDR   00CCH   A      88#
TL4. . . . . . . .  D ADDR   00F4H   A      126#
TLABELI. . . . . .  C ADDR   0FE1H   R   SEG=MAIN   2729 2741#
TMOD . . . . . . .  D ADDR   0089H   A      25# 458
TMR2RLH. . . . . .  D ADDR   00CBH   A      292# 475
TMR2RLL. . . . . .  D ADDR   00CAH   A      291# 474
TMR3CN . . . . . .  D ADDR   0091H   A      33#
TMR3H. . . . . . .  D ADDR   0095H   A      37#
TMR3L. . . . . . .  D ADDR   0094H   A      36#
TMR3RLH. . . . . .  D ADDR   0093H   A      35#
TMR3RLL. . . . . .  D ADDR   0092H   A      34#
TR0. . . . . . . .  B ADDR   0088H.4 A      147#
TR1. . . . . . . .  B ADDR   0088H.6 A      149#
TR2. . . . . . . .  B ADDR   00C8H.2 A      191#
TXBSY. . . . . . .  B ADDR   00F8H.3 A      231# 1734
UNPACK1. . . . . .  C ADDR   009EH   A      4866# 5060 5194 5324 5438
UNPACK2. . . . . .  C ADDR   00BAH   A      4891# 5061 5195 5325
UP1. . . . . . . .  C ADDR   0138H   A      5011# 5028
UP2. . . . . . . .  C ADDR   014BH   A      5031# 5049
UP2A . . . . . . .  C ADDR   0161H   A      5010 5047#
UPA. . . . . . . .  C ADDR   1638H   R   SEG=MAIN   3655# 3661
UPA1 . . . . . . .  C ADDR   1648H   R   SEG=MAIN   3673# 3679
UPA2 . . . . . . .  C ADDR   1628H   R   SEG=MAIN   3638# 3644
UPAA . . . . . . .  C ADDR   168AH   R   SEG=MAIN   3727# 3733
UPAB . . . . . . .  C ADDR   169AH   R   SEG=MAIN   3744# 3750
UPAK . . . . . . .  C ADDR   1632H   R   SEG=MAIN   3063 3081 3652#
UPAK2. . . . . . .  C ADDR   1622H   R   SEG=MAIN   2949 3635#
UPAK3. . . . . . .  C ADDR   1642H   R   SEG=MAIN   2988 3014 3670#
UPAKA. . . . . . .  C ADDR   1684H   R   SEG=MAIN   3724#
UPAKB. . . . . . .  C ADDR   1694H   R   SEG=MAIN   3741#
VICHR. . . . . . .  D ADDR   00B1H   A      384# 2148 2157 2294 2666 2717 3057 3092 3879
VIG0 . . . . . . .  C ADDR   07E2H   R   SEG=MAIN   1458# 1460
VIG4 . . . . . . .  C ADDR   07F0H   R   SEG=MAIN   1469# 1471
VIOUT. . . . . . .  C ADDR   0C23H   R   SEG=MAIN   2154 2237#
VVCHIF . . . . . .  C ADDR   147CH   R   SEG=MAIN   2351 3330#
VVIZKO . . . . . .  C ADDR   0FBAH   R   SEG=MAIN   2687 2717#
VVRR6. . . . . . .  C ADDR   0C80H   R   SEG=MAIN   2297#
WCOL . . . . . . .  B ADDR   00F8H.6 A      234#
WDTCN. . . . . . .  D ADDR   00FFH   A      137# 456 457
WORK . . . . . . .  D ADDR   00B8H   A      388# 1409 1484
WR1. . . . . . . .  C ADDR   0AACH   R   SEG=MAIN   2008# 2015
WRITE. . . . . . .  C ADDR   0AA9H   R   SEG=MAIN   606 2006# 3247 3249 3251 3253 3255 3257 3260 3262 3264 3267 3269
                                           3271 3770 3772 3774 3776 3778 3780 3783 3785 3787 3790 3792 3794
WRITED_X1. . . . .  C ADDR   099FH   R   SEG=MAIN   1775#
WRITE_X1 . . . . .  C ADDR   099EH   R   SEG=MAIN   1774#
WRPAGE . . . . . .  C ADDR   0480H   A      5713#
WW5. . . . . . . .  C ADDR   0483H   A      5714# 5722
XBR0 . . . . . . .  D ADDR   00E1H   A      107# 452 484
XBR1 . . . . . . .  D ADDR   00E2H   A      108# 453
XBR2 . . . . . . .  D ADDR   00E3H   A      109# 454 483
XCIKLWR. . . . . .  C ADDR   09C6H   R   SEG=MAIN   793 805 807 809 812 815 818 821 824 827 857 859 861 864 867 870
                                           873 876 879 881 884 886 888 891 894 897 900 903 906 1807#
XTEMP. . . . . . .  N NUMB   000CH   A      3914# 4278 4279 4280 4281 4367 4369 4370 4372 4373 4375 4376 4378 4400
                                           4401 4402 4403 4421 4422 4426 4427 4430 4434 4435 4438 4442 4443 4447 4448
                                           4450 4451 4452 4454 4458 4459 4461 4462 4466 4467 4472 4473 4475 4476 4480
                                           4481 4486 4488 4489 4490
YBNUL. . . . . . .  C ADDR   0F18H   R   SEG=MAIN   2625 2633#
YES. . . . . . . .  C ADDR   1936H   R   SEG=MAIN   4300 4304 4308 4312 4330# 4393
YESAVP . . . . . .  C ADDR   063AH   R   SEG=MAIN   1145 1177#
YESBUF . . . . . .  C ADDR   081FH   R   SEG=MAIN   1496 1501#
YESPRD . . . . . .  C ADDR   081DH   R   SEG=MAIN   1495 1499#
YESTEST. . . . . .  C ADDR   1535H   R   SEG=MAIN   3459#
YESTT5 . . . . . .  C ADDR   0840H   R   SEG=MAIN   1516 1523#
YESVICH. . . . . .  C ADDR   0667H   R   SEG=MAIN   1146 1201#
A51 MACRO ASSEMBLER  AMP21_1                                                              06/07/2007 14:06:15 PAGE   106

YESVIR . . . . . .  C ADDR   0CF3H   R   SEG=MAIN   2362#
Z01S . . . . . . .  C ADDR   15B4H   R   SEG=MAIN   3574# 3576
Z100 . . . . . . .  C ADDR   1585H   R   SEG=MAIN   3538# 3540
Z15. . . . . . . .  C ADDR   1593H   R   SEG=MAIN   3550# 3552
Z1S. . . . . . . .  C ADDR   15A7H   R   SEG=MAIN   3566# 3568
ZAPADC . . . . . .  C ADDR   096EH   R   SEG=MAIN   1743#
ZCMP . . . . . . .  C ADDR   0A48H   R   SEG=MAIN   1915#
ZDIV . . . . . . .  C ADDR   0A15H   R   SEG=MAIN   731 991 1257 1878#
ZER1 . . . . . . .  C ADDR   00B3H   A      4876 4880# 4935 4978
ZER2 . . . . . . .  C ADDR   00D4H   A      4902 4906#
ZMUL . . . . . . .  C ADDR   0A0BH   R   SEG=MAIN   1873#
ZNMAT. . . . . . .  B ADDR   0020H.2 A      316# 1330 1886 1889 1892
ZNPLUS . . . . . .  C ADDR   0269H   R   SEG=MAIN   617 647#
ZZ . . . . . . . .  C ADDR   1595H   R   SEG=MAIN   3551# 3551
Z_01S. . . . . . .  C ADDR   15B0H   R   SEG=MAIN   642 643 644 1518 2072 2529 3326 3572#
Z_100. . . . . . .  C ADDR   1583H   R   SEG=MAIN   3537#
Z_15 . . . . . . .  C ADDR   1591H   R   SEG=MAIN   585 3549#
Z_1MS. . . . . . .  C ADDR   159AH   R   SEG=MAIN   3556#
Z_1S . . . . . . .  C ADDR   15A3H   R   SEG=MAIN   552 560 3564#
Z_5. . . . . . . .  C ADDR   158CH   R   SEG=MAIN   1779 1789 3544#
Z_9. . . . . . . .  C ADDR   0AA4H   R   SEG=MAIN   1736 2000#


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 24 ERROR(S)
